<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI_Secretary v4 - 有限会社Rispondere 統合業務管理システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'Noto Sans JP', 'sans-serif']
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1'
                        },
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            font-weight: 500;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 14px;
            min-height: 44px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.8);
            color: #374151;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 1);
        }
        
        .nav-tab {
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 0 4px;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .nav-tab:not(.active):hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateY(-1px);
        }
        
        .stats-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            backdrop-filter: blur(20px);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-fill {
            transition: stroke-dasharray 0.5s ease;
        }
        
        .calendar-day {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .calendar-day:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .calendar-day.today {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .calendar-day.has-event {
            background: rgba(245, 158, 11, 0.2);
            border: 2px solid #f59e0b;
        }
        
        .task-item {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
            transition: all 0.3s ease;
        }
        
        .task-item:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateX(4px);
        }
        
        .task-item.completed {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        .task-item.urgent {
            border-left: 4px solid #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }
        
        .task-item.priority-high {
            border-left: 4px solid #f59e0b;
            background: rgba(245, 158, 11, 0.05);
        }
        
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 420px;
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 24px;
            margin: 24px 0;
        }
        
        .col-span-3 { grid-column: span 3; }
        .col-span-4 { grid-column: span 4; }
        .col-span-6 { grid-column: span 6; }
        .col-span-8 { grid-column: span 8; }
        .col-span-12 { grid-column: span 12; }
        
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            .col-span-3 { grid-column: span 6; }
            .col-span-4 { grid-column: span 6; }
            .col-span-8 { grid-column: span 6; }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: repeat(1, 1fr);
                gap: 16px;
            }
            .col-span-3,
            .col-span-4,
            .col-span-6,
            .col-span-8,
            .col-span-12 {
                grid-column: span 1;
            }
        }
        
        .session-timer {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            color: white;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 12px;
            z-index: 1000;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .modal.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.show .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body>
    <!-- ログイン画面 -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">
                    <i class="fas fa-building text-purple-600"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">AI Secretary v4</h1>
                <p class="text-gray-600">有限会社Rispondere<br>統合業務管理システム</p>
            </div>
            
            <form onsubmit="handleLogin(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-key mr-2"></i>パスワード
                        </label>
                        <input 
                            type="password" 
                            id="passwordInput" 
                            class="input-field" 
                            placeholder="パスワードを入力してください"
                            required
                        >
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-full">
                        <i class="fas fa-sign-in-alt mr-2"></i>ログイン
                    </button>
                </div>
            </form>
            
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <div class="flex items-center text-blue-800 text-sm">
                    <i class="fas fa-shield-alt mr-2"></i>
                    セキュアログイン・セッション管理・自動バックアップ
                </div>
            </div>
            
            <div id="loginAttempts" class="hidden mt-4 text-center text-red-600 text-sm">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                ログイン試行: <span id="attemptCount">0</span>/5
            </div>
        </div>
    </div>

    <!-- セッションタイマー -->
    <div id="sessionTimer" class="session-timer hidden">
        <i class="fas fa-clock mr-2"></i>
        <span id="timeRemaining"></span>
    </div>

    <!-- メインダッシュボード -->
    <div id="mainDashboard" class="hidden min-h-screen">
        <!-- ヘッダー -->
        <div class="glass-card mx-4 mt-4 mb-6">
            <div class="p-6">
                <div class="flex flex-col lg:flex-row justify-between items-center space-y-4 lg:space-y-0">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 flex items-center">
                            <i class="fas fa-building mr-3 text-purple-600"></i>
                            Rispondere 統合管理
                        </h1>
                        <p class="text-gray-600 mt-1">AI Secretary v4 - 全店舗・全部門統合システム</p>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="text-center">
                            <div class="font-semibold text-gray-900" id="currentDate"></div>
                            <div class="text-sm text-gray-500" id="currentTime"></div>
                        </div>
                        <button onclick="showNotifications()" class="btn btn-secondary">
                            <i class="fas fa-bell mr-2"></i>
                            <span id="notificationCount" class="bg-red-500 text-white text-xs rounded-full px-2 py-1 ml-1">0</span>
                        </button>
                        <button onclick="logout()" class="btn btn-danger">
                            <i class="fas fa-sign-out-alt mr-2"></i>ログアウト
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ナビゲーション -->
        <div class="mx-4 mb-6">
            <div class="flex flex-wrap justify-center lg:justify-start gap-2">
                <button class="nav-tab active" data-tab="dashboard" onclick="switchTab('dashboard')">
                    <i class="fas fa-chart-line mr-2"></i>ダッシュボード
                </button>
                <button class="nav-tab" data-tab="tasks" onclick="switchTab('tasks')">
                    <i class="fas fa-tasks mr-2"></i>タスク管理
                </button>
                <button class="nav-tab" data-tab="schedule" onclick="switchTab('schedule')">
                    <i class="fas fa-calendar mr-2"></i>スケジュール
                </button>
                <button class="nav-tab" data-tab="sales" onclick="switchTab('sales')">
                    <i class="fas fa-chart-bar mr-2"></i>売上分析
                </button>
                <button class="nav-tab" data-tab="goals" onclick="switchTab('goals')">
                    <i class="fas fa-target mr-2"></i>目標管理
                </button>
                <button class="nav-tab" data-tab="design" onclick="switchTab('design')">
                    <i class="fas fa-palette mr-2"></i>デザイン部門
                </button>
                <button class="nav-tab" data-tab="tools" onclick="switchTab('tools')">
                    <i class="fas fa-tools mr-2"></i>ツール
                </button>
            </div>
        </div>

        <!-- ダッシュボードタブ -->
        <div id="dashboardTab" class="tab-content mx-4">
            <!-- 統計カード -->
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
                <div class="stats-card">
                    <div class="text-2xl font-bold text-purple-600 mb-2" id="totalTasks">0</div>
                    <div class="text-sm text-gray-600">総タスク数</div>
                </div>
                <div class="stats-card">
                    <div class="text-2xl font-bold text-green-600 mb-2" id="completedTasks">0</div>
                    <div class="text-sm text-gray-600">完了済み</div>
                </div>
                <div class="stats-card">
                    <div class="text-2xl font-bold text-red-600 mb-2" id="urgentTasks">0</div>
                    <div class="text-sm text-gray-600">緊急タスク</div>
                </div>
                <div class="stats-card">
                    <div class="text-2xl font-bold text-blue-600 mb-2" id="totalEvents">0</div>
                    <div class="text-sm text-gray-600">予定数</div>
                </div>
                <div class="stats-card">
                    <div class="text-2xl font-bold text-yellow-600 mb-2" id="totalStores">10</div>
                    <div class="text-sm text-gray-600">運営店舗</div>
                </div>
                <div class="stats-card">
                    <div class="text-2xl font-bold text-indigo-600 mb-2" id="designProjects">0</div>
                    <div class="text-sm text-gray-600">デザイン案件</div>
                </div>
            </div>

            <!-- クイック概要 -->
            <div class="dashboard-grid">
                <div class="col-span-4">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-pie mr-2 text-purple-600"></i>今日の進捗
                        </h3>
                        <div class="flex items-center justify-center">
                            <div class="relative w-32 h-32">
                                <svg class="w-32 h-32 progress-ring">
                                    <circle cx="64" cy="64" r="56" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                                    <circle id="progressCircle" cx="64" cy="64" r="56" stroke="#667eea" stroke-width="8" 
                                            fill="none" stroke-linecap="round" class="progress-ring-fill"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span id="progressText" class="text-xl font-bold text-gray-900">0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <p class="text-sm text-gray-600">タスク完了率</p>
                        </div>
                    </div>
                </div>

                <div class="col-span-8">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-exclamation-triangle mr-2 text-red-600"></i>緊急・重要事項
                        </h3>
                        <div id="urgentItems" class="space-y-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- タスク管理タブ -->
        <div id="tasksTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-8">
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-tasks mr-2 text-purple-600"></i>全社タスク管理
                            </h3>
                            <div class="flex space-x-2">
                                <select id="taskFilter" class="input-field w-40" onchange="filterTasks()">
                                    <option value="all">すべて</option>
                                    <option value="urgent">緊急</option>
                                    <option value="high">重要</option>
                                    <option value="normal">通常</option>
                                    <option value="completed">完了済み</option>
                                </select>
                                <select id="taskStore" class="input-field w-40" onchange="filterTasks()">
                                    <option value="all">全店舗</option>
                                    <option value="classy_tokyo">CLASSY東京</option>
                                    <option value="classy_nagoya">CLASSY名古屋</option>
                                    <option value="classy_yokkaichi">CLASSY四日市</option>
                                    <option value="grandopera_tokyo">GrandOpera東京</option>
                                    <option value="grandopera_yokohama">GrandOpera横浜</option>
                                    <option value="grandopera_nagoya">GrandOpera名古屋</option>
                                    <option value="grandopera_fukuoka">GrandOpera福岡</option>
                                    <option value="wancarat">ワンカラット</option>
                                    <option value="shabour">シャブール</option>
                                    <option value="opera_nishiki">オペラ錦</option>
                                    <option value="design">デザイン部門</option>
                                    <option value="head_office">本社</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="taskList" class="space-y-3 mb-6 max-h-96 overflow-y-auto"></div>
                        
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">新しいタスクを追加</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                <input id="newTaskTitle" type="text" class="input-field" placeholder="タスク名">
                                <select id="newTaskStore" class="input-field">
                                    <option value="head_office">本社</option>
                                    <option value="classy_tokyo">CLASSY東京</option>
                                    <option value="classy_nagoya">CLASSY名古屋</option>
                                    <option value="classy_yokkaichi">CLASSY四日市</option>
                                    <option value="grandopera_tokyo">GrandOpera東京</option>
                                    <option value="grandopera_yokohama">GrandOpera横浜</option>
                                    <option value="grandopera_nagoya">GrandOpera名古屋</option>
                                    <option value="grandopera_fukuoka">GrandOpera福岡</option>
                                    <option value="wancarat">ワンカラット</option>
                                    <option value="shabour">シャブール</option>
                                    <option value="opera_nishiki">オペラ錦</option>
                                    <option value="design">デザイン部門</option>
                                </select>
                                <select id="newTaskPriority" class="input-field">
                                    <option value="normal">通常</option>
                                    <option value="high">重要</option>
                                    <option value="urgent">緊急</option>
                                </select>
                                <input id="newTaskDue" type="date" class="input-field">
                            </div>
                            <textarea id="newTaskDescription" class="input-field mb-3" rows="2" placeholder="詳細説明"></textarea>
                            <button onclick="addTask()" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i>タスクを追加
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-span-4">
                    <div class="glass-card p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-bar mr-2 text-green-600"></i>タスク統計
                        </h3>
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span>完了率</span>
                                <span id="taskCompletionRate">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="taskProgressBar" class="bg-green-500 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-center">
                                <div>
                                    <div class="text-xl font-bold text-red-600" id="overdueCount">0</div>
                                    <div class="text-xs text-gray-600">期限切れ</div>
                                </div>
                                <div>
                                    <div class="text-xl font-bold text-yellow-600" id="dueTodayCount">0</div>
                                    <div class="text-xs text-gray-600">今日期限</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-bell mr-2 text-yellow-600"></i>アラート設定
                        </h3>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="alertDeadline" class="mr-2" checked>
                                <span class="text-sm">期限前通知</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="alertOverdue" class="mr-2" checked>
                                <span class="text-sm">期限切れ通知</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="alertMilestone" class="mr-2" checked>
                                <span class="text-sm">マイルストーン通知</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- スケジュール管理タブ -->
        <div id="scheduleTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-8">
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-calendar mr-2 text-blue-600"></i>カレンダー
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="prevMonth()" class="btn btn-secondary">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span id="currentMonth" class="px-4 py-2 font-semibold"></span>
                                <button onclick="nextMonth()" class="btn btn-secondary">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div id="calendar" class="grid grid-cols-7 gap-2 mb-6"></div>
                        
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">予定を追加</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                <input id="newEventTitle" type="text" class="input-field" placeholder="予定名">
                                <input id="newEventDate" type="date" class="input-field">
                                <input id="newEventTime" type="time" class="input-field">
                                <select id="newEventType" class="input-field">
                                    <option value="meeting">会議</option>
                                    <option value="deadline">締切</option>
                                    <option value="event">イベント</option>
                                    <option value="reminder">リマインダー</option>
                                    <option value="goal_setting">目標設定日</option>
                                </select>
                            </div>
                            <textarea id="newEventDescription" class="input-field mb-3" rows="2" placeholder="詳細"></textarea>
                            <button onclick="addEvent()" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i>予定を追加
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-span-4">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-list mr-2 text-green-600"></i>今日の予定
                        </h3>
                        <div id="todayEvents" class="space-y-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 売上分析タブ -->
        <div id="salesTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-12">
                    <div class="glass-card p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-chart-line mr-2 text-green-600"></i>売上データ分析・業務管理
                            </h3>
                            <div class="flex space-x-2">
                                <input type="file" id="salesFileInput" accept=".csv,.xlsx,.xls" class="hidden" onchange="uploadSalesData(event)">
                                <button onclick="document.getElementById('salesFileInput').click()" class="btn btn-primary">
                                    <i class="fas fa-upload mr-2"></i>Excel/CSV読込
                                </button>
                                <button onclick="downloadSalesTemplate()" class="btn btn-secondary">
                                    <i class="fas fa-download mr-2"></i>テンプレート
                                </button>
                                <button onclick="loadSampleData()" class="btn btn-success">
                                    <i class="fas fa-database mr-2"></i>サンプルデータ
                                </button>
                            </div>
                        </div>
                        
                        <div id="salesUploadArea" class="text-center py-12 border-2 border-dashed border-gray-300 rounded-lg">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 mb-2">売上Excel/CSVファイルをアップロードしてください</p>
                            <p class="text-sm text-gray-400">対応形式: .xlsx, .xls, .csv | ドラッグ&ドロップまたはクリック</p>
                            <div class="mt-4 text-sm text-blue-600">
                                <i class="fas fa-info-circle mr-2"></i>
                                業務管理.xlsxファイルを直接読み込み可能
                            </div>
                        </div>
                        
                        <div id="salesAnalysis" class="hidden">
                            <!-- 全体統計 -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="stats-card">
                                    <div class="text-xl font-bold text-green-600 mb-2" id="totalSales">¥0</div>
                                    <div class="text-sm text-gray-600">総売上</div>
                                </div>
                                <div class="stats-card">
                                    <div class="text-xl font-bold text-blue-600 mb-2" id="averageSales">¥0</div>
                                    <div class="text-sm text-gray-600">平均売上</div>
                                </div>
                                <div class="stats-card">
                                    <div class="text-xl font-bold text-purple-600 mb-2" id="topStore">-</div>
                                    <div class="text-sm text-gray-600">最高売上店舗</div>
                                </div>
                                <div class="stats-card">
                                    <div class="text-xl font-bold text-orange-600 mb-2" id="growthRate">0%</div>
                                    <div class="text-sm text-gray-600">週間成長率</div>
                                </div>
                            </div>
                            
                            <!-- 店舗別分析セクション -->
                            <div class="glass-card p-6 mb-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h4 class="font-semibold flex items-center">
                                        <i class="fas fa-store mr-2 text-blue-600"></i>店舗別詳細分析
                                    </h4>
                                    <div class="flex space-x-3">
                                        <select id="storeSelector" class="input-field w-48" onchange="showStoreDetails()">
                                            <option value="">全店舗概要</option>
                                            <option value="CLASSY四日市">CLASSY四日市</option>
                                            <option value="CLASSY東京">CLASSY東京</option>
                                            <option value="CLASSY名古屋">CLASSY名古屋</option>
                                            <option value="GrandOpera東京">GrandOpera東京</option>
                                            <option value="GrandOpera横浜">GrandOpera横浜</option>
                                            <option value="GrandOpera名古屋">GrandOpera名古屋</option>
                                            <option value="GrandOpera福岡">GrandOpera福岡</option>
                                            <option value="オペラ錦">オペラ錦</option>
                                            <option value="シャブール">シャブール</option>
                                            <option value="ワンカラット">ワンカラット</option>
                                        </select>
                                        <select id="periodSelector" class="input-field w-32" onchange="updateStorePeriod()">
                                            <option value="30">30日間</option>
                                            <option value="14">2週間</option>
                                            <option value="7">1週間</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- 全店舗概要表示 -->
                                <div id="allStoresView">
                                    <div class="chart-container mb-6">
                                        <h5 class="font-semibold mb-4">店舗別売上チャート</h5>
                                        <canvas id="salesChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                                
                                <!-- 個別店舗詳細表示 -->
                                <div id="individualStoreView" class="hidden">
                                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                        <!-- 店舗KPI -->
                                        <div class="lg:col-span-1">
                                            <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-6">
                                                <h5 class="font-semibold mb-4 text-gray-800" id="selectedStoreName">店舗名</h5>
                                                <div class="space-y-4">
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">総売上</span>
                                                        <span class="font-bold text-lg text-green-600" id="storeDetailSales">¥0</span>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">日平均売上</span>
                                                        <span class="font-bold text-blue-600" id="storeDetailAvgSales">¥0</span>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">写メ日記 (日平均)</span>
                                                        <span class="font-bold text-purple-600" id="storeDetailDiary">0件/日</span>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">日平均写メ日記</span>
                                                        <span class="font-bold text-purple-600" id="storeDetailAvgDiary">0件/日</span>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">口コミ (日平均)</span>
                                                        <span class="font-bold text-orange-600" id="storeDetailReviews">0件/日</span>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">口コミ転換率</span>
                                                        <span class="font-bold text-green-600" id="storeDetailConversion">0%</span>
                                                    </div>
                                                    <div class="pt-3 border-t">
                                                        <div class="flex justify-between items-center">
                                                            <span class="text-sm text-gray-600">店舗ランキング</span>
                                                            <span class="font-bold text-xl" id="storeDetailRank">#1</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 売上推移グラフ -->
                                        <div class="lg:col-span-2">
                                            <div class="bg-white rounded-lg p-6 border">
                                                <h5 class="font-semibold mb-4">売上推移</h5>
                                                <canvas id="storeDetailChart" width="600" height="300"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 詳細データテーブル -->
                                    <div class="bg-white rounded-lg p-6 border">
                                        <h5 class="font-semibold mb-4">日別詳細データ</h5>
                                        <div class="overflow-x-auto">
                                            <table id="storeDetailTable" class="w-full text-sm">
                                                <thead class="bg-gray-50">
                                                    <tr>
                                                        <th class="px-4 py-2 text-left">日付</th>
                                                        <th class="px-4 py-2 text-right">売上</th>
                                                        <th class="px-4 py-2 text-right">写メ日記</th>
                                                        <th class="px-4 py-2 text-right">口コミ</th>
                                                        <th class="px-4 py-2 text-right">転換率</th>
                                                        <th class="px-4 py-2 text-center">目標達成</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="storeDetailTableBody">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    
                                    <!-- 店舗別アクションプラン -->
                                    <div class="bg-white rounded-lg p-6 border mt-6">
                                        <h5 class="font-semibold mb-4 flex items-center">
                                            <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>店舗別改善提案
                                        </h5>
                                        <div id="storeActionPlan" class="space-y-3">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 目標管理タブ -->
        <div id="goalsTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-6">
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-target mr-2 text-red-600"></i>月次目標設定
                            </h3>
                            <div class="text-sm text-gray-600">
                                次回設定日: <span id="nextGoalDate" class="font-semibold">2025年7月2日</span>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <label class="font-medium">対象月</label>
                                <div class="flex space-x-2">
                                    <input type="month" id="goalMonth" class="input-field w-48" value="2025-07" onchange="loadExistingGoals(this.value); loadGoalProgress();">
                                    <button onclick="copyPreviousMonthGoals()" class="btn btn-secondary">
                                        <i class="fas fa-copy mr-2"></i>前月コピー
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="goalSettings" class="space-y-6">
                            <!-- 店舗別目標設定 -->
                        </div>
                        
                        <div class="flex space-x-3 mt-6">
                            <button onclick="saveGoals()" class="btn btn-primary flex-1">
                                <i class="fas fa-save mr-2"></i>目標を保存
                            </button>
                            <button onclick="generateGoalReport()" class="btn btn-secondary">
                                <i class="fas fa-file-alt mr-2"></i>レポート
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-span-6">
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-chart-pie mr-2 text-blue-600"></i>目標達成状況
                            </h3>
                            <div class="flex space-x-2">
                                <select id="goalViewMode" class="input-field w-32" onchange="loadGoalProgress()">
                                    <option value="overview">概要</option>
                                    <option value="detailed">詳細</option>
                                </select>
                                <button onclick="refreshGoalData()" class="btn btn-secondary">
                                    <i class="fas fa-sync mr-2"></i>更新
                                </button>
                            </div>
                        </div>
                        
                        <!-- 全体進捗サマリー -->
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <div class="text-2xl font-bold text-green-600" id="overallSalesAchievement">0%</div>
                                <div class="text-sm text-gray-600">売上達成率</div>
                            </div>
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600" id="overallDiaryAchievement">0%</div>
                                <div class="text-sm text-gray-600">写メ日記達成率<br>(日平均)</div>
                            </div>
                            <div class="text-center p-4 bg-orange-50 rounded-lg">
                                <div class="text-2xl font-bold text-orange-600" id="overallReviewAchievement">0%</div>
                                <div class="text-sm text-gray-600">口コミ達成率<br>(月合計)</div>
                            </div>
                        </div>
                        
                        <div id="goalProgress" class="space-y-4">
                            <!-- 目標進捗表示 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 詳細分析セクション -->
            <div class="glass-card p-6 mt-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-analytics mr-2 text-indigo-600"></i>目標分析・改善提案
                </h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 達成状況チャート -->
                    <div>
                        <h4 class="font-semibold mb-4">店舗別達成状況</h4>
                        <canvas id="goalAchievementChart" width="400" height="300"></canvas>
                    </div>
                    
                    <!-- 改善提案 -->
                    <div>
                        <h4 class="font-semibold mb-4">改善提案・アクションプラン</h4>
                        <div id="goalActionPlan" class="space-y-3 max-h-64 overflow-y-auto">
                            <!-- 動的に生成される改善提案 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- デザイン部門タブ -->
        <div id="designTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-8">
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-palette mr-2 text-pink-600"></i>デザイン案件管理
                            </h3>
                            <div class="flex space-x-2">
                                <select id="designFilter" class="input-field w-40" onchange="filterDesignProjects()">
                                    <option value="all">すべて</option>
                                    <option value="planning">企画中</option>
                                    <option value="designing">デザイン中</option>
                                    <option value="review">レビュー中</option>
                                    <option value="completed">完了</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="designProjectList" class="space-y-3 mb-6 max-h-96 overflow-y-auto"></div>
                        
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">新しい案件を追加</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                <input id="newDesignTitle" type="text" class="input-field" placeholder="案件名">
                                <select id="newDesignType" class="input-field">
                                    <option value="logo">ロゴデザイン</option>
                                    <option value="flyer">チラシ・フライヤー</option>
                                    <option value="web">Webデザイン</option>
                                    <option value="banner">バナー制作</option>
                                    <option value="package">パッケージデザイン</option>
                                    <option value="interior">店舗内装</option>
                                    <option value="other">その他</option>
                                </select>
                                <select id="newDesignPriority" class="input-field">
                                    <option value="normal">通常</option>
                                    <option value="high">重要</option>
                                    <option value="urgent">緊急</option>
                                </select>
                                <input id="newDesignDue" type="date" class="input-field">
                                <input id="newDesignClient" type="text" class="input-field" placeholder="依頼者・店舗">
                                <select id="newDesignStatus" class="input-field">
                                    <option value="planning">企画中</option>
                                    <option value="designing">デザイン中</option>
                                    <option value="review">レビュー中</option>
                                </select>
                            </div>
                            <textarea id="newDesignDescription" class="input-field mb-3" rows="3" placeholder="詳細・要件"></textarea>
                            <button onclick="addDesignProject()" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i>案件を追加
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-span-4">
                    <div class="glass-card p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-doughnut mr-2 text-purple-600"></i>案件状況
                        </h3>
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span class="text-sm">企画中</span>
                                <span id="planningCount" class="font-bold text-blue-600">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm">デザイン中</span>
                                <span id="designingCount" class="font-bold text-yellow-600">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm">レビュー中</span>
                                <span id="reviewCount" class="font-bold text-purple-600">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm">完了</span>
                                <span id="designCompletedCount" class="font-bold text-green-600">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-clock mr-2 text-orange-600"></i>締切迫る案件
                        </h3>
                        <div id="urgentDesignProjects" class="space-y-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ツールタブ -->
        <div id="toolsTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-6">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-brain mr-2 text-purple-600"></i>プロンプト集
                        </h3>
                        
                        <div class="flex flex-wrap gap-2 mb-4" id="promptCategoryTabs">
                            <button class="nav-tab active" data-category="all" onclick="switchPromptCategory('all')">すべて</button>
                            <button class="nav-tab" data-category="line" onclick="switchPromptCategory('line')">LINE</button>
                            <button class="nav-tab" data-category="sns" onclick="switchPromptCategory('sns')">SNS</button>
                            <button class="nav-tab" data-category="report" onclick="switchPromptCategory('report')">報告</button>
                            <button class="nav-tab" data-category="design" onclick="switchPromptCategory('design')">デザイン</button>
                        </div>

                        <div id="promptList" class="space-y-3 mb-6 max-h-64 overflow-y-auto"></div>
                        
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">新しいプロンプトを追加</h4>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <select id="newPromptCategory" class="input-field">
                                    <option value="line">LINE用</option>
                                    <option value="sns">SNS用</option>
                                    <option value="report">報告用</option>
                                    <option value="design">デザイン用</option>
                                    <option value="other">その他</option>
                                </select>
                                <input id="newPromptLabel" type="text" class="input-field" placeholder="ボタン名">
                            </div>
                            <textarea id="newPromptText" class="input-field mb-3" rows="3" placeholder="プロンプト内容"></textarea>
                            <button onclick="addPrompt()" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i>プロンプトを追加
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-span-6">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-sticky-note mr-2 text-yellow-600"></i>メモ・ふせん
                        </h3>
                        
                        <div class="flex justify-between items-center mb-4">
                            <select id="memoDateSelector" class="input-field w-40" onchange="loadSelectedMemo()">
                                <option value="">今日のメモ</option>
                            </select>
                            <button onclick="clearMemo()" class="btn btn-warning">
                                <i class="fas fa-eraser mr-2"></i>クリア
                            </button>
                        </div>
                        
                        <div class="mb-3 text-sm text-gray-600">
                            <i class="fas fa-clock mr-2"></i>
                            <span id="memoSaveDate"></span>
                        </div>
                        
                        <textarea id="memoArea" class="input-field resize-none" rows="12" 
                                placeholder="気づき・指示事項・重要なポイントをメモ..."></textarea>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid mt-6">
                <div class="col-span-12">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-cogs mr-2 text-gray-600"></i>システム管理
                        </h3>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="exportAllData()" class="btn btn-secondary">
                                <i class="fas fa-download mr-2"></i>全データ出力
                            </button>
                            <button onclick="importAllData()" class="btn btn-secondary">
                                <i class="fas fa-upload mr-2"></i>データ取込
                            </button>
                            <button onclick="clearAllData()" class="btn btn-danger">
                                <i class="fas fa-trash mr-2"></i>全データ削除
                            </button>
                            <button onclick="generateReport()" class="btn btn-primary">
                                <i class="fas fa-file-alt mr-2"></i>レポート生成
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- モーダル -->
    <div id="notificationModal" class="modal">
        <div class="modal-content w-96">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">通知・アラート</h3>
                <button onclick="closeModal('notificationModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="notificationList" class="space-y-3 max-h-64 overflow-y-auto"></div>
        </div>
    </div>

    <!-- 隠しファイル入力 -->
    <input type="file" id="importFileInput" accept=".json" class="hidden" onchange="handleDataImport(event)">

    <script>
        // グローバル変数
        const CORRECT_PASSWORD = 'iam1104JP';
        const SESSION_DURATION = 30 * 60 * 1000;
        const MAX_LOGIN_ATTEMPTS = 5;
        
        let currentTab = 'dashboard';
        let currentPromptCategory = 'all';
        let currentDesignFilter = 'all';
        let loginAttempts = parseInt(localStorage.getItem('loginAttempts') || '0');
        let sessionTimer = null;
        let notifications = [];
        let currentMonth = new Date();
        
        // データ管理キー
        const STORAGE_KEYS = {
            tasks: 'rispondere_tasks',
            events: 'rispondere_events', 
            prompts: 'rispondere_prompts',
            designProjects: 'rispondere_design_projects',
            goals: 'rispondere_goals',
            salesData: 'rispondere_sales_data',
            memos: 'rispondere_memos_'
        };

        // 店舗リスト
        const STORES = [
            { id: 'classy_tokyo', name: 'CLASSY東京' },
            { id: 'classy_nagoya', name: 'CLASSY名古屋' },
            { id: 'classy_yokkaichi', name: 'CLASSY四日市' },
            { id: 'grandopera_tokyo', name: 'GrandOpera東京' },
            { id: 'grandopera_yokohama', name: 'GrandOpera横浜' },
            { id: 'grandopera_nagoya', name: 'GrandOpera名古屋' },
            { id: 'grandopera_fukuoka', name: 'GrandOpera福岡' },
            { id: 'wancarat', name: 'ワンカラット' },
            { id: 'shabour', name: 'シャブール' },
            { id: 'opera_nishiki', name: 'オペラ錦' }
        ];

        // 売上分析・店舗別詳細分析
        let currentSalesData = [];
        let currentStoreStats = {};

        // 初期化
        window.onload = () => {
            checkAuthentication();
            updateDateTime();
            setInterval(updateDateTime, 60000);
            setupEventListeners();
            checkAlerts();
            setInterval(checkAlerts, 60000);
        };

        // 認証処理
        function checkAuthentication() {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            const loginTime = sessionStorage.getItem('loginTime');
            
            if (isLoggedIn && loginTime) {
                const elapsed = Date.now() - parseInt(loginTime);
                if (elapsed < SESSION_DURATION) {
                    showDashboard();
                    startSessionTimer(SESSION_DURATION - elapsed);
                    return;
                }
            }
            
            showLoginScreen();
        }

        function handleLogin(event) {
            event.preventDefault();
            const password = document.getElementById('passwordInput').value;
            
            if (password === CORRECT_PASSWORD) {
                sessionStorage.setItem('isLoggedIn', 'true');
                sessionStorage.setItem('loginTime', Date.now().toString());
                localStorage.removeItem('loginAttempts');
                loginAttempts = 0;
                
                showDashboard();
                startSessionTimer(SESSION_DURATION);
                showNotification('ログインしました', 'success');
                document.getElementById('passwordInput').value = '';
            } else {
                loginAttempts++;
                localStorage.setItem('loginAttempts', loginAttempts.toString());
                
                if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                    showNotification(`セキュリティのため${MAX_LOGIN_ATTEMPTS}分間ロックされました`, 'error');
                    lockLogin();
                } else {
                    showNotification(`パスワードが間違っています (${loginAttempts}/${MAX_LOGIN_ATTEMPTS})`, 'error');
                    updateLoginAttemptDisplay();
                }
                document.getElementById('passwordInput').value = '';
            }
        }

        function updateLoginAttemptDisplay() {
            const attemptsDiv = document.getElementById('loginAttempts');
            const countSpan = document.getElementById('attemptCount');
            
            if (loginAttempts > 0) {
                countSpan.textContent = loginAttempts;
                attemptsDiv.classList.remove('hidden');
            }
        }

        function lockLogin() {
            const passwordInput = document.getElementById('passwordInput');
            const submitBtn = document.querySelector('button[type="submit"]');
            
            passwordInput.disabled = true;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-lock mr-2"></i>ロック中...';
            
            setTimeout(() => {
                passwordInput.disabled = false;
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>ログイン';
                localStorage.removeItem('loginAttempts');
                loginAttempts = 0;
                document.getElementById('loginAttempts').classList.add('hidden');
                showNotification('ロックが解除されました', 'info');
            }, 5 * 60 * 1000);
        }

        function logout() {
            if (confirm('ログアウトしますか？')) {
                sessionStorage.removeItem('isLoggedIn');
                sessionStorage.removeItem('loginTime');
                
                if (sessionTimer) {
                    clearInterval(sessionTimer);
                }
                
                showLoginScreen();
                showNotification('ログアウトしました', 'info');
            }
        }

        function startSessionTimer(duration) {
            const timerElement = document.getElementById('timeRemaining');
            const sessionTimerDiv = document.getElementById('sessionTimer');
            
            sessionTimerDiv.classList.remove('hidden');
            
            sessionTimer = setInterval(() => {
                duration -= 1000;
                
                if (duration <= 0) {
                    clearInterval(sessionTimer);
                    showNotification('セッションがタイムアウトしました', 'warning');
                    logout();
                    return;
                }
                
                const minutes = Math.floor(duration / 60000);
                const seconds = Math.floor((duration % 60000) / 1000);
                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (duration < 5 * 60 * 1000) {
                    sessionTimerDiv.style.backgroundColor = 'rgba(239, 68, 68, 0.8)';
                }
            }, 1000);
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainDashboard').classList.add('hidden');
            document.getElementById('sessionTimer').classList.add('hidden');
            updateLoginAttemptDisplay();
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainDashboard').classList.remove('hidden');
            loadAllData();
            updateAllStats();
        }

        // 日時更新
        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('ja-JP', { 
                year: 'numeric', 
                month: 'numeric', 
                day: 'numeric',
                weekday: 'short'
            });
            const timeStr = now.toLocaleTimeString('ja-JP', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const currentDateElement = document.getElementById('currentDate');
            const currentTimeElement = document.getElementById('currentTime');
            
            if (currentDateElement) currentDateElement.textContent = dateStr;
            if (currentTimeElement) currentTimeElement.textContent = timeStr;
        }

        // タブ切り替え
        function switchTab(tabName) {
            // タブボタンの更新
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // コンテンツの切り替え
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}Tab`).classList.remove('hidden');
            
            currentTab = tabName;
            
            // タブ固有の初期化
            switch(tabName) {
                case 'schedule':
                    renderCalendar();
                    loadTodayEvents();
                    break;
                case 'tasks':
                    loadTasks();
                    updateTaskStats();
                    break;
                case 'design':
                    loadDesignProjects();
                    updateDesignStats();
                    break;
                case 'goals':
                    initGoalSettings();
                    loadGoalProgress();
                    break;
                case 'sales':
                    // 売上タブの初期化
                    break;
                case 'tools':
                    loadPrompts();
                    loadMemo();
                    updateMemoDateSelector();
                    break;
            }
        }

        // 売上分析機能
        function showStoreDetails() {
            const selectedStore = document.getElementById('storeSelector').value;
            const allStoresView = document.getElementById('allStoresView');
            const individualStoreView = document.getElementById('individualStoreView');
            
            if (!selectedStore) {
                // 全店舗概要表示
                allStoresView.classList.remove('hidden');
                individualStoreView.classList.add('hidden');
                renderSalesChart(currentStoreStats);
            } else {
                // 個別店舗詳細表示
                allStoresView.classList.add('hidden');
                individualStoreView.classList.remove('hidden');
                renderStoreDetails(selectedStore);
            }
        }

        function renderStoreDetails(storeName) {
            const storeData = getStoreData(storeName);
            const period = parseInt(document.getElementById('periodSelector').value);
            
            // 基本情報の表示
            document.getElementById('selectedStoreName').textContent = storeName;
            document.getElementById('storeDetailSales').textContent = `¥${storeData.totalSales.toLocaleString()}`;
            document.getElementById('storeDetailAvgSales').textContent = `¥${Math.round(storeData.avgSales).toLocaleString()}`;
            document.getElementById('storeDetailDiary').textContent = `${Math.round(storeData.totalDiary / storeData.days * 10) / 10}件/日`;
            document.getElementById('storeDetailAvgDiary').textContent = `${Math.round(storeData.avgDiary)}件/日`;
            document.getElementById('storeDetailReviews').textContent = `${Math.round(storeData.totalReviews / storeData.days * 10) / 10}件/日`;
            document.getElementById('storeDetailConversion').textContent = `${storeData.conversionRate.toFixed(1)}%`;
            document.getElementById('storeDetailRank').textContent = `#${storeData.rank}`;
            
            // ランキングに応じた表示色変更
            const rankElement = document.getElementById('storeDetailRank');
            if (storeData.rank <= 3) {
                rankElement.className = 'font-bold text-xl text-yellow-600';
                rankElement.innerHTML = `${storeData.rank === 1 ? '🥇' : storeData.rank === 2 ? '🥈' : '🥉'} #${storeData.rank}`;
            } else {
                rankElement.className = 'font-bold text-xl text-gray-600';
            }
            
            // 売上推移チャート
            renderStoreDetailChart(storeData.dailyData, storeName);
            
            // 詳細テーブル
            renderStoreDetailTable(storeData.dailyData, storeName);
            
            // 店舗別アクションプラン
            generateStoreActionPlan(storeName, storeData);
        }

        function getStoreData(storeName) {
            const period = parseInt(document.getElementById('periodSelector').value);
            const storeData = currentSalesData.filter(row => 
                (row.店舗 || row.店舗名) === storeName
            );
            
            // 期間でフィルタリング
            const today = new Date();
            const cutoffDate = new Date(today.getTime() - (period * 24 * 60 * 60 * 1000));
            
            const filteredData = storeData.filter(row => {
                const date = new Date(row.日付);
                return date >= cutoffDate;
            }).sort((a, b) => new Date(a.日付) - new Date(b.日付));
            
            // 統計計算
            const totalSales = filteredData.reduce((sum, row) => sum + (row.売上 || 0), 0);
            const totalDiary = filteredData.reduce((sum, row) => sum + (row.写メ日記 || 0), 0);
            const totalReviews = filteredData.reduce((sum, row) => sum + (row.口コミ || 0), 0);
            const days = filteredData.length;
            
            const avgSales = days > 0 ? totalSales / days : 0;
            const avgDiary = days > 0 ? totalDiary / days : 0;
            const conversionRate = totalDiary > 0 ? (totalReviews / totalDiary) * 100 : 0;
            
            // ランキング計算
            const allStoreRanking = Object.entries(currentStoreStats)
                .sort(([,a], [,b]) => b.総売上 - a.総売上);
            const rank = allStoreRanking.findIndex(([store,]) => store === storeName) + 1;
            
            return {
                dailyData: filteredData,
                totalSales,
                totalDiary,
                totalReviews,
                avgSales,
                avgDiary,
                conversionRate,
                rank,
                days
            };
        }

        function renderStoreDetailChart(dailyData, storeName) {
            const canvas = document.getElementById('storeDetailChart');
            if (!canvas || dailyData.length === 0) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const maxSales = Math.max(...dailyData.map(d => d.売上 || 0));
            const chartWidth = canvas.width - 100;
            const chartHeight = canvas.height - 80;
            
            // 軸の描画
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            // Y軸
            ctx.beginPath();
            ctx.moveTo(60, 20);
            ctx.lineTo(60, chartHeight + 20);
            ctx.stroke();
            
            // X軸
            ctx.beginPath();
            ctx.moveTo(60, chartHeight + 20);
            ctx.lineTo(chartWidth + 60, chartHeight + 20);
            ctx.stroke();
            
            // グリッド線
            ctx.strokeStyle = '#f3f4f6';
            for (let i = 1; i <= 5; i++) {
                const y = 20 + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(60, y);
                ctx.lineTo(chartWidth + 60, y);
                ctx.stroke();
            }
            
            // データライン
            ctx.strokeStyle = '#3b82f6';
            ctx.fillStyle = '#3b82f6';
            ctx.lineWidth = 3;
            
            ctx.beginPath();
            dailyData.forEach((item, index) => {
                const x = 60 + (index / Math.max(dailyData.length - 1, 1)) * chartWidth;
                const y = 20 + chartHeight - ((item.売上 || 0) / maxSales) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                
                // データポイント
                ctx.fillRect(x - 3, y - 3, 6, 6);
            });
            ctx.stroke();
            
            // ラベル
            ctx.fillStyle = '#374151';
            ctx.font = '12px Arial';
            
            // Y軸ラベル
            for (let i = 0; i <= 5; i++) {
                const value = (maxSales / 5) * (5 - i);
                const y = 20 + (chartHeight / 5) * i;
                ctx.textAlign = 'right';
                ctx.fillText(`¥${Math.round(value / 1000)}K`, 55, y + 3);
            }
            
            // 日付ラベル（最初と最後のみ）
            ctx.textAlign = 'center';
            if (dailyData.length > 0) {
                const firstDate = new Date(dailyData[0].日付).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
                const lastDate = new Date(dailyData[dailyData.length - 1].日付).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
                ctx.fillText(firstDate, 60, chartHeight + 40);
                ctx.fillText(lastDate, chartWidth + 60, chartHeight + 40);
            }
        }

        function renderStoreDetailTable(dailyData, storeName) {
            const tableBody = document.getElementById('storeDetailTableBody');
            if (!tableBody) return;
            
            // 目標データの取得
            const currentMonth = new Date().toISOString().substr(0, 7);
            const goals = JSON.parse(localStorage.getItem(STORAGE_KEYS.goals) || '{}');
            const monthGoals = goals[currentMonth] || {};
            
            // 店舗IDの逆引き
            const storeMapping = {
                'CLASSY東京': 'classy_tokyo',
                'CLASSY名古屋': 'classy_nagoya', 
                'CLASSY四日市': 'classy_yokkaichi',
                'GrandOpera東京': 'grandopera_tokyo',
                'GrandOpera横浜': 'grandopera_yokohama',
                'GrandOpera名古屋': 'grandopera_nagoya',
                'GrandOpera福岡': 'grandopera_fukuoka',
                'ワンカラット': 'wancarat',
                'シャブール': 'shabour',
                'オペラ錦': 'opera_nishiki'
            };
            
            const storeId = storeMapping[storeName];
            const storeGoals = storeId ? monthGoals[storeId] : {};
            const dailySalesGoal = storeGoals.sales ? Math.round(storeGoals.sales / 30) : 0;
            const monthlyDiaryGoal = storeGoals.diary || 0; // 月合計
            const dailyDiaryGoal = monthlyDiaryGoal > 0 ? Math.round(monthlyDiaryGoal / 30) : 0; // 日平均目標
            const monthlyReviewGoal = storeGoals.review || 0; // 月合計
            const dailyReviewGoal = monthlyReviewGoal > 0 ? Math.round(monthlyReviewGoal / 30) : 0; // 日平均目標
            
            tableBody.innerHTML = dailyData.slice(-14).reverse().map(item => {
                const sales = item.売上 || 0;
                const diary = item.写メ日記 || 0;
                const reviews = item.口コミ || 0;
                const conversionRate = diary > 0 ? (reviews / diary * 100).toFixed(1) : '0.0';
                
                // 目標達成状況
                const salesAchieved = dailySalesGoal > 0 ? sales >= dailySalesGoal : false;
                const diaryAchieved = dailyDiaryGoal > 0 ? diary >= dailyDiaryGoal : false;
                const reviewAchieved = dailyReviewGoal > 0 ? reviews >= dailyReviewGoal : false;
                
                const achievementScore = [salesAchieved, diaryAchieved, reviewAchieved].filter(Boolean).length;
                const achievementClass = achievementScore === 3 ? 'text-green-600' : achievementScore >= 2 ? 'text-yellow-600' : 'text-red-600';
                const achievementIcon = achievementScore === 3 ? '🟢' : achievementScore >= 2 ? '🟡' : '🔴';
                
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-2">${new Date(item.日付).toLocaleDateString('ja-JP')}</td>
                        <td class="px-4 py-2 text-right font-medium ${salesAchieved ? 'text-green-600' : ''}">${sales.toLocaleString()}</td>
                        <td class="px-4 py-2 text-right ${diaryAchieved ? 'text-green-600' : ''}">${diary}</td>
                        <td class="px-4 py-2 text-right ${reviewAchieved ? 'text-green-600' : ''}">${reviews}</td>
                        <td class="px-4 py-2 text-right">${conversionRate}%</td>
                        <td class="px-4 py-2 text-center">
                            <span class="${achievementClass}" title="${achievementScore}/3 目標達成">
                                ${achievementIcon} ${achievementScore}/3
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function generateStoreActionPlan(storeName, storeData) {
            const container = document.getElementById('storeActionPlan');
            if (!container) return;
            
            const plans = [];
            
            // 売上分析
            if (storeData.rank > 5) {
                plans.push({
                    type: 'warning',
                    title: '売上改善が必要',
                    description: `現在${storeData.rank}位。上位店舗との差を縮める施策が必要です。`,
                    actions: [
                        '集客施策の強化',
                        'サービス品質の向上',
                        '料金体系の見直し'
                    ]
                });
            }
            
            // 口コミ転換率分析
            if (storeData.conversionRate < 5) {
                plans.push({
                    type: 'info',
                    title: '口コミ転換率の改善',
                    description: `現在の転換率${storeData.conversionRate.toFixed(1)}%を向上させましょう。`,
                    actions: [
                        '顧客満足度調査の実施',
                        '口コミ投稿促進キャンペーン',
                        'アフターフォローの充実'
                    ]
                });
            }
            
            // 写メ日記分析
            if (storeData.avgDiary < 50) {
                plans.push({
                    type: 'info',
                    title: '写メ日記投稿数増加',
                    description: `日平均${Math.round(storeData.avgDiary)}件の投稿数を増やしましょう。`,
                    actions: [
                        'キャスト教育の強化',
                        '投稿インセンティブの導入',
                        '投稿コンテンツの質向上'
                    ]
                });
            }
            
            // 好調店舗への提案
            if (storeData.rank <= 3) {
                plans.push({
                    type: 'success',
                    title: '優秀店舗として他店への展開',
                    description: `${storeData.rank}位の好成績。成功要因を他店舗に共有しましょう。`,
                    actions: [
                        '成功事例の文書化',
                        '他店舗への指導・サポート',
                        'ベストプラクティスの標準化'
                    ]
                });
            }
            
            container.innerHTML = plans.map(plan => `
                <div class="border border-${getActionPlanColor(plan.type)}-200 bg-${getActionPlanColor(plan.type)}-50 rounded-lg p-4">
                    <div class="flex items-start">
                        <i class="fas fa-${getActionPlanIcon(plan.type)} text-${getActionPlanColor(plan.type)}-600 mr-3 mt-1"></i>
                        <div class="flex-1">
                            <h6 class="font-medium text-${getActionPlanColor(plan.type)}-800 mb-2">${plan.title}</h6>
                            <p class="text-
