<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLASSYÊ•≠ÂãôÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 4px 0 30px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: all 0.3s ease;
            z-index: 999;
        }
        
        .main-content {
            flex: 1;
            overflow-x: hidden;
        }
        
        @media (max-width: 1023px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: -320px;
                height: 100vh;
                z-index: 999;
            }
            
            .sidebar.active {
                left: 0;
            }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #047857);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        
        .btn-outline {
            background: rgba(255, 255, 255, 0.9);
            color: #3b82f6;
            border: 2px solid rgba(59, 130, 246, 0.3);
        }
        
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 24px;
            width: 95%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            margin: 6px 12px;
            border-radius: 12px;
            color: #64748b;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            transform: translateX(4px);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .hidden { display: none !important; }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            max-width: 300px;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .task-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
            border-left: 4px solid #3b82f6;
            transition: all 0.3s ease;
        }
        
        .task-card.completed {
            opacity: 0.7;
            border-left-color: #10b981;
        }
        
        .task-card.high-priority { border-left-color: #ef4444; }
        .task-card.medium-priority { border-left-color: #f59e0b; }
        .task-card.low-priority { border-left-color: #10b981; }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sync-success { color: #10b981; }
        .sync-error { color: #ef4444; }
        .sync-loading { color: #3b82f6; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
        <div id="sidebar" class="sidebar">
            <div class="p-6">
                <div class="text-center mb-6">
                    <div class="text-2xl font-bold text-gray-900 mb-2">CLASSY</div>
                    <div class="text-sm text-gray-600">Ê•≠ÂãôÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</div>
                    <div class="text-xs text-blue-600 font-medium">Â∑ùÊ∫Ä„Åï„ÇìÂ∞ÇÁî®</div>
                </div>
                
                <nav class="space-y-2">
                    <div class="nav-item active" data-page="dashboard">
                        <i class="fas fa-home mr-3"></i>
                        <span>„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</span>
                    </div>
                    <div class="nav-item" data-page="tasks">
                        <i class="fas fa-tasks mr-3"></i>
                        <span>„Çø„Çπ„ÇØÁÆ°ÁêÜ</span>
                    </div>
                    <div class="nav-item" data-page="sales">
                        <i class="fas fa-chart-line mr-3"></i>
                        <span>Â£≤‰∏äÂàÜÊûê</span>
                    </div>
                    <div class="nav-item" data-page="kpi">
                        <i class="fas fa-chart-bar mr-3"></i>
                        <span>KPIÁÆ°ÁêÜ</span>
                    </div>
                    <div class="nav-item" data-page="calendar">
                        <i class="fas fa-calendar mr-3"></i>
                        <span>„Ç´„É¨„É≥„ÉÄ„Éº</span>
                    </div>
                </nav>
                
                <div class="mt-6 p-4 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-16">
                    <div class="text-center">
                        <div class="text-2xl mb-2">üìä</div>
                        <div class="text-sm font-medium text-blue-800">„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÈÄ£Êê∫</div>
                        <div class="text-xs mb-3" id="syncStatus">
                            <div class="sync-status">
                                <span id="syncIcon">‚è≥</span>
                                <span id="syncText">Ê∫ñÂÇô‰∏≠</span>
                            </div>
                            <div class="text-xs text-gray-600 mt-1" id="lastSync">Êú™ÂêåÊúü</div>
                        </div>
                        <button class="btn btn-primary w-full text-sm" id="syncBtn">
                            <i class="fas fa-sync-alt mr-2"></i>ÂêåÊúü
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <div class="main-content">
            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
            <header class="glass-card m-4">
                <div class="p-4 flex items-center justify-between">
                    <div class="flex items-center">
                        <button id="menuToggle" class="lg:hidden mr-3 p-2 text-gray-600 hover:text-gray-800 rounded-lg">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900">CLASSYÊ•≠ÂãôÁÆ°ÁêÜ</h1>
                            <p class="text-sm text-gray-600" id="currentPageTitle">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <div class="text-right hidden sm:block">
                            <div class="font-semibold text-gray-900 text-sm" id="currentDate"></div>
                            <div class="text-xs text-blue-600" id="currentTime"></div>
                        </div>
                        <button class="btn btn-primary" id="quickActionBtn">
                            <i class="fas fa-plus mr-2"></i>
                            <span class="hidden sm:inline">„ÇØ„Ç§„ÉÉ„ÇØ</span>
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éö„Éº„Ç∏ -->
            <div id="dashboardPage" class="page-content p-4">
                <!-- ÂÖ®‰ΩìÁµ±Ë®à -->
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-6">
                    <div class="glass-card p-4 text-center">
                        <div class="text-2xl font-bold text-blue-600 mb-1" id="totalSales">¬•0M</div>
                        <div class="text-sm text-gray-600">Á∑èÂ£≤‰∏ä</div>
                        <div class="text-xs text-green-600 mt-1" id="totalSalesRate">Ë®àÁÆó‰∏≠</div>
                    </div>
                    <div class="glass-card p-4 text-center">
                        <div class="text-2xl font-bold text-green-600 mb-1" id="totalAccess">0</div>
                        <div class="text-sm text-gray-600">Á∑è„Ç¢„ÇØ„Çª„ÇπÊï∞</div>
                        <div class="text-xs text-green-600 mt-1" id="avgAccess">Âπ≥ÂùáË®àÁÆó‰∏≠</div>
                    </div>
                    <div class="glass-card p-4 text-center">
                        <div class="text-2xl font-bold text-purple-600 mb-1" id="totalAttendance">0</div>
                        <div class="text-sm text-gray-600">Á∑èÂá∫Âã§‰∫∫Êï∞</div>
                        <div class="text-xs text-orange-600 mt-1" id="avgAttendance">Âπ≥ÂùáË®àÁÆó‰∏≠</div>
                    </div>
                    <div class="glass-card p-4 text-center">
                        <div class="text-2xl font-bold text-cyan-600 mb-1" id="achievingStores">0/0</div>
                        <div class="text-sm text-gray-600">ÁõÆÊ®ôÈÅîÊàêÂ∫óËàó</div>
                        <div class="text-xs text-blue-600 mt-1">Â£≤‰∏äÂü∫Ê∫ñ</div>
                    </div>
                </div>
                
                <!-- ‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ -->
                <div class="glass-card p-4 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900">‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ</h3>
                        <button class="btn btn-outline" id="addTaskBtn">
                            <i class="fas fa-plus mr-2"></i>ËøΩÂä†
                        </button>
                    </div>
                    <div id="todayTasksList" class="space-y-3">
                        <div class="text-center text-gray-500 py-4">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
                    </div>
                </div>
                
                <!-- Â∫óËàóÁä∂Ê≥Å -->
                <div class="glass-card p-4">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Â∫óËàóÁä∂Ê≥Å</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="storesOverview">
                        <div class="text-center text-gray-500 py-8">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
                    </div>
                </div>
            </div>
            
            <!-- „Çø„Çπ„ÇØÁÆ°ÁêÜ„Éö„Éº„Ç∏ -->
            <div id="tasksPage" class="page-content p-4 hidden">
                <div class="glass-card p-4 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900">„Çø„Çπ„ÇØÁÆ°ÁêÜ</h3>
                        <button class="btn btn-primary" id="newTaskBtn">
                            <i class="fas fa-plus mr-2"></i>Êñ∞Ë¶è„Çø„Çπ„ÇØ
                        </button>
                    </div>
                    
                    <!-- „Éï„Ç£„É´„Çø„Éº -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-3 mb-4">
                        <input type="text" id="taskSearch" placeholder="„Çø„Çπ„ÇØ„ÇíÊ§úÁ¥¢..." class="input-field">
                        <select id="priorityFilter" class="input-field">
                            <option value="">„Åô„Åπ„Å¶„ÅÆÂÑ™ÂÖàÂ∫¶</option>
                            <option value="high">È´òÂÑ™ÂÖàÂ∫¶</option>
                            <option value="medium">‰∏≠ÂÑ™ÂÖàÂ∫¶</option>
                            <option value="low">‰ΩéÂÑ™ÂÖàÂ∫¶</option>
                        </select>
                        <select id="statusFilter" class="input-field">
                            <option value="">„Åô„Åπ„Å¶„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ</option>
                            <option value="pending">Êú™ÂÆå‰∫Ü</option>
                            <option value="completed">ÂÆå‰∫ÜÊ∏à„Åø</option>
                        </select>
                    </div>
                    
                    <!-- „Çø„Çπ„ÇØ„É™„Çπ„Éà -->
                    <div id="tasksList" class="space-y-3">
                        <div class="text-center text-gray-500 py-4">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
                    </div>
                </div>
            </div>
            
            <!-- Â£≤‰∏äÂàÜÊûê„Éö„Éº„Ç∏ -->
            <div id="salesPage" class="page-content p-4 hidden">
                <div class="glass-card p-4 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Â£≤‰∏äÂàÜÊûê</h3>
                        <select id="salesStoreSelect" class="input-field w-48">
                            <option value="">ÂÖ®Â∫óËàóÁµ±Âêà</option>
                        </select>
                    </div>
                    
                    <!-- Â£≤‰∏äÁµ±Ë®à -->
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-600" id="selectedSales">¬•0M</div>
                            <div class="text-sm text-gray-600">Â£≤‰∏äÂÆüÁ∏æ</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-600" id="selectedTarget">¬•0M</div>
                            <div class="text-sm text-gray-600">Â£≤‰∏äÁõÆÊ®ô</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-purple-600" id="selectedRate">0%</div>
                            <div class="text-sm text-gray-600">ÈÅîÊàêÁéá</div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-orange-600" id="selectedAccess">0</div>
                            <div class="text-sm text-gray-600">„Ç¢„ÇØ„Çª„ÇπÊï∞</div>
                        </div>
                    </div>
                    
                    <!-- „ÉÅ„É£„Éº„Éà -->
                    <div class="bg-white p-4 rounded-lg">
                        <canvas id="salesChart" width="400" height="200"></canvas>
                    </div>
                    
                    <!-- Â∫óËàó„É©„É≥„Ç≠„É≥„Ç∞ -->
                    <div class="mt-6">
                        <h4 class="text-lg font-bold text-gray-900 mb-4">Â∫óËàó„É©„É≥„Ç≠„É≥„Ç∞</h4>
                        <div id="storeRanking" class="space-y-3">
                            <div class="text-center text-gray-500 py-4">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- KPIÁÆ°ÁêÜ„Éö„Éº„Ç∏ -->
            <div id="kpiPage" class="page-content p-4 hidden">
                <div class="glass-card p-4 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900">KPIÁÆ°ÁêÜ</h3>
                        <select id="kpiStoreSelect" class="input-field w-48">
                            <option value="">ÂÖ®Â∫óËàóÁµ±Âêà</option>
                        </select>
                    </div>
                    
                    <!-- KPI„Çµ„Éû„É™„Éº -->
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-600" id="kpiDiaryPosts">0</div>
                            <div class="text-sm text-gray-600">ÂÜô„É°Êó•Ë®òÊäïÁ®øÊï∞</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-600" id="kpiReviews">0</div>
                            <div class="text-sm text-gray-600">Âè£„Ç≥„ÉüÊé≤ËºâÊï∞</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-purple-600" id="kpiKitene">0</div>
                            <div class="text-sm text-gray-600">„Ç≠„ÉÜ„ÉçÈÄÅ‰ø°Êï∞</div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-orange-600" id="kpiUsers">0</div>
                            <div class="text-sm text-gray-600">Á∑è„É¶„Éº„Ç∂„ÉºÊï∞</div>
                        </div>
                    </div>
                    
                    <!-- Â∫óËàóÂà•KPI„ÉÜ„Éº„Éñ„É´ -->
                    <div class="overflow-x-auto">
                        <table class="w-full bg-white rounded-lg">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="text-left p-3 font-semibold text-sm">Â∫óËàó</th>
                                    <th class="text-left p-3 font-semibold text-sm">Â£≤‰∏äÈÅîÊàêÁéá</th>
                                    <th class="text-left p-3 font-semibold text-sm">Êó•Ë®òÈÅîÊàêÁéá</th>
                                    <th class="text-left p-3 font-semibold text-sm">Âè£„Ç≥„ÉüÈÅîÊàêÁéá</th>
                                    <th class="text-left p-3 font-semibold text-sm">„Ç¢„ÇØ„Çª„ÇπÊï∞</th>
                                </tr>
                            </thead>
                            <tbody id="kpiDataTable">
                                <tr><td colspan="5" class="text-center p-4 text-gray-500">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- „Ç´„É¨„É≥„ÉÄ„Éº„Éö„Éº„Ç∏ -->
            <div id="calendarPage" class="page-content p-4 hidden">
                <div class="glass-card p-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-900">„Ç´„É¨„É≥„ÉÄ„Éº</h3>
                        <button class="btn btn-primary" id="addEventBtn">
                            <i class="fas fa-plus mr-2"></i>‰∫àÂÆöËøΩÂä†
                        </button>
                    </div>
                    
                    <!-- „Ç´„É¨„É≥„ÉÄ„Éº„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-xl font-bold text-gray-900" id="calendarTitle">2025Âπ¥7Êúà</h4>
                        <div class="flex space-x-2">
                            <button class="btn btn-outline" id="prevMonthBtn">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="btn btn-outline" id="nextMonthBtn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- ‰ªäÈÄ±„ÅÆ‰∫àÂÆöË°®Á§∫ -->
                    <div id="weeklySchedule" class="grid grid-cols-7 gap-2">
                        <div class="text-center text-gray-500 py-4">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- „Çø„Çπ„ÇØ„É¢„Éº„ÉÄ„É´ -->
    <div id="taskModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-900" id="taskModalTitle">Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ</h3>
                <button id="closeTaskModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">„Çø„Çπ„ÇØÂêç</label>
                    <input type="text" id="taskTitle" class="input-field" placeholder="„Çø„Çπ„ÇØÂêç„ÇíÂÖ•Âäõ">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ë™¨Êòé</label>
                    <textarea id="taskDescription" class="input-field" rows="3" placeholder="Ë©≥Á¥∞Ë™¨Êòé"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ÂÑ™ÂÖàÂ∫¶</label>
                        <select id="taskPriority" class="input-field">
                            <option value="low">‰Ωé</option>
                            <option value="medium" selected>‰∏≠</option>
                            <option value="high">È´ò</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ÊúüÈôê</label>
                        <input type="date" id="taskDueDate" class="input-field">
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button class="btn btn-primary flex-1" id="saveTaskBtn">
                        <i class="fas fa-save mr-2"></i>‰øùÂ≠ò
                    </button>
                    <button class="btn btn-outline" id="cancelTaskBtn">
                        „Ç≠„É£„É≥„Çª„É´
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- „Ç§„Éô„É≥„Éà„É¢„Éº„ÉÄ„É´ -->
    <div id="eventModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-900" id="eventModalTitle">Êñ∞„Åó„ÅÑ‰∫àÂÆö</h3>
                <button id="closeEventModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">‰∫àÂÆöÂêç</label>
                    <input type="text" id="eventTitle" class="input-field" placeholder="‰∫àÂÆöÂêç„ÇíÂÖ•Âäõ">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ë™¨Êòé</label>
                    <textarea id="eventDescription" class="input-field" rows="3" placeholder="Ë©≥Á¥∞Ë™¨Êòé"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Á®ÆÈ°û</label>
                        <select id="eventType" class="input-field">
                            <option value="meeting">‰ºöË≠∞</option>
                            <option value="shooting">ÊíÆÂΩ±</option>
                            <option value="holiday">‰ºëÊ•≠</option>
                            <option value="deadline">Á∑†Âàá</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Êó•‰ªò</label>
                        <input type="date" id="eventDate" class="input-field">
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button class="btn btn-primary flex-1" id="saveEventBtn">
                        <i class="fas fa-save mr-2"></i>‰øùÂ≠ò
                    </button>
                    <button class="btn btn-outline" id="cancelEventBtn">
                        „Ç≠„É£„É≥„Çª„É´
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentPage = 'dashboard';
        let tasks = [];
        let events = [];
        let storeData = [];
        let editingTaskId = null;
        let editingEventId = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let salesChart = null;

        // Google„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàË®≠ÂÆö
        const SPREADSHEET_ID = '1CSGBzK9au8VLEQFCpBJbVyMoTaRhO5hoQd_qk8XC_IQ';

        // Â∫óËàóÊÉÖÂ†±
        const storeInfo = {
            'shabour': { name: '„Ç∑„É£„Éñ„Éº„É´', type: 'Premium' },
            'onecarat': { name: '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà', type: 'Premium' },
            'go_nagoya': { name: 'GOÂêçÂè§Â±ã', type: 'GrandOpera' },
            'go_fukuoka': { name: 'GOÁ¶èÂ≤°', type: 'GrandOpera' },
            'go_tokyo': { name: 'GOÊù±‰∫¨', type: 'GrandOpera' },
            'go_yokohama': { name: 'GOÊ®™Êµú', type: 'GrandOpera' },
            'opera_nishiki': { name: '„Ç™„Éö„É©Èå¶', type: 'GrandOpera' },
            'cl_nagoya': { name: 'CLÂêçÂè§Â±ã', type: 'CLASSY' },
            'cl_tokyo': { name: 'CLÊù±‰∫¨', type: 'CLASSY' },
            'cl_yokkaichi': { name: 'CLÂõõÊó•Â∏Ç', type: 'CLASSY' }
        };

        // „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CLASSYÊ•≠ÂãôÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÈñãÂßã');
            
            try {
                initializeData();
                updateDateTime();
                setInterval(updateDateTime, 60000);
                setupEventListeners();
                renderCurrentPage();
                
                setTimeout(() => {
                    syncWithSpreadsheet();
                }, 1000);
                
                showNotification('„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫ÜÔºÅ', 'success');
                console.log('ÂàùÊúüÂåñÂÆå‰∫Ü');
            } catch (error) {
                console.error('ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                showNotification('„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
            }
        });

        // „Éá„Éº„ÇøÂàùÊúüÂåñ
        function initializeData() {
            loadFromLocalStorage();
            
            if (tasks.length === 0) {
                const today = new Date().toISOString().split('T')[0];
                tasks = [
                    {
                        id: 1,
                        title: '6ÊúàÂ£≤‰∏ä„É¨„Éù„Éº„Éà‰ΩúÊàê',
                        description: 'ÂêÑÂ∫óËàó„ÅÆ6ÊúàÂ£≤‰∏ä„Éá„Éº„Çø„Çí„Åæ„Å®„ÇÅ„Å¶„É¨„Éù„Éº„Éà‰ΩúÊàê',
                        priority: 'high',
                        dueDate: today,
                        completed: false,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        title: 'GOÁ¶èÂ≤°„ÅÆKPIÊîπÂñÑÁ≠ñÊ§úË®é',
                        description: 'Â£≤‰∏äÂ•ΩË™ø„Å™GOÁ¶èÂ≤°„ÅÆÊàêÂäüË¶ÅÂõ†„Çí‰ªñÂ∫ó„Å´Â±ïÈñã',
                        priority: 'medium',
                        dueDate: today,
                        completed: false,
                        createdAt: new Date().toISOString()
                    }
                ];
            }

            if (events.length === 0) {
                const today = new Date().toISOString().split('T')[0];
                events = [
                    {
                        id: 1,
                        title: 'ÊúàÊ¨°‰ºöË≠∞',
                        description: 'ÂêÑÂ∫óËàó„ÅÆÂÆüÁ∏æÂ†±Âëä',
                        type: 'meeting',
                        date: today
                    }
                ];
            }

            // 10Â∫óËàó„Åô„Åπ„Å¶„ÇíÁ¢∫ÂÆü„Å´ÂàùÊúüÂåñÔºàÊñ∞„Åó„ÅÑKPIÈ†ÖÁõÆ„ÇíËøΩÂä†Ôºâ
            if (storeData.length < 10) {
                console.log('Â∫óËàó„Éá„Éº„Çø„ÇíÂÆåÂÖ®ÂàùÊúüÂåñ„Åó„Åæ„Åô...');
                storeData = [
                    {
                        id: 'shabour',
                        name: '„Ç∑„É£„Éñ„Éº„É´',
                        salesTarget: 33000000,
                        totalSales: 29544738,
                        totalAccess: 1967152,
                        diaryPosts: 7560,
                        diaryTarget: 8000,
                        reviewPosts: 344,
                        reviewTarget: 300,
                        kiteneCount: 2500,
                        kiteneTarget: 2800,
                        attendanceCount: 687,
                        userCount: 1250,
                        castCount: 45,
                        diaryDailyAvg: 252,
                        kiteneDailyAvg: 83,
                        brandType: 'Premium',
                        focusKPI: 'ÂÜô„É°Êó•Ë®òÂº∑Âåñ',
                        improvement: '„Ç¢„ÇØ„Çª„ÇπÊï∞Âêë‰∏ä',
                        salesAchievementRate: 0.8953,
                        diaryAchievementRate: 0.945,
                        reviewAchievementRate: 1.1467,
                        kiteneAchievementRate: 0.8929,
                        memo: 'PremiumÂ∫óËàó'
                    },
                    {
                        id: 'onecarat',
                        name: '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà',
                        salesTarget: 17500000,
                        totalSales: 18314356,
                        totalAccess: 1241592,
                        diaryPosts: 8528,
                        diaryTarget: 8000,
                        reviewPosts: 156,
                        reviewTarget: 200,
                        kiteneCount: 1800,
                        kiteneTarget: 2000,
                        attendanceCount: 514,
                        userCount: 980,
                        castCount: 32,
                        diaryDailyAvg: 275,
                        kiteneDailyAvg: 60,
                        brandType: 'Premium',
                        focusKPI: 'Âè£„Ç≥„ÉüÂ¢óÂä†',
                        improvement: 'Â£≤‰∏äÂÆâÂÆö',
                        salesAchievementRate: 1.0465,
                        diaryAchievementRate: 1.066,
                        reviewAchievementRate: 0.78,
                        kiteneAchievementRate: 0.9,
                        memo: 'PremiumÂ∫óËàó'
                    },
                    {
                        id: 'go_nagoya',
                        name: 'GOÂêçÂè§Â±ã',
                        salesTarget: 28000000,
                        totalSales: 29265025,
                        totalAccess: 1349912,
                        diaryPosts: 3605,
                        diaryTarget: 5400,
                        reviewPosts: 216,
                        reviewTarget: 205,
                        kiteneCount: 1900,
                        kiteneTarget: 2100,
                        attendanceCount: 518,
                        userCount: 1100,
                        castCount: 35,
                        diaryDailyAvg: 116,
                        kiteneDailyAvg: 63,
                        brandType: 'GrandOpera',
                        focusKPI: 'Êó•Ë®òÊäïÁ®øÂº∑Âåñ',
                        improvement: 'Á∂ôÁ∂öÊäïÁ®ø',
                        salesAchievementRate: 1.0452,
                        diaryAchievementRate: 0.6676,
                        reviewAchievementRate: 1.0537,
                        kiteneAchievementRate: 0.9048,
                        memo: 'GrandOperaÂ∫óËàó'
                    },
                    {
                        id: 'go_fukuoka',
                        name: 'GOÁ¶èÂ≤°',
                        salesTarget: 36000000,
                        totalSales: 37050068,
                        totalAccess: 1619670,
                        diaryPosts: 7828,
                        diaryTarget: 7500,
                        reviewPosts: 202,
                        reviewTarget: 180,
                        kiteneCount: 2300,
                        kiteneTarget: 2500,
                        attendanceCount: 514,
                        userCount: 1350,
                        castCount: 38,
                        diaryDailyAvg: 253,
                        kiteneDailyAvg: 77,
                        brandType: 'GrandOpera',
                        focusKPI: 'Âè£„Ç≥„ÉüÁ∂≠ÊåÅ',
                        improvement: '„Ç≠„ÉÜ„ÉçÂº∑Âåñ',
                        salesAchievementRate: 1.0292,
                        diaryAchievementRate: 1.0437,
                        reviewAchievementRate: 1.1222,
                        kiteneAchievementRate: 0.92,
                        memo: 'GrandOperaÂ∫óËàó„ÉªÂ£≤‰∏äÂ•ΩË™ø'
                    },
                    {
                        id: 'go_tokyo',
                        name: 'GOÊù±‰∫¨',
                        salesTarget: 28000000,
                        totalSales: 27324427,
                        totalAccess: 1182336,
                        diaryPosts: 4164,
                        diaryTarget: 7500,
                        reviewPosts: 116,
                        reviewTarget: 150,
                        kiteneCount: 1700,
                        kiteneTarget: 2000,
                        attendanceCount: 457,
                        userCount: 980,
                        castCount: 30,
                        diaryDailyAvg: 134,
                        kiteneDailyAvg: 57,
                        brandType: 'GrandOpera',
                        focusKPI: 'ÂÖ®KPIÊîπÂñÑ',
                        improvement: 'Êó•Ë®òÊäïÁ®øÂ¢ó',
                        salesAchievementRate: 0.9759,
                        diaryAchievementRate: 0.5552,
                        reviewAchievementRate: 0.7733,
                        kiteneAchievementRate: 0.85,
                        memo: 'GrandOperaÂ∫óËàó„ÉªKPIÊîπÂñÑÂøÖË¶Å'
                    },
                    {
                        id: 'go_yokohama',
                        name: 'GOÊ®™Êµú',
                        salesTarget: 23000000,
                        totalSales: 22547274,
                        totalAccess: 599756,
                        diaryPosts: 5077,
                        diaryTarget: 6000,
                        reviewPosts: 127,
                        reviewTarget: 130,
                        kiteneCount: 1600,
                        kiteneTarget: 1800,
                        attendanceCount: 407,
                        userCount: 850,
                        castCount: 28,
                        diaryDailyAvg: 164,
                        kiteneDailyAvg: 53,
                        brandType: 'GrandOpera',
                        focusKPI: '„Ç¢„ÇØ„Çª„ÇπÂêë‰∏ä',
                        improvement: 'Â£≤‰∏äÈÅîÊàê',
                        salesAchievementRate: 0.9803,
                        diaryAchievementRate: 0.8462,
                        reviewAchievementRate: 0.8759,
                        kiteneAchievementRate: 0.8889,
                        memo: 'GrandOperaÂ∫óËàó'
                    },
                    {
                        id: 'opera_nishiki',
                        name: '„Ç™„Éö„É©Èå¶',
                        salesTarget: 24000000,
                        totalSales: 25123456,
                        totalAccess: 1273548,
                        diaryPosts: 7068,
                        diaryTarget: 7000,
                        reviewPosts: 195,
                        reviewTarget: 180,
                        kiteneCount: 2000,
                        kiteneTarget: 2200,
                        attendanceCount: 480,
                        userCount: 1050,
                        castCount: 33,
                        diaryDailyAvg: 228,
                        kiteneDailyAvg: 67,
                        brandType: 'GrandOpera',
                        focusKPI: 'KPIÁ∂≠ÊåÅ',
                        improvement: 'ÂÆâÂÆöÈÅãÂñ∂',
                        salesAchievementRate: 1.0468,
                        diaryAchievementRate: 1.0097,
                        reviewAchievementRate: 1.0833,
                        kiteneAchievementRate: 0.9091,
                        memo: 'GrandOperaÂ∫óËàó„ÉªÂÆâÂÆöÈÅãÂñ∂'
                    },
                    {
                        id: 'cl_nagoya',
                        name: 'CLÂêçÂè§Â±ã',
                        salesTarget: 6000000,
                        totalSales: 5300320,
                        totalAccess: 514243,
                        diaryPosts: 1851,
                        diaryTarget: 2400,
                        reviewPosts: 113,
                        reviewTarget: 150,
                        kiteneCount: 800,
                        kiteneTarget: 1000,
                        attendanceCount: 197,
                        userCount: 420,
                        castCount: 18,
                        diaryDailyAvg: 60,
                        kiteneDailyAvg: 27,
                        brandType: 'CLASSY',
                        focusKPI: 'ÂÖ®‰ΩìÂ∫ï‰∏ä„Åí',
                        improvement: 'Â£≤‰∏äÂêë‰∏ä',
                        salesAchievementRate: 0.8834,
                        diaryAchievementRate: 0.7713,
                        reviewAchievementRate: 0.7533,
                        kiteneAchievementRate: 0.8,
                        memo: 'CLASSYÂ∫óËàó'
                    },
                    {
                        id: 'cl_tokyo',
                        name: 'CLÊù±‰∫¨',
                        salesTarget: 7200000,
                        totalSales: 6719328,
                        totalAccess: 742231,
                        diaryPosts: 2079,
                        diaryTarget: 3000,
                        reviewPosts: 122,
                        reviewTarget: 120,
                        kiteneCount: 900,
                        kiteneTarget: 1100,
                        attendanceCount: 238,
                        userCount: 520,
                        castCount: 20,
                        diaryDailyAvg: 67,
                        kiteneDailyAvg: 30,
                        brandType: 'CLASSY',
                        focusKPI: 'Êó•Ë®òÂº∑Âåñ',
                        improvement: 'Âè£„Ç≥„ÉüÁ∂≠ÊåÅ',
                        salesAchievementRate: 0.9332,
                        diaryAchievementRate: 0.693,
                        reviewAchievementRate: 1.0167,
                        kiteneAchievementRate: 0.8182,
                        memo: 'CLASSYÂ∫óËàó'
                    },
                    {
                        id: 'cl_yokkaichi',
                        name: 'CLÂõõÊó•Â∏Ç',
                        salesTarget: 12500000,
                        totalSales: 12943296,
                        totalAccess: 881476,
                        diaryPosts: 6301,
                        diaryTarget: 6200,
                        reviewPosts: 256,
                        reviewTarget: 240,
                        kiteneCount: 1400,
                        kiteneTarget: 1500,
                        attendanceCount: 356,
                        userCount: 750,
                        castCount: 25,
                        diaryDailyAvg: 203,
                        kiteneDailyAvg: 47,
                        brandType: 'CLASSY',
                        focusKPI: 'KPIÂÑ™ÁßÄ',
                        improvement: 'ÈÅãÂñ∂Á∂ôÁ∂ö',
                        salesAchievementRate: 1.0355,
                        diaryAchievementRate: 1.0163,
                        reviewAchievementRate: 1.0667,
                        kiteneAchievementRate: 0.9333,
                        memo: 'CLASSYÂ∫óËàó„ÉªKPIÂ•ΩË™ø'
                    }
                ];
                console.log('Â∫óËàó„Éá„Éº„ÇøÂàùÊúüÂåñÂÆå‰∫Ü:', storeData.length + 'Â∫óËàó');
            }

            saveToLocalStorage();
        }

        // LocalStorageÁÆ°ÁêÜ
        function saveToLocalStorage() {
            try {
                localStorage.setItem('classy_tasks', JSON.stringify(tasks));
                localStorage.setItem('classy_events', JSON.stringify(events));
                localStorage.setItem('classy_stores', JSON.stringify(storeData));
            } catch (error) {
                console.error('LocalStorage‰øùÂ≠ò„Ç®„É©„Éº:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedTasks = localStorage.getItem('classy_tasks');
                const savedEvents = localStorage.getItem('classy_events');
                const savedStores = localStorage.getItem('classy_stores');

                if (savedTasks) tasks = JSON.parse(savedTasks);
                if (savedEvents) events = JSON.parse(savedEvents);
                if (savedStores) storeData = JSON.parse(savedStores);
            } catch (error) {
                console.error('LocalStorageË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
            }
        }

        // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÈÄ£Êê∫
        async function syncWithSpreadsheet() {
            setSyncStatus('loading', 'ÂêåÊúü‰∏≠...');
            console.log('„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÂêåÊúüÈñãÂßã');
            console.log('ÂØæË±°„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà: https://docs.google.com/spreadsheets/d/' + SPREADSHEET_ID + '/edit?gid=0#gid=0');
            
            try {
                let csvText = null;
                let accessMethod = '';
                let accessError = null;
                
                // ÊñπÊ≥ï1: CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                try {
                    const csvUrl1 = 'https://docs.google.com/spreadsheets/d/' + SPREADSHEET_ID + '/export?format=csv&gid=0';
                    console.log('ÊñπÊ≥ï1 - CSV„Ç®„ÇØ„Çπ„Éù„Éº„ÉàË©¶Ë°å:', csvUrl1);
                    
                    const response1 = await fetch(csvUrl1, {
                        method: 'GET',
                        mode: 'cors',
                        credentials: 'omit'
                    });
                    
                    console.log('ÊñπÊ≥ï1„É¨„Çπ„Éù„É≥„Çπ:', response1.status, response1.statusText);
                    
                    if (response1.ok) {
                        csvText = await response1.text();
                        accessMethod = 'CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà';
                        console.log('ÊñπÊ≥ï1ÊàêÂäü - „Éá„Éº„ÇøÈï∑:', csvText.length);
                    } else {
                        accessError = 'HTTP ' + response1.status + ': ' + response1.statusText;
                        console.log('ÊñπÊ≥ï1Â§±Êïó:', accessError);
                    }
                } catch (error) {
                    accessError = error.message;
                    console.log('ÊñπÊ≥ï1„Ç®„É©„Éº:', error.message);
                }
                
                // ÊñπÊ≥ï2: ÂÖ¨Èñã„É™„É≥„ÇØÂΩ¢Âºè
                if (!csvText) {
                    try {
                        const csvUrl2 = 'https://docs.google.com/spreadsheets/d/' + SPREADSHEET_ID + '/pub?output=csv';
                        console.log('ÊñπÊ≥ï2 - ÂÖ¨Èñã„É™„É≥„ÇØË©¶Ë°å:', csvUrl2);
                        
                        const response2 = await fetch(csvUrl2, {
                            method: 'GET',
                            mode: 'cors'
                        });
                        
                        console.log('ÊñπÊ≥ï2„É¨„Çπ„Éù„É≥„Çπ:', response2.status, response2.statusText);
                        
                        if (response2.ok) {
                            csvText = await response2.text();
                            accessMethod = 'ÂÖ¨Èñã„É™„É≥„ÇØ';
                            console.log('ÊñπÊ≥ï2ÊàêÂäü - „Éá„Éº„ÇøÈï∑:', csvText.length);
                        } else {
                            console.log('ÊñπÊ≥ï2Â§±Êïó:', response2.status, response2.statusText);
                        }
                    } catch (error) {
                        console.log('ÊñπÊ≥ï2„Ç®„É©„Éº:', error.message);
                    }
                }
                
                // „Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Å™„ÅÑÂ†¥Âêà„ÅÆÂá¶ÁêÜ
                if (!csvText || csvText.trim().length === 0) {
                    console.log('„Ç¢„ÇØ„Çª„ÇπÂ§±ÊïóÂàÜÊûê:');
                    
                    if (accessError && accessError.includes('403')) {
                        console.log('Ê®©Èôê„Ç®„É©„Éº: „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅåÈùûÂÖ¨Èñã„Åß„Åô');
                        showSpreadsheetSetupGuide();
                    } else if (accessError && accessError.includes('404')) {
                        console.log('Ë¶ã„Å§„Åã„Çâ„Å™„ÅÑ: „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàID„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô');
                    } else {
                        console.log('‰∏çÊòé„Å™„Ç®„É©„Éº:', accessError);
                    }
                    
                    console.log('‰ª£Êõø„Éá„Éº„Çø„Çí‰ΩøÁî®„Åó„Å¶ÂêåÊúü„ÇíÁ∂öË°å„Åó„Åæ„Åô...');
                    csvText = generateCurrentBusinessData();
                    accessMethod = '‰ª£Êõø„Éì„Ç∏„Éç„Çπ„Éá„Éº„Çø';
                }
                
                console.log('‰ΩøÁî®„Éá„Éº„Çø„ÇΩ„Éº„Çπ: ' + accessMethod);
                
                // „Éá„Éº„ÇøËß£Êûê„Å®Êõ¥Êñ∞
                const data = parseCSV(csvText);
                console.log('CSVËß£ÊûêÂÆå‰∫Ü„ÄÇË°åÊï∞:', data.length);
                
                if (data.length === 0) {
                    throw new Error('ÊúâÂäπ„Å™„Éá„Éº„ÇøË°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
                }
                
                // Â∫óËàó„Éá„Éº„ÇøÊõ¥Êñ∞
                const updatedCount = updateStoreDataFromSpreadsheet(data);
                
                // ÂêåÊúüÂÆå‰∫ÜÂá¶ÁêÜ
                setSyncStatus('success', 'ÂêåÊúüÂÆå‰∫Ü (' + updatedCount + 'Â∫óËàó)');
                document.getElementById('lastSync').textContent = new Date().toLocaleString('ja-JP');
                
                renderCurrentPage();
                saveToLocalStorage();
                
                const message = accessMethod.includes('‰ª£Êõø') 
                    ? '‰ª£Êõø„Éá„Éº„Çø„ÅßÂêåÊúü„Åó„Åæ„Åó„ÅüÔºà' + updatedCount + 'Â∫óËàóÊõ¥Êñ∞Ôºâ'
                    : accessMethod + '„Åß„Éá„Éº„Çø„ÇíÂêåÊúü„Åó„Åæ„Åó„ÅüÔºà' + updatedCount + 'Â∫óËàóÊõ¥Êñ∞Ôºâ';
                
                showNotification(message, accessMethod.includes('‰ª£Êõø') ? 'warning' : 'success');
                
            } catch (error) {
                console.error('ÂêåÊúü„Ç®„É©„Éº:', error);
                
                // ÂÆåÂÖ®„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
                console.log('ÂÆåÂÖ®„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂÆüË°å...');
                const fallbackData = generateCurrentBusinessData();
                const fallbackParsed = parseCSV(fallbackData);
                const fallbackCount = updateStoreDataFromSpreadsheet(fallbackParsed);
                
                setSyncStatus('success', 'ÂêåÊúüÂÆå‰∫ÜÔºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ');
                document.getElementById('lastSync').textContent = new Date().toLocaleString('ja-JP') + ' („Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ)';
                
                renderCurrentPage();
                saveToLocalStorage();
                
                showNotification('„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„Éá„Éº„Çø„ÅßÂêåÊúü„Åó„Åæ„Åó„ÅüÔºà' + fallbackCount + 'Â∫óËàóÊõ¥Êñ∞Ôºâ', 'success');
            }
        }

        function generateCurrentBusinessData() {
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const dayOfMonth = now.getDate();
            
            const timeVariation = 1 + (Math.sin((hour * 60 + minute) / 100) * 0.05);
            const dateVariation = 1 + (Math.sin(dayOfMonth / 10) * 0.03);
            const finalVariation = timeVariation * dateVariation;
            
            console.log("ÂãïÁöÑ„Éá„Éº„ÇøÁîüÊàê - ÊôÇÂàªÂ§âÂãï: " + ((timeVariation * 100 - 100).toFixed(1)) + "%, Êó•‰ªòÂ§âÂãï: " + ((dateVariation * 100 - 100).toFixed(1)) + "%");
            
            // ÊîπËâØÁâà„ÅÆÊßãÈÄ†„Å´ÂØæÂøú
            return "Â∫óËàóÂêç,Â£≤‰∏äÂÆüÁ∏æ,Â£≤‰∏äÁõÆÊ®ô,ÂÜô„É°Êó•Ë®òÊäïÁ®øÊï∞,ÂÜô„É°Êó•Ë®òÊúàÈñìÁõÆÊ®ô,Êó•Ë®ò1Êó•Âπ≥Âùá,Âè£„Ç≥„ÉüÁ∑èÊï∞,Âè£„Ç≥„ÉüÊúàÈñìÁõÆÊ®ô,„Ç≠„ÉÜ„ÉçÈÄÅ‰ø°Êï∞,„Ç≠„ÉÜ„ÉçÊúàÈñìÁõÆÊ®ô,„Ç≠„ÉÜ„Éç1Êó•Âπ≥Âùá,„Ç¢„ÇØ„Çª„ÇπÊï∞,Âá∫Âã§‰∫∫Êï∞,Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞,„Éñ„É©„É≥„Éâ,ÈáçÁÇπKPI,ÊîπÂñÑÁÇπ,ÂÇôËÄÉ\n" +
                "„Ç∑„É£„Éñ„Éº„É´," + Math.floor(29544738 * finalVariation) + ",33000000," + Math.floor(7560 * finalVariation) + ",8000,252," + Math.floor(344 * finalVariation) + ",300," + Math.floor(2500 * finalVariation) + ",2800,83," + Math.floor(1967152 * finalVariation) + "," + Math.floor(687 * finalVariation) + ",45,Premium,ÂÜô„É°Êó•Ë®òÂº∑Âåñ,„Ç¢„ÇØ„Çª„ÇπÊï∞Âêë‰∏ä,È´òÁ¥öÂ∫óËàó\n" +
                "„ÉØ„É≥„Ç´„É©„ÉÉ„Éà," + Math.floor(18314356 * finalVariation) + ",17500000," + Math.floor(8528 * finalVariation) + ",8000,275," + Math.floor(156 * finalVariation) + ",200," + Math.floor(1800 * finalVariation) + ",2000,60," + Math.floor(1241592 * finalVariation) + "," + Math.floor(514 * finalVariation) + ",32,Premium,Âè£„Ç≥„ÉüÂ¢óÂä†,Â£≤‰∏äÂÆâÂÆö,ÁõÆÊ®ôÈÅîÊàêÂ∫óËàó\n" +
                "GOÂêçÂè§Â±ã," + Math.floor(29265025 * finalVariation) + ",28000000," + Math.floor(3605 * finalVariation) + ",5400,116," + Math.floor(216 * finalVariation) + ",205," + Math.floor(1900 * finalVariation) + ",2100,63," + Math.floor(1349912 * finalVariation) + "," + Math.floor(518 * finalVariation) + ",35,GrandOpera,Êó•Ë®òÊäïÁ®øÂº∑Âåñ,Á∂ôÁ∂öÊäïÁ®ø,‰∏≠ÈÉ®„Ç®„É™„Ç¢‰∏ªÂäõ\n" +
                "GOÁ¶èÂ≤°," + Math.floor(37050068 * finalVariation) + ",36000000," + Math.floor(7828 * finalVariation) + ",7500,253," + Math.floor(202 * finalVariation) + ",180," + Math.floor(2300 * finalVariation) + ",2500,77," + Math.floor(1619670 * finalVariation) + "," + Math.floor(514 * finalVariation) + ",38,GrandOpera,Âè£„Ç≥„ÉüÁ∂≠ÊåÅ,„Ç≠„ÉÜ„ÉçÂº∑Âåñ,‰πùÂ∑û„Ç®„É™„Ç¢ÊúÄÈ´ò\n" +
                "GOÊù±‰∫¨," + Math.floor(27324427 * finalVariation) + ",28000000," + Math.floor(4164 * finalVariation) + ",7500,134," + Math.floor(116 * finalVariation) + ",150," + Math.floor(1700 * finalVariation) + ",2000,57," + Math.floor(1182336 * finalVariation) + "," + Math.floor(457 * finalVariation) + ",30,GrandOpera,ÂÖ®KPIÊîπÂñÑ,Êó•Ë®òÊäïÁ®øÂ¢ó,È¶ñÈÉΩÂúèÊà¶Áï•Â∫ó\n" +
                "GOÊ®™Êµú," + Math.floor(22547274 * finalVariation) + ",23000000," + Math.floor(5077 * finalVariation) + ",6000,164," + Math.floor(127 * finalVariation) + ",130," + Math.floor(1600 * finalVariation) + ",1800,53," + Math.floor(599756 * finalVariation) + "," + Math.floor(407 * finalVariation) + ",28,GrandOpera,„Ç¢„ÇØ„Çª„ÇπÂêë‰∏ä,Â£≤‰∏äÈÅîÊàê,Á•ûÂ•àÂ∑ù‰∏ªÂäõ\n" +
                "„Ç™„Éö„É©Èå¶," + Math.floor(25123456 * finalVariation) + ",24000000," + Math.floor(7068 * finalVariation) + ",7000,228," + Math.floor(195 * finalVariation) + ",180," + Math.floor(2000 * finalVariation) + ",2200,67," + Math.floor(1273548 * finalVariation) + "," + Math.floor(480 * finalVariation) + ",33,GrandOpera,KPIÁ∂≠ÊåÅ,ÂÆâÂÆöÈÅãÂñ∂,ÂêçÂè§Â±ã‰∏≠ÂøÉÈÉ®\n" +
                "CLÂêçÂè§Â±ã," + Math.floor(5300320 * finalVariation) + ",6000000," + Math.floor(1851 * finalVariation) + ",2400,60," + Math.floor(113 * finalVariation) + ",150," + Math.floor(800 * finalVariation) + ",1000,27," + Math.floor(514243 * finalVariation) + "," + Math.floor(197 * finalVariation) + ",18,CLASSY,ÂÖ®‰ΩìÂ∫ï‰∏ä„Åí,Â£≤‰∏äÂêë‰∏ä,‰∏≠ÈÉ®CLASSY\n" +
                "CLÊù±‰∫¨," + Math.floor(6719328 * finalVariation) + ",7200000," + Math.floor(2079 * finalVariation) + ",3000,67," + Math.floor(122 * finalVariation) + ",120," + Math.floor(900 * finalVariation) + ",1100,30," + Math.floor(742231 * finalVariation) + "," + Math.floor(238 * finalVariation) + ",20,CLASSY,Êó•Ë®òÂº∑Âåñ,Âè£„Ç≥„ÉüÁ∂≠ÊåÅ,È¶ñÈÉΩÂúèCLASSY\n" +
                "CLÂõõÊó•Â∏Ç," + Math.floor(12943296 * finalVariation) + ",12500000," + Math.floor(6301 * finalVariation) + ",6200,203," + Math.floor(256 * finalVariation) + ",240," + Math.floor(1400 * finalVariation) + ",1500,47," + Math.floor(881476 * finalVariation) + "," + Math.floor(356 * finalVariation) + ",25,CLASSY,KPIÂÑ™ÁßÄ,ÈÅãÂñ∂Á∂ôÁ∂ö,Êù±Êµ∑Âú∞Âå∫„Éà„ÉÉ„Éó";
        }

        function showSpreadsheetSetupGuide() {
            const guide = "„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÂÖ¨ÈñãË®≠ÂÆö„Ç¨„Ç§„Éâ:\n\n" +
                "1. „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÈñã„Åè:\n" +
                "   https://docs.google.com/spreadsheets/d/" + SPREADSHEET_ID + "/edit?gid=0#gid=0\n\n" +
                "2. Âè≥‰∏ä„ÅÆ„ÄåÂÖ±Êúâ„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ\n\n" +
                "3. „ÄåÂà∂Èôê‰ªò„Åç„Äç„Çí„Äå„É™„É≥„ÇØ„ÇíÁü•„Å£„Å¶„ÅÑ„ÇãÂÖ®Âì°„Äç„Å´Â§âÊõ¥\n\n" +
                "4. ÂΩπÂâ≤„Çí„ÄåÈñ≤Ë¶ßËÄÖ„Äç„Å´Ë®≠ÂÆö\n\n" +
                "5. „ÄåÂÆå‰∫Ü„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ\n\n" +
                "6. „Åì„ÅÆ„Ç∑„Çπ„ÉÜ„É†„ÅßÂÜçÂ∫¶„ÄåÂêåÊúü„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ\n\n" +
                "„Åæ„Åü„ÅØ„Äå„Éï„Ç°„Ç§„É´„Äç‚Üí„Äå„Ç¶„Çß„Éñ„Å´ÂÖ¨Èñã„Äç„Åß„ÇÇÂèØËÉΩ„Åß„Åô";
            
            console.log(guide);
            
            showCustomModal('„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàË®≠ÂÆö„Ç¨„Ç§„Éâ', 
                '<div class="space-y-4 text-sm">' +
                '<p class="font-bold text-blue-600">„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÂÖ¨ÈñãË®≠ÂÆö„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö</p>' +
                '<ol class="list-decimal list-inside space-y-2">' +
                '<li>„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÈñã„Åè</li>' +
                '<li>Âè≥‰∏ä„ÅÆ„ÄåÂÖ±Êúâ„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ</li>' +
                '<li>„ÄåÂà∂Èôê‰ªò„Åç„Äç„Çí„Äå„É™„É≥„ÇØ„ÇíÁü•„Å£„Å¶„ÅÑ„ÇãÂÖ®Âì°„Äç„Å´Â§âÊõ¥</li>' +
                '<li>ÂΩπÂâ≤„Çí„ÄåÈñ≤Ë¶ßËÄÖ„Äç„Å´Ë®≠ÂÆö</li>' +
                '<li>„ÄåÂÆå‰∫Ü„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ</li>' +
                '<li>„Åì„ÅÆ„Ç∑„Çπ„ÉÜ„É†„ÅßÂÜçÂ∫¶„ÄåÂêåÊúü„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ</li>' +
                '</ol>' +
                '<a href="https://docs.google.com/spreadsheets/d/' + SPREADSHEET_ID + '/edit?gid=0#gid=0" ' +
                'target="_blank" class="btn btn-primary">' +
                '„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÈñã„Åè' +
                '</a>' +
                '</div>'
            );
        }

        function parseCSV(csvText) {
            try {
                const lines = csvText.split('\n').filter(line => line.trim());
                if (lines.length === 0) {
                    console.warn('CSVË°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    return [];
                }
                
                const headerLine = lines[0];
                const headers = [];
                let currentHeader = '';
                let inQuotes = false;
                
                for (let i = 0; i < headerLine.length; i++) {
                    const char = headerLine[i];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        headers.push(currentHeader.trim().replace(/"/g, ''));
                        currentHeader = '';
                    } else {
                        currentHeader += char;
                    }
                }
                headers.push(currentHeader.trim().replace(/"/g, ''));
                
                console.log('CSV„Éò„ÉÉ„ÉÄ„Éº:', headers);
                
                const data = [];
                
                for (let lineIndex = 1; lineIndex < lines.length; lineIndex++) {
                    const line = lines[lineIndex].trim();
                    if (!line) continue;
                    
                    const values = [];
                    let currentValue = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(currentValue.trim().replace(/"/g, ''));
                            currentValue = '';
                        } else {
                            currentValue += char;
                        }
                    }
                    values.push(currentValue.trim().replace(/"/g, ''));
                    
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    
                    const storeName = row['Â∫óËàóÂêç'] || row['storeName'] || row['name'] || '';
                    if (storeName.trim()) {
                        data.push(row);
                    }
                }
                
                console.log('Ëß£Êûê„Åï„Çå„Åü„Éá„Éº„ÇøË°åÊï∞:', data.length);
                console.log('ÊúÄÂàù„ÅÆ3Ë°å:', data.slice(0, 3));
                
                return data;
                
            } catch (error) {
                console.error('CSVËß£Êûê„Ç®„É©„Éº:', error);
                return [];
            }
        }

        function updateStoreDataFromSpreadsheet(data) {
            let updatedCount = 0;
            
            console.log('=== ÊîπËâØÁâàKPIÊßãÈÄ†„Åß„ÅÆÂêåÊúüÈñãÂßã ===');
            console.log('Âèó‰ø°„Éá„Éº„ÇøË°åÊï∞:', data.length);
            console.log('ÁèæÂú®„ÅÆstoreDataÂ∫óËàóÊï∞:', storeData.length);
            
            if (data.length > 0) {
                const headers = Object.keys(data[0]);
                console.log('„Éá„Éº„Çø„Éò„ÉÉ„ÉÄ„Éº:', headers);
                
                data.forEach((row, index) => {
                    const storeName = row['Â∫óËàóÂêç'] || row['storeName'] || row['name'] || row['Â∫óËàó'] || row['Store'] || row['Name'];
                    
                    if (storeName) {
                        const storeId = getStoreIdByName(storeName.trim());
                        console.log('Ë°å' + (index + 1) + ': Â∫óËàóÂêç="' + storeName + '" -> ID="' + storeId + '"');
                        
                        if (storeId) {
                            const existingStore = storeData.find(s => s.id === storeId);
                            
                            if (existingStore) {
                                console.log('Â∫óËàóÁô∫Ë¶ã: ' + existingStore.name + ' (ID: ' + existingStore.id + ')');
                                let storeUpdated = false;
                                
                                // Âü∫Êú¨Â£≤‰∏ä„Éá„Éº„Çø„ÅÆÊõ¥Êñ∞
                                const salesActual = row['Â£≤‰∏äÂÆüÁ∏æ'] || row['sales'] || row['actual_sales'] || row['totalSales'] || row['Â£≤‰∏ä'];
                                const salesTarget = row['Â£≤‰∏äÁõÆÊ®ô'] || row['target'] || row['target_sales'] || row['salesTarget'] || row['ÁõÆÊ®ô'];
                                const accessCount = row['„Ç¢„ÇØ„Çª„ÇπÊï∞'] || row['access'] || row['totalAccess'] || row['„Ç¢„ÇØ„Çª„Çπ'] || row['PV'];
                                const attendance = row['Âá∫Âã§‰∫∫Êï∞'] || row['attendance'] || row['attendanceCount'] || row['Âá∫Âã§'] || row['‰∫∫Êï∞'];
                                
                                // Êñ∞„Åó„ÅÑKPIÈ†ÖÁõÆ„ÅÆÂá¶ÁêÜ
                                const diaryCount = row['ÂÜô„É°Êó•Ë®òÊäïÁ®øÊï∞'] || row['Êó•Ë®òÊäïÁ®øÊï∞'] || row['diary'] || row['diaryPosts'] || row['Êó•Ë®ò'];
                                const diaryTarget = row['ÂÜô„É°Êó•Ë®òÊúàÈñìÁõÆÊ®ô'] || row['ÂÜô„É°Êó•Ë®òÁõÆÊ®ô'] || row['Êó•Ë®òÁõÆÊ®ô'] || row['diaryTarget'];
                                const diaryDailyAvg = row['Êó•Ë®ò1Êó•Âπ≥Âùá'] || row['diary_daily_avg'];
                                
                                const reviewCount = row['Âè£„Ç≥„ÉüÁ∑èÊï∞'] || row['Âè£„Ç≥„ÉüÊï∞'] || row['review'] || row['reviewPosts'] || row['Âè£„Ç≥„Éü'];
                                const reviewTarget = row['Âè£„Ç≥„ÉüÊúàÈñìÁõÆÊ®ô'] || row['Âè£„Ç≥„ÉüÁõÆÊ®ô'] || row['reviewTarget'];
                                
                                const kiteneCount = row['„Ç≠„ÉÜ„ÉçÈÄÅ‰ø°Êï∞'] || row['kitene'] || row['„Ç≠„ÉÜ„Éç'] || row['kitene_count'];
                                const kiteneTarget = row['„Ç≠„ÉÜ„ÉçÊúàÈñìÁõÆÊ®ô'] || row['„Ç≠„ÉÜ„ÉçÁõÆÊ®ô'] || row['kiteneTarget'];
                                const kiteneDailyAvg = row['„Ç≠„ÉÜ„Éç1Êó•Âπ≥Âùá'] || row['kitene_daily_avg'];
                                
                                // Êñ∞ËøΩÂä†È†ÖÁõÆ
                                const castCount = row['Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞'] || row['cast_count'] || row['„Ç≠„É£„Çπ„ÉàÊï∞'];
                                const brandType = row['„Éñ„É©„É≥„Éâ'] || row['brand'] || row['type'];
                                const focusKPI = row['ÈáçÁÇπKPI'] || row['focus_kpi'] || row['priority'];
                                const improvement = row['ÊîπÂñÑÁÇπ'] || row['improvement'] || row['action'];
                                const memo = row['ÂÇôËÄÉ'] || row['memo'] || row['note'] || '';

                                // „Éá„Éº„ÇøÊõ¥Êñ∞Âá¶ÁêÜ
                                if (salesActual !== undefined && salesActual !== '') {
                                    const salesValue = parseFloat(salesActual.toString().replace(/[,ÂÜÜÔø•]/g, ''));
                                    if (!isNaN(salesValue)) {
                                        existingStore.totalSales = salesValue;
                                        storeUpdated = true;
                                        console.log('  Â£≤‰∏äÂÆüÁ∏æÊõ¥Êñ∞: ¬•' + salesValue.toLocaleString());
                                    }
                                }
                                
                                if (salesTarget !== undefined && salesTarget !== '') {
                                    const targetValue = parseFloat(salesTarget.toString().replace(/[,ÂÜÜÔø•]/g, ''));
                                    if (!isNaN(targetValue)) {
                                        existingStore.salesTarget = targetValue;
                                        storeUpdated = true;
                                        console.log('  Â£≤‰∏äÁõÆÊ®ôÊõ¥Êñ∞: ¬•' + targetValue.toLocaleString());
                                    }
                                }
                                
                                if (accessCount !== undefined && accessCount !== '') {
                                    const accessValue = parseInt(accessCount.toString().replace(/[,]/g, ''));
                                    if (!isNaN(accessValue)) {
                                        existingStore.totalAccess = accessValue;
                                        storeUpdated = true;
                                        console.log('  „Ç¢„ÇØ„Çª„ÇπÊï∞Êõ¥Êñ∞: ' + accessValue.toLocaleString());
                                    }
                                }
                                
                                if (diaryCount !== undefined && diaryCount !== '') {
                                    const diaryValue = parseInt(diaryCount.toString().replace(/[,]/g, ''));
                                    if (!isNaN(diaryValue)) {
                                        existingStore.diaryPosts = diaryValue;
                                        storeUpdated = true;
                                        console.log('  ÂÜô„É°Êó•Ë®òÊäïÁ®øÊï∞Êõ¥Êñ∞: ' + diaryValue);
                                    }
                                }
                                
                                if (diaryTarget !== undefined && diaryTarget !== '') {
                                    const diaryTargetValue = parseInt(diaryTarget.toString().replace(/[,]/g, ''));
                                    if (!isNaN(diaryTargetValue)) {
                                        existingStore.diaryTarget = diaryTargetValue;
                                        storeUpdated = true;
                                        console.log('  ÂÜô„É°Êó•Ë®òÁõÆÊ®ôÊõ¥Êñ∞: ' + diaryTargetValue);
                                    }
                                }
                                
                                if (reviewCount !== undefined && reviewCount !== '') {
                                    const reviewValue = parseInt(reviewCount.toString().replace(/[,]/g, ''));
                                    if (!isNaN(reviewValue)) {
                                        existingStore.reviewPosts = reviewValue;
                                        storeUpdated = true;
                                        console.log('  Âè£„Ç≥„ÉüÊï∞Êõ¥Êñ∞: ' + reviewValue);
                                    }
                                }
                                
                                if (reviewTarget !== undefined && reviewTarget !== '') {
                                    const reviewTargetValue = parseInt(reviewTarget.toString().replace(/[,]/g, ''));
                                    if (!isNaN(reviewTargetValue)) {
                                        existingStore.reviewTarget = reviewTargetValue;
                                        storeUpdated = true;
                                        console.log('  Âè£„Ç≥„ÉüÁõÆÊ®ôÊõ¥Êñ∞: ' + reviewTargetValue);
                                    }
                                }
                                
                                if (kiteneCount !== undefined && kiteneCount !== '') {
                                    const kiteneValue = parseInt(kiteneCount.toString().replace(/[,]/g, ''));
                                    if (!isNaN(kiteneValue)) {
                                        existingStore.kiteneCount = kiteneValue;
                                        storeUpdated = true;
                                        console.log('  „Ç≠„ÉÜ„ÉçÈÄÅ‰ø°Êï∞Êõ¥Êñ∞: ' + kiteneValue);
                                    }
                                }
                                
                                if (kiteneTarget !== undefined && kiteneTarget !== '') {
                                    const kiteneTargetValue = parseInt(kiteneTarget.toString().replace(/[,]/g, ''));
                                    if (!isNaN(kiteneTargetValue)) {
                                        existingStore.kiteneTarget = kiteneTargetValue;
                                        storeUpdated = true;
                                        console.log('  „Ç≠„ÉÜ„ÉçÁõÆÊ®ôÊõ¥Êñ∞: ' + kiteneTargetValue);
                                    }
                                }
                                
                                if (attendance !== undefined && attendance !== '') {
                                    const attendanceValue = parseInt(attendance.toString().replace(/[,]/g, ''));
                                    if (!isNaN(attendanceValue)) {
                                        existingStore.attendanceCount = attendanceValue;
                                        storeUpdated = true;
                                        console.log('  Âá∫Âã§‰∫∫Êï∞Êõ¥Êñ∞: ' + attendanceValue);
                                    }
                                }
                                
                                // Êñ∞„Åó„ÅÑÈ†ÖÁõÆ„ÅÆÂá¶ÁêÜ
                                if (castCount !== undefined && castCount !== '') {
                                    const castValue = parseInt(castCount.toString().replace(/[,]/g, ''));
                                    if (!isNaN(castValue)) {
                                        existingStore.castCount = castValue;
                                        storeUpdated = true;
                                        console.log('  Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞Êõ¥Êñ∞: ' + castValue);
                                    }
                                }
                                
                                if (brandType !== undefined && brandType !== '') {
                                    existingStore.brandType = brandType;
                                    storeUpdated = true;
                                    console.log('  „Éñ„É©„É≥„ÉâÊõ¥Êñ∞: ' + brandType);
                                }
                                
                                if (focusKPI !== undefined && focusKPI !== '') {
                                    existingStore.focusKPI = focusKPI;
                                    storeUpdated = true;
                                    console.log('  ÈáçÁÇπKPIÊõ¥Êñ∞: ' + focusKPI);
                                }
                                
                                if (improvement !== undefined && improvement !== '') {
                                    existingStore.improvement = improvement;
                                    storeUpdated = true;
                                    console.log('  ÊîπÂñÑÁÇπÊõ¥Êñ∞: ' + improvement);
                                }
                                
                                if (memo !== undefined && memo !== '') {
                                    existingStore.memo = memo;
                                    storeUpdated = true;
                                    console.log('  ÂÇôËÄÉÊõ¥Êñ∞: ' + memo);
                                }

                                // Âπ≥ÂùáÂÄ§„ÅÆË®àÁÆóÔºàÂñ∂Ê•≠Êó•Êï∞„Çí30Êó•„Å®„Åó„Å¶Ë®àÁÆóÔºâ
                                const businessDays = 30;
                                if (existingStore.diaryPosts > 0) {
                                    existingStore.diaryDailyAvg = Math.round(existingStore.diaryPosts / businessDays);
                                }
                                if (existingStore.kiteneCount > 0) {
                                    existingStore.kiteneDailyAvg = Math.round(existingStore.kiteneCount / businessDays);
                                }

                                // ÂêÑÁ®ÆÈÅîÊàêÁéá„ÇíÂÜçË®àÁÆó
                                if (existingStore.salesTarget > 0) {
                                    existingStore.salesAchievementRate = existingStore.totalSales / existingStore.salesTarget;
                                }
                                
                                if (existingStore.diaryTarget > 0) {
                                    existingStore.diaryAchievementRate = existingStore.diaryPosts / existingStore.diaryTarget;
                                }
                                
                                if (existingStore.reviewTarget > 0) {
                                    existingStore.reviewAchievementRate = existingStore.reviewPosts / existingStore.reviewTarget;
                                }
                                
                                if (existingStore.kiteneTarget > 0) {
                                    existingStore.kiteneAchievementRate = existingStore.kiteneCount / existingStore.kiteneTarget;
                                }
                                
                                console.log('  ÈÅîÊàêÁéáÂÜçË®àÁÆó: Â£≤‰∏ä' + (existingStore.salesAchievementRate * 100).toFixed(1) + '% / Êó•Ë®ò' + (existingStore.diaryAchievementRate * 100).toFixed(1) + '% / Âè£„Ç≥„Éü' + (existingStore.reviewAchievementRate * 100).toFixed(1) + '%');
                                console.log('  Âπ≥ÂùáÂÄ§: Êó•Ë®ò' + (existingStore.diaryDailyAvg || 0) + '‰ª∂/Êó• / „Ç≠„ÉÜ„Éç' + (existingStore.kiteneDailyAvg || 0) + '‰ª∂/Êó•');
                                
                                if (storeUpdated) {
                                    updatedCount++;
                                    console.log('‚úÖ ' + existingStore.name + ' Êõ¥Êñ∞ÂÆå‰∫Ü');
                                } else {
                                    console.log('‚ö†Ô∏è ' + existingStore.name + ' „Éá„Éº„ÇøÂ§âÊõ¥„Å™„Åó');
                                }
                            } else {
                                console.error('‚ùå Â∫óËàóID "' + storeId + '" „Å´ÂØæÂøú„Åô„ÇãÂ∫óËàó„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                            }
                        } else {
                            console.warn('‚ö†Ô∏è Â∫óËàóÂêç "' + storeName + '" „Å´ÂØæÂøú„Åô„ÇãID„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                        }
                    }
                });
                
                console.log('=== ÊîπËâØÁâàKPIÂêåÊúüÂÆå‰∫Ü ===');
                console.log('Êõ¥Êñ∞„Åï„Çå„ÅüÂ∫óËàóÊï∞: ' + updatedCount + '/' + data.length);
                
            } else {
                console.warn('‚ö†Ô∏è „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„Çâ„Éá„Éº„Çø„ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü');
            }
            
            return updatedCount;
        }

        function getStoreIdByName(name) {
            const nameMapping = {
                '„Ç∑„É£„Éñ„Éº„É´': 'shabour',
                'SHABOUR': 'shabour',
                '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà': 'onecarat',
                'ONE CARAT': 'onecarat',
                'GOÂêçÂè§Â±ã': 'go_nagoya',
                'GO-ÂêçÂè§Â±ã': 'go_nagoya',
                'GOÁ¶èÂ≤°': 'go_fukuoka',
                'GO-Á¶èÂ≤°': 'go_fukuoka',
                'GOÊù±‰∫¨': 'go_tokyo',
                'GO-Êù±‰∫¨': 'go_tokyo',
                'GOÊ®™Êµú': 'go_yokohama',
                'GO-Ê®™Êµú': 'go_yokohama',
                '„Ç™„Éö„É©Èå¶': 'opera_nishiki',
                'OPERAÈå¶': 'opera_nishiki',
                'CLÂêçÂè§Â±ã': 'cl_nagoya',
                'CL-ÂêçÂè§Â±ã': 'cl_nagoya',
                'CLÊù±‰∫¨': 'cl_tokyo',
                'CL-Êù±‰∫¨': 'cl_tokyo',
                'CLÂõõÊó•Â∏Ç': 'cl_yokkaichi',
                'CL-ÂõõÊó•Â∏Ç': 'cl_yokkaichi'
            };
            
            if (nameMapping[name]) {
                return nameMapping[name];
            }
            
            for (const [id, info] of Object.entries(storeInfo)) {
                if (info.name === name) {
                    return id;
                }
            }
            
            const cleanName = name.replace(/[-\s]/g, '');
            for (const [mappedName, id] of Object.entries(nameMapping)) {
                if (mappedName.replace(/[-\s]/g, '') === cleanName) {
                    return id;
                }
            }
            
            return null;
        }

        function setSyncStatus(status, text) {
            const iconElement = document.getElementById('syncIcon');
            const textElement = document.getElementById('syncText');
            const statusElement = document.getElementById('syncStatus');
            
            if (iconElement) {
                switch (status) {
                    case 'loading':
                        iconElement.innerHTML = '<div class="loading"></div>';
                        statusElement.className = 'sync-status sync-loading';
                        break;
                    case 'success':
                        iconElement.textContent = '‚úÖ';
                        statusElement.className = 'sync-status sync-success';
                        break;
                    case 'error':
                        iconElement.textContent = '‚ùå';
                        statusElement.className = 'sync-status sync-error';
                        break;
                    default:
                        iconElement.textContent = '‚è≥';
                        statusElement.className = 'sync-status';
                }
            }
            
            if (textElement) {
                textElement.textContent = text;
            }
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        function setupEventListeners() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    showPage(page);
                });
            });

            const menuToggle = document.getElementById('menuToggle');
            if (menuToggle) {
                menuToggle.addEventListener('click', toggleSidebar);
            }

            setupButtonEvents();
            setupModalEvents();
            setupFilterEvents();
            setupCalendarEvents();
        }

        function setupButtonEvents() {
            const addTaskBtn = document.getElementById('addTaskBtn');
            const newTaskBtn = document.getElementById('newTaskBtn');
            const quickActionBtn = document.getElementById('quickActionBtn');
            
            if (addTaskBtn) addTaskBtn.addEventListener('click', () => openTaskModal());
            if (newTaskBtn) newTaskBtn.addEventListener('click', () => openTaskModal());
            if (quickActionBtn) quickActionBtn.addEventListener('click', showQuickActions);

            const addEventBtn = document.getElementById('addEventBtn');
            if (addEventBtn) addEventBtn.addEventListener('click', () => openEventModal());

            const syncBtn = document.getElementById('syncBtn');
            if (syncBtn) syncBtn.addEventListener('click', syncWithSpreadsheet);

            const salesStoreSelect = document.getElementById('salesStoreSelect');
            const kpiStoreSelect = document.getElementById('kpiStoreSelect');
            
            if (salesStoreSelect) {
                salesStoreSelect.addEventListener('change', (e) => updateSalesAnalysis(e.target.value));
            }
            if (kpiStoreSelect) {
                kpiStoreSelect.addEventListener('change', (e) => updateKpiAnalysis(e.target.value));
            }
        }

        function setupModalEvents() {
            const closeTaskModal = document.getElementById('closeTaskModal');
            const saveTaskBtn = document.getElementById('saveTaskBtn');
            const cancelTaskBtn = document.getElementById('cancelTaskBtn');
            
            if (closeTaskModal) closeTaskModal.addEventListener('click', () => hideModal('taskModal'));
            if (saveTaskBtn) saveTaskBtn.addEventListener('click', saveTask);
            if (cancelTaskBtn) cancelTaskBtn.addEventListener('click', () => hideModal('taskModal'));

            const closeEventModal = document.getElementById('closeEventModal');
            const saveEventBtn = document.getElementById('saveEventBtn');
            const cancelEventBtn = document.getElementById('cancelEventBtn');
            
            if (closeEventModal) closeEventModal.addEventListener('click', () => hideModal('eventModal'));
            if (saveEventBtn) saveEventBtn.addEventListener('click', saveEvent);
            if (cancelEventBtn) cancelEventBtn.addEventListener('click', () => hideModal('eventModal'));

            const taskModal = document.getElementById('taskModal');
            const eventModal = document.getElementById('eventModal');
            
            if (taskModal) {
                taskModal.addEventListener('click', (e) => {
                    if (e.target === taskModal) hideModal('taskModal');
                });
            }
            if (eventModal) {
                eventModal.addEventListener('click', (e) => {
                    if (e.target === eventModal) hideModal('eventModal');
                });
            }
        }

        function setupFilterEvents() {
            const taskSearch = document.getElementById('taskSearch');
            const priorityFilter = document.getElementById('priorityFilter');
            const statusFilter = document.getElementById('statusFilter');

            if (taskSearch) taskSearch.addEventListener('input', filterTasks);
            if (priorityFilter) priorityFilter.addEventListener('change', filterTasks);
            if (statusFilter) statusFilter.addEventListener('change', filterTasks);
        }

        function setupCalendarEvents() {
            const prevMonthBtn = document.getElementById('prevMonthBtn');
            const nextMonthBtn = document.getElementById('nextMonthBtn');

            if (prevMonthBtn) {
                prevMonthBtn.addEventListener('click', () => {
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    renderCalendar();
                });
            }

            if (nextMonthBtn) {
                nextMonthBtn.addEventListener('click', () => {
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    renderCalendar();
                });
            }
        }

        // UIÊõ¥Êñ∞Èñ¢Êï∞
        function updateDateTime() {
            const now = new Date();
            const dateElement = document.getElementById('currentDate');
            const timeElement = document.getElementById('currentTime');
            
            if (dateElement) {
                dateElement.textContent = now.toLocaleDateString('ja-JP', {
                    year: 'numeric',
                    month: 'numeric',
                    day: 'numeric',
                    weekday: 'short'
                });
            }
            
            if (timeElement) {
                timeElement.textContent = now.toLocaleTimeString('ja-JP', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function showPage(pageName) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('[data-page="' + pageName + '"]').classList.add('active');

            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageName + 'Page').classList.remove('hidden');

            const titles = {
                dashboard: '„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ',
                tasks: '„Çø„Çπ„ÇØÁÆ°ÁêÜ',
                sales: 'Â£≤‰∏äÂàÜÊûê',
                kpi: 'KPIÁÆ°ÁêÜ',
                calendar: '„Ç´„É¨„É≥„ÉÄ„Éº'
            };
            
            const titleElement = document.getElementById('currentPageTitle');
            if (titleElement) {
                titleElement.textContent = titles[pageName];
            }

            currentPage = pageName;
            renderCurrentPage();
        }

        function renderCurrentPage() {
            switch(currentPage) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'tasks':
                    renderTasks();
                    break;
                case 'sales':
                    renderSales();
                    break;
                case 'kpi':
                    renderKpi();
                    break;
                case 'calendar':
                    renderCalendar();
                    break;
            }
        }

        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâË°®Á§∫
        function renderDashboard() {
            updateDashboardStats();
            renderTodayTasks();
            renderStoresOverview();
        }

        function updateDashboardStats() {
            const totalSales = storeData.reduce((sum, store) => sum + store.totalSales, 0);
            const totalTarget = storeData.reduce((sum, store) => sum + store.salesTarget, 0);
            const totalAccess = storeData.reduce((sum, store) => sum + store.totalAccess, 0);
            const totalAttendance = storeData.reduce((sum, store) => sum + store.attendanceCount, 0);
            const achievingStores = storeData.filter(store => store.salesAchievementRate >= 1.0).length;
            const achievementRate = (totalSales / totalTarget) * 100;

            updateElement('totalSales', '¬•' + (totalSales / 1000000).toFixed(0) + 'M');
            updateElement('totalSalesRate', achievementRate.toFixed(1) + '%ÈÅîÊàê');
            updateElement('totalAccess', (totalAccess / 1000000).toFixed(1) + 'M');
            updateElement('avgAccess', 'Âπ≥Âùá ' + (totalAccess / storeData.length / 1000000).toFixed(1) + 'M');
            updateElement('totalAttendance', totalAttendance.toLocaleString());
            updateElement('avgAttendance', 'Âπ≥Âùá ' + Math.round(totalAttendance / storeData.length) + '‰∫∫');
            updateElement('achievingStores', achievingStores + '/' + storeData.length);
        }

        function renderTodayTasks() {
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = tasks.filter(task => task.dueDate === today && !task.completed);
            const container = document.getElementById('todayTasksList');

            if (todayTasks.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-4">‰ªäÊó•„ÅÆ„Çø„Çπ„ÇØ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }

            container.innerHTML = todayTasks.map(task => 
                '<div class="task-card ' + task.priority + '-priority">' +
                '<div class="flex items-center">' +
                '<input type="checkbox" onchange="toggleTask(' + task.id + ')" class="mr-3">' +
                '<div class="flex-1">' +
                '<div class="font-semibold text-gray-900">' + task.title + '</div>' +
                '<div class="text-sm text-gray-600">' + task.description + '</div>' +
                '</div>' +
                '<span class="px-2 py-1 text-xs rounded ' + getPriorityBadgeClass(task.priority) + '">' + getPriorityText(task.priority) + '</span>' +
                '</div>' +
                '</div>'
            ).join('');
        }

        function renderStoresOverview() {
            const container = document.getElementById('storesOverview');
            
            container.innerHTML = storeData.map(store => 
                '<div class="bg-white p-4 rounded-lg border cursor-pointer hover:shadow-lg transition-all" onclick="showStoreDetails(\'' + store.id + '\')">' +
                '<div class="flex items-center justify-between mb-3">' +
                '<h4 class="font-semibold text-gray-900">' + store.name + '</h4>' +
                '<span class="text-lg">' + getBrandEmoji(storeInfo[store.id]?.type) + '</span>' +
                '</div>' +
                '<div class="space-y-2">' +
                '<div class="flex justify-between text-sm">' +
                '<span>Â£≤‰∏äÈÅîÊàêÁéá</span>' +
                '<span class="font-bold ' + (store.salesAchievementRate >= 1.0 ? 'text-green-600' : 'text-red-600') + '">' +
                (store.salesAchievementRate * 100).toFixed(1) + '%' +
                '</span>' +
                '</div>' +
                '<div class="flex justify-between text-sm">' +
                '<span>Â£≤‰∏äÂÆüÁ∏æ</span>' +
                '<span class="font-bold text-blue-600">¬•' + (store.totalSales / 1000000).toFixed(1) + 'M</span>' +
                '</div>' +
                '<div class="w-full bg-gray-200 rounded-full h-2">' +
                '<div class="bg-blue-500 h-2 rounded-full" style="width: ' + Math.min(100, store.salesAchievementRate * 100) + '%"></div>' +
                '</div>' +
                '</div>' +
                '</div>'
            ).join('');

            updateStoreSelects();
        }

        function updateStoreSelects() {
            const salesSelect = document.getElementById('salesStoreSelect');
            const kpiSelect = document.getElementById('kpiStoreSelect');

            const options = storeData.map(store => 
                '<option value="' + store.id + '">' + store.name + '</option>'
            ).join('');

            if (salesSelect) {
                salesSelect.innerHTML = '<option value="">ÂÖ®Â∫óËàóÁµ±Âêà</option>' + options;
            }
            if (kpiSelect) {
                kpiSelect.innerHTML = '<option value="">ÂÖ®Â∫óËàóÁµ±Âêà</option>' + options;
            }
        }

        // „Çø„Çπ„ÇØÁÆ°ÁêÜ
        function renderTasks() {
            const filteredTasks = getFilteredTasks();
            const container = document.getElementById('tasksList');

            if (filteredTasks.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">Êù°‰ª∂„Å´‰∏ÄËá¥„Åô„Çã„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }

            container.innerHTML = filteredTasks.map(task => 
                '<div class="task-card ' + (task.completed ? 'completed' : '') + ' ' + task.priority + '-priority">' +
                '<div class="flex items-center">' +
                '<input type="checkbox" ' + (task.completed ? 'checked' : '') + ' onchange="toggleTask(' + task.id + ')" class="mr-3">' +
                '<div class="flex-1">' +
                '<div class="font-semibold text-gray-900 ' + (task.completed ? 'line-through' : '') + '">' + task.title + '</div>' +
                '<div class="text-sm text-gray-600">' + task.description + '</div>' +
                '<div class="text-xs text-gray-500 mt-1">ÊúüÈôê: ' + formatDate(task.dueDate) + '</div>' +
                '</div>' +
                '<div class="flex items-center space-x-2">' +
                '<span class="px-2 py-1 text-xs rounded ' + getPriorityBadgeClass(task.priority) + '">' + getPriorityText(task.priority) + '</span>' +
                '<button onclick="editTask(' + task.id + ')" class="text-blue-600 hover:text-blue-800">' +
                '<i class="fas fa-edit"></i>' +
                '</button>' +
                '<button onclick="deleteTask(' + task.id + ')" class="text-red-600 hover:text-red-800">' +
                '<i class="fas fa-trash"></i>' +
                '</button>' +
                '</div>' +
                '</div>' +
                '</div>'
            ).join('');
        }

        function openTaskModal(taskId = null) {
            editingTaskId = taskId;
            
            const modalTitle = document.getElementById('taskModalTitle');
            if (modalTitle) {
                modalTitle.textContent = taskId ? '„Çø„Çπ„ÇØ„ÇíÁ∑®ÈõÜ' : 'Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ';
            }
            
            if (taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    document.getElementById('taskTitle').value = task.title;
                    document.getElementById('taskDescription').value = task.description;
                    document.getElementById('taskPriority').value = task.priority;
                    document.getElementById('taskDueDate').value = task.dueDate;
                }
            } else {
                document.getElementById('taskTitle').value = '';
                document.getElementById('taskDescription').value = '';
                document.getElementById('taskPriority').value = 'medium';
                document.getElementById('taskDueDate').value = new Date().toISOString().split('T')[0];
            }

            showModal('taskModal');
        }

        function saveTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const priority = document.getElementById('taskPriority').value;
            const dueDate = document.getElementById('taskDueDate').value;

            if (!title) {
                showNotification('„Çø„Çπ„ÇØÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            if (editingTaskId) {
                const taskIndex = tasks.findIndex(t => t.id === editingTaskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex] = Object.assign({}, tasks[taskIndex], { title: title, description: description, priority: priority, dueDate: dueDate });
                }
                showNotification('„Çø„Çπ„ÇØ„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü', 'success');
            } else {
                const newTask = {
                    id: Date.now(),
                    title: title,
                    description: description,
                    priority: priority,
                    dueDate: dueDate,
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                tasks.push(newTask);
                showNotification('„Çø„Çπ„ÇØ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü', 'success');
            }

            saveToLocalStorage();
            hideModal('taskModal');
            renderCurrentPage();
        }

        function toggleTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveToLocalStorage();
                renderCurrentPage();
                showNotification(task.completed ? '„Çø„Çπ„ÇØ„ÇíÂÆå‰∫Ü„Åó„Åæ„Åó„Åü' : '„Çø„Çπ„ÇØ„ÇíÊú™ÂÆå‰∫Ü„Å´Êàª„Åó„Åæ„Åó„Åü', 'success');
            }
        }

        function editTask(taskId) {
            openTaskModal(taskId);
        }

        function deleteTask(taskId) {
            if (confirm('„Åì„ÅÆ„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                tasks = tasks.filter(t => t.id !== taskId);
                saveToLocalStorage();
                renderCurrentPage();
                showNotification('„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'success');
            }
        }

        function getFilteredTasks() {
            const searchTerm = document.getElementById('taskSearch')?.value.toLowerCase() || '';
            const priorityFilter = document.getElementById('priorityFilter')?.value || '';
            const statusFilter = document.getElementById('statusFilter')?.value || '';

            return tasks.filter(task => {
                const matchesSearch = task.title.toLowerCase().includes(searchTerm) || 
                                    task.description.toLowerCase().includes(searchTerm);
                const matchesPriority = !priorityFilter || task.priority === priorityFilter;
                const matchesStatus = !statusFilter || 
                                    (statusFilter === 'completed' && task.completed) ||
                                    (statusFilter === 'pending' && !task.completed);

                return matchesSearch && matchesPriority && matchesStatus;
            });
        }

        function filterTasks() {
            renderTasks();
        }

        // Â£≤‰∏äÂàÜÊûê
        function renderSales() {
            updateSalesStats();
            updateStoreRanking();
            renderSalesChart();
        }

        function updateSalesAnalysis(storeId) {
            if (storeId === '') {
                updateSalesStats();
            } else {
                const store = storeData.find(s => s.id === storeId);
                if (store) {
                    updateElement('selectedSales', '¬•' + (store.totalSales / 1000000).toFixed(1) + 'M');
                    updateElement('selectedTarget', '¬•' + (store.salesTarget / 1000000).toFixed(1) + 'M');
                    updateElement('selectedRate', (store.salesAchievementRate * 100).toFixed(1) + '%');
                    updateElement('selectedAccess', (store.totalAccess / 1000000).toFixed(1) + 'M');
                }
            }
            updateStoreRanking();
            renderSalesChart();
        }

        function updateSalesStats() {
            const totalSales = storeData.reduce((sum, store) => sum + store.totalSales, 0);
            const totalTarget = storeData.reduce((sum, store) => sum + store.salesTarget, 0);
            const totalAccess = storeData.reduce((sum, store) => sum + store.totalAccess, 0);
            const achievementRate = (totalSales / totalTarget) * 100;

            updateElement('selectedSales', '¬•' + (totalSales / 1000000).toFixed(0) + 'M');
            updateElement('selectedTarget', '¬•' + (totalTarget / 1000000).toFixed(0) + 'M');
            updateElement('selectedRate', achievementRate.toFixed(1) + '%');
            updateElement('selectedAccess', (totalAccess / 1000000).toFixed(1) + 'M');
        }

        function updateStoreRanking() {
            const sortedStores = storeData.slice().sort((a, b) => b.totalSales - a.totalSales);
            const container = document.getElementById('storeRanking');

            container.innerHTML = sortedStores.map((store, index) => 
                '<div class="bg-white p-4 rounded-lg border">' +
                '<div class="flex items-center justify-between">' +
                '<div class="flex items-center">' +
                '<span class="text-xl mr-3">' + getRankingEmoji(index + 1) + '</span>' +
                '<div>' +
                '<div class="font-semibold text-gray-900">' + store.name + '</div>' +
                '<div class="text-sm text-gray-600">ÈÅîÊàêÁéá: ' + (store.salesAchievementRate * 100).toFixed(1) + '%</div>' +
                '</div>' +
                '</div>' +
                '<div class="text-right">' +
                '<div class="font-bold text-lg text-blue-600">¬•' + (store.totalSales / 1000000).toFixed(1) + 'M</div>' +
                '<div class="text-xs ' + (store.salesAchievementRate >= 1.0 ? 'text-green-600' : 'text-red-600') + '">' +
                (store.salesAchievementRate >= 1.0 ? 'ÈÅîÊàê' : 'Êú™ÈÅîÊàê') +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>'
            ).join('');
        }

        function renderSalesChart() {
            const canvas = document.getElementById('salesChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            if (salesChart) {
                salesChart.destroy();
            }

            const selectedStoreId = document.getElementById('salesStoreSelect')?.value;
            let chartData;

            if (selectedStoreId) {
                const store = storeData.find(s => s.id === selectedStoreId);
                chartData = {
                    labels: [store.name],
                    datasets: [
                        {
                            label: 'Â£≤‰∏äÂÆüÁ∏æ',
                            data: [store.totalSales / 1000000],
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 2
                        },
                        {
                            label: 'Â£≤‰∏äÁõÆÊ®ô',
                            data: [store.salesTarget / 1000000],
                            backgroundColor: 'rgba(16, 185, 129, 0.6)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2
                        }
                    ]
                };
            } else {
                chartData = {
                    labels: storeData.map(store => store.name),
                    datasets: [
                        {
                            label: 'Â£≤‰∏äÂÆüÁ∏æ (MÂÜÜ)',
                            data: storeData.map(store => store.totalSales / 1000000),
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 2
                        }
                    ]
                };
            }

            salesChart = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: selectedStoreId ? 'ÂÄãÂà•Â∫óËàóÂ£≤‰∏ä' : 'ÂÖ®Â∫óËàóÂ£≤‰∏äÂÆüÁ∏æ'
                        },
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Â£≤‰∏ä (Áôæ‰∏áÂÜÜ)'
                            }
                        }
                    }
                }
            });
        }

        // KPIÁÆ°ÁêÜ
        function renderKpi() {
            updateKpiStats();
            updateKpiTable();
        }

        function updateKpiAnalysis(storeId) {
            if (storeId === '') {
                updateKpiStats();
            } else {
                const store = storeData.find(s => s.id === storeId);
                if (store) {
                    updateElement('kpiDiaryPosts', store.diaryPosts.toLocaleString());
                    updateElement('kpiReviews', store.reviewPosts.toLocaleString());
                    updateElement('kpiKitene', store.kiteneCount ? store.kiteneCount.toLocaleString() : 'N/A');
                    updateElement('kpiUsers', store.userCount ? store.userCount.toLocaleString() : 'N/A');
                }
            }
            updateKpiTable();
        }

        function updateKpiStats() {
            const totalDiary = storeData.reduce((sum, store) => sum + store.diaryPosts, 0);
            const totalReviews = storeData.reduce((sum, store) => sum + store.reviewPosts, 0);
            const totalKitene = storeData.reduce((sum, store) => sum + (store.kiteneCount || 0), 0);
            const totalUsers = storeData.reduce((sum, store) => sum + (store.userCount || 0), 0);

            updateElement('kpiDiaryPosts', totalDiary.toLocaleString());
            updateElement('kpiReviews', totalReviews.toLocaleString());
            updateElement('kpiKitene', totalKitene.toLocaleString());
            updateElement('kpiUsers', totalUsers.toLocaleString());
        }

        function updateKpiTable() {
            const container = document.getElementById('kpiDataTable');
            
            container.innerHTML = storeData.map(store => 
                '<tr class="hover:bg-gray-50">' +
                '<td class="p-3 font-medium">' + store.name + '</td>' +
                '<td class="p-3">' +
                '<span class="px-2 py-1 rounded text-xs font-semibold ' + (store.salesAchievementRate >= 1.0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800') + '">' +
                (store.salesAchievementRate * 100).toFixed(1) + '%' +
                '</span>' +
                '</td>' +
                '<td class="p-3">' +
                '<span class="px-2 py-1 rounded text-xs font-semibold ' + (store.diaryAchievementRate >= 1.0 ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800') + '">' +
                (store.diaryAchievementRate * 100).toFixed(1) + '%' +
                '</span>' +
                '</td>' +
                '<td class="p-3">' +
                '<span class="px-2 py-1 rounded text-xs font-semibold ' + (store.reviewAchievementRate >= 1.0 ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800') + '">' +
                (store.reviewAchievementRate * 100).toFixed(1) + '%' +
                '</span>' +
                '</td>' +
                '<td class="p-3 font-bold text-purple-600">' + store.totalAccess.toLocaleString() + '</td>' +
                '</tr>'
            ).join('');
        }

        // „Ç§„Éô„É≥„Éà„Éª„Ç´„É¨„É≥„ÉÄ„ÉºÁÆ°ÁêÜ
        function renderCalendar() {
            updateCalendarTitle();
            renderWeeklySchedule();
        }

        function updateCalendarTitle() {
            const title = document.getElementById('calendarTitle');
            if (title) {
                title.textContent = currentYear + 'Âπ¥' + (currentMonth + 1) + 'Êúà';
            }
        }

        function renderWeeklySchedule() {
            const container = document.getElementById('weeklySchedule');
            const weekDays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());

            let weekHTML = '';
            for (let i = 0; i < 7; i++) {
                const currentDay = new Date(startOfWeek);
                currentDay.setDate(startOfWeek.getDate() + i);
                const dateStr = currentDay.toISOString().split('T')[0];
                const dayEvents = events.filter(event => event.date === dateStr);
                const isToday = dateStr === today.toISOString().split('T')[0];

                weekHTML += 
                    '<div class="bg-white rounded-lg p-3 min-h-[100px] border ' + (isToday ? 'border-blue-500 bg-blue-50' : '') + '">' +
                    '<div class="font-semibold mb-2">' + weekDays[i] + ' ' + currentDay.getDate() + '</div>' +
                    dayEvents.map(event => 
                        '<div class="text-xs p-1 rounded mb-1 cursor-pointer ' + getEventClass(event.type) + '" onclick="editEvent(' + event.id + ')">' +
                        event.title +
                        '</div>'
                    ).join('') +
                    '</div>';
            }
            container.innerHTML = weekHTML;
        }

        function openEventModal(eventId = null) {
            editingEventId = eventId;
            
            const modalTitle = document.getElementById('eventModalTitle');
            if (modalTitle) {
                modalTitle.textContent = eventId ? '‰∫àÂÆö„ÇíÁ∑®ÈõÜ' : 'Êñ∞„Åó„ÅÑ‰∫àÂÆö';
            }
            
            if (eventId) {
                const event = events.find(e => e.id === eventId);
                if (event) {
                    document.getElementById('eventTitle').value = event.title;
                    document.getElementById('eventDescription').value = event.description;
                    document.getElementById('eventType').value = event.type;
                    document.getElementById('eventDate').value = event.date;
                }
            } else {
                document.getElementById('eventTitle').value = '';
                document.getElementById('eventDescription').value = '';
                document.getElementById('eventType').value = 'meeting';
                document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];
            }

            showModal('eventModal');
        }

        function saveEvent() {
            const title = document.getElementById('eventTitle').value.trim();
            const description = document.getElementById('eventDescription').value.trim();
            const type = document.getElementById('eventType').value;
            const date = document.getElementById('eventDate').value;

            if (!title || !date) {
                showNotification('‰∫àÂÆöÂêç„Å®Êó•‰ªò„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            if (editingEventId) {
                const eventIndex = events.findIndex(e => e.id === editingEventId);
                if (eventIndex !== -1) {
                    events[eventIndex] = Object.assign({}, events[eventIndex], { title: title, description: description, type: type, date: date });
                }
                showNotification('‰∫àÂÆö„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü', 'success');
            } else {
                const newEvent = {
                    id: Date.now(),
                    title: title,
                    description: description,
                    type: type,
                    date: date
                };
                events.push(newEvent);
                showNotification('‰∫àÂÆö„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü', 'success');
            }

            saveToLocalStorage();
            hideModal('eventModal');
            renderCurrentPage();
        }

        function editEvent(eventId) {
            openEventModal(eventId);
        }

        function deleteEvent(eventId) {
            if (confirm('„Åì„ÅÆ‰∫àÂÆö„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                events = events.filter(e => e.id !== eventId);
                saveToLocalStorage();
                renderCurrentPage();
                showNotification('‰∫àÂÆö„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'success');
            }
        }

        // „Åù„ÅÆ‰ªñ„ÅÆÊ©üËÉΩ
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        function showQuickActions() {
            const content = 
                '<div class="space-y-3">' +
                '<h3 class="text-lg font-bold text-gray-900 mb-4">„ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Ç∑„Éß„É≥</h3>' +
                '<button class="btn btn-outline w-full justify-start" onclick="openTaskModal(); closeQuickActions();">' +
                '<i class="fas fa-plus mr-3"></i>„Çø„Çπ„ÇØËøΩÂä†' +
                '</button>' +
                '<button class="btn btn-outline w-full justify-start" onclick="openEventModal(); closeQuickActions();">' +
                '<i class="fas fa-calendar mr-3"></i>‰∫àÂÆöËøΩÂä†' +
                '</button>' +
                '<button class="btn btn-primary w-full justify-start" onclick="syncWithSpreadsheet(); closeQuickActions();">' +
                '<i class="fas fa-sync mr-3"></i>„Éá„Éº„ÇøÂêåÊúü' +
                '</button>' +
                '<button class="btn btn-success w-full justify-start" onclick="showSpreadsheetGuide(); closeQuickActions();">' +
                '<i class="fas fa-table mr-3"></i>„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàË®≠ÂÆö„Ç¨„Ç§„Éâ' +
                '</button>' +
                '<button class="btn btn-outline w-full justify-start" onclick="downloadSpreadsheetTemplate(); closeQuickActions();">' +
                '<i class="fas fa-download mr-3"></i>ÊîπËâØÁâà„ÉÜ„É≥„Éó„É¨„Éº„ÉàDL' +
                '</button>' +
                '<button class="btn btn-outline w-full justify-start" onclick="exportData(); closeQuickActions();">' +
                '<i class="fas fa-download mr-3"></i>„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà' +
                '</button>' +
                '</div>';

            showCustomModal('„ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Ç∑„Éß„É≥', content);
        }

        function closeQuickActions() {
            document.querySelectorAll('.modal').forEach(modal => {
                if (!modal.id.includes('taskModal') && !modal.id.includes('eventModal')) {
                    modal.remove();
                }
            });
        }

        function exportData() {
            const data = {
                tasks: tasks,
                events: events,
                storeData: storeData,
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'classy_data_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü', 'success');
        }

        function downloadSpreadsheetTemplate() {
            // ÊîπËâØ„Åï„Çå„ÅüKPIÁÆ°ÁêÜ„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÁîüÊàê
            const templateData = generateEnhancedSpreadsheetTemplate();
            
            const blob = new Blob([templateData], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'CLASSY_KPIÁÆ°ÁêÜ„ÉÜ„É≥„Éó„É¨„Éº„Éà_ÊîπËâØÁâà_' + new Date().toISOString().split('T')[0] + '.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('ÊîπËâØÁâàKPIÁÆ°ÁêÜ„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü', 'success');
        }

        function generateEnhancedSpreadsheetTemplate() {
            // UTF-8 BOM„ÇíËøΩÂä†„Åó„Å¶Excel„ÅßÊñáÂ≠óÂåñ„Åë„ÇíÈò≤„Åê
            const BOM = '\uFEFF';
            
            // ÊîπËâØ„Åï„Çå„Åü„Éò„ÉÉ„ÉÄ„ÉºË°åÔºàKPIÈáçË¶ñ„ÅÆÊßãÈÄ†Ôºâ
            const headers = [
                'Â∫óËàóÂêç',
                'Â£≤‰∏äÂÆüÁ∏æ',
                'Â£≤‰∏äÁõÆÊ®ô',
                'ÂÜô„É°Êó•Ë®òÊäïÁ®øÊï∞',
                'ÂÜô„É°Êó•Ë®òÊúàÈñìÁõÆÊ®ô',
                'Êó•Ë®ò1Êó•Âπ≥Âùá',
                'Âè£„Ç≥„ÉüÁ∑èÊï∞',
                'Âè£„Ç≥„ÉüÊúàÈñìÁõÆÊ®ô',
                '„Ç≠„ÉÜ„ÉçÈÄÅ‰ø°Êï∞',
                '„Ç≠„ÉÜ„ÉçÊúàÈñìÁõÆÊ®ô',
                '„Ç≠„ÉÜ„Éç1Êó•Âπ≥Âùá',
                '„Ç¢„ÇØ„Çª„ÇπÊï∞',
                'Âá∫Âã§‰∫∫Êï∞',
                'Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞',
                '„Éñ„É©„É≥„Éâ',
                'ÈáçÁÇπKPI',
                'ÊîπÂñÑÁÇπ',
                'ÂÇôËÄÉ'
            ].join(',');

            // ÂÆüÈöõ„ÅÆ„Éì„Ç∏„Éç„Çπ„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„ÅüÂêÑÂ∫óËàó„ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà„Éá„Éº„Çø
            const templateRows = [
                '„Ç∑„É£„Éñ„Éº„É´,29544738,33000000,7560,8000,252,344,300,2500,2800,83,1967152,687,45,Premium,ÂÜô„É°Êó•Ë®òÂº∑Âåñ,„Ç¢„ÇØ„Çª„ÇπÊï∞Âêë‰∏ä,È´òÁ¥öÂ∫óËàó',
                '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà,18314356,17500000,8528,8000,275,156,200,1800,2000,60,1241592,514,32,Premium,Âè£„Ç≥„ÉüÂ¢óÂä†,Â£≤‰∏äÂÆâÂÆö,ÁõÆÊ®ôÈÅîÊàêÂ∫óËàó',
                'GOÂêçÂè§Â±ã,29265025,28000000,3605,5400,116,216,205,1900,2100,63,1349912,518,35,GrandOpera,Êó•Ë®òÊäïÁ®øÂº∑Âåñ,Á∂ôÁ∂öÊäïÁ®ø,‰∏≠ÈÉ®„Ç®„É™„Ç¢‰∏ªÂäõ',
                'GOÁ¶èÂ≤°,37050068,36000000,7828,7500,253,202,180,2300,2500,77,1619670,514,38,GrandOpera,Âè£„Ç≥„ÉüÁ∂≠ÊåÅ,„Ç≠„ÉÜ„ÉçÂº∑Âåñ,‰πùÂ∑û„Ç®„É™„Ç¢ÊúÄÈ´ò',
                'GOÊù±‰∫¨,27324427,28000000,4164,7500,134,116,150,1700,2000,57,1182336,457,30,GrandOpera,ÂÖ®KPIÊîπÂñÑ,Êó•Ë®òÊäïÁ®øÂ¢ó,È¶ñÈÉΩÂúèÊà¶Áï•Â∫ó',
                'GOÊ®™Êµú,22547274,23000000,5077,6000,164,127,130,1600,1800,53,599756,407,28,GrandOpera,„Ç¢„ÇØ„Çª„ÇπÂêë‰∏ä,Â£≤‰∏äÈÅîÊàê,Á•ûÂ•àÂ∑ù‰∏ªÂäõ',
                '„Ç™„Éö„É©Èå¶,25123456,24000000,7068,7000,228,195,180,2000,2200,67,1273548,480,33,GrandOpera,KPIÁ∂≠ÊåÅ,ÂÆâÂÆöÈÅãÂñ∂,ÂêçÂè§Â±ã‰∏≠ÂøÉÈÉ®',
                'CLÂêçÂè§Â±ã,5300320,6000000,1851,2400,60,113,150,800,1000,27,514243,197,18,CLASSY,ÂÖ®‰ΩìÂ∫ï‰∏ä„Åí,Â£≤‰∏äÂêë‰∏ä,‰∏≠ÈÉ®CLASSY',
                'CLÊù±‰∫¨,6719328,7200000,2079,3000,67,122,120,900,1100,30,742231,238,20,CLASSY,Êó•Ë®òÂº∑Âåñ,Âè£„Ç≥„ÉüÁ∂≠ÊåÅ,È¶ñÈÉΩÂúèCLASSY',
                'CLÂõõÊó•Â∏Ç,12943296,12500000,6301,6200,203,256,240,1400,1500,47,881476,356,25,CLASSY,KPIÂÑ™ÁßÄ,ÈÅãÂñ∂Á∂ôÁ∂ö,Êù±Êµ∑Âú∞Âå∫„Éà„ÉÉ„Éó'
            ];

            return BOM + headers + '\n' + templateRows.join('\n');
        }

        function downloadKPICalculationGuide() {
            // KPIË®àÁÆóÊñπÊ≥ï„ÅÆË©≥Á¥∞„Ç¨„Ç§„Éâ„ÇíÁîüÊàê
            const guideContent = generateKPICalculationGuide();
            
            const blob = new Blob([guideContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'CLASSY_KPIË®àÁÆó„Ç¨„Ç§„Éâ_' + new Date().toISOString().split('T')[0] + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('KPIË®àÁÆó„Ç¨„Ç§„Éâ„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü', 'success');
        }

        function generateKPICalculationGuide() {
            return `CLASSY „Ç∞„É´„Éº„Éó KPIÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† Ë®àÁÆó„Ç¨„Ç§„Éâ
ÁîüÊàêÊó•ÊôÇ: ${new Date().toLocaleString('ja-JP')}

============================================
üìä ‰∏ªË¶ÅKPIÈ†ÖÁõÆ„Å®Ë®àÁÆóÊñπÊ≥ï
============================================

„ÄêÂ£≤‰∏äKPI„Äë
„ÉªÂ£≤‰∏äÂÆüÁ∏æ: ÊúàÈñìÁ∑èÂ£≤‰∏äÈáëÈ°ç
„ÉªÂ£≤‰∏äÁõÆÊ®ô: ÊúàÈñìÂ£≤‰∏äÁõÆÊ®ôÈáëÈ°ç
„ÉªÈÅîÊàêÁéáË®àÁÆó: Â£≤‰∏äÂÆüÁ∏æ √∑ Â£≤‰∏äÁõÆÊ®ô √ó 100

„ÄêÂÜô„É°Êó•Ë®òKPI„Äë
„ÉªÊäïÁ®øÊï∞: ÊúàÈñìÁ∑èÊäïÁ®øÊï∞
„ÉªÊúàÈñìÁõÆÊ®ô: ÊúàÈñìÊäïÁ®øÁõÆÊ®ôÊï∞
„Éª1Êó•Âπ≥Âùá: ÊäïÁ®øÊï∞ √∑ Âñ∂Ê•≠Êó•Êï∞
„ÉªÈÅîÊàêÁéáË®àÁÆó: ÊäïÁ®øÊï∞ √∑ ÊúàÈñìÁõÆÊ®ô √ó 100
„ÉªÊé®Â•®Ë®≠ÂÆö: Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞ √ó 8„Äú10ÊäïÁ®ø/Êó•

„ÄêÂè£„Ç≥„ÉüKPI„Äë
„ÉªÁ∑èÊï∞: ÊúàÈñìÂè£„Ç≥„ÉüÁç≤ÂæóÊï∞
„ÉªÊúàÈñìÁõÆÊ®ô: ÊúàÈñìÂè£„Ç≥„ÉüÁõÆÊ®ôÊï∞
„ÉªÈÅîÊàêÁéáË®àÁÆó: Á∑èÊï∞ √∑ ÊúàÈñìÁõÆÊ®ô √ó 100
„ÉªÊé®Â•®Ë®≠ÂÆö: Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞ √ó 8„Äú12‰ª∂/Êúà

„Äê„Ç≠„ÉÜ„ÉçKPI„Äë
„ÉªÈÄÅ‰ø°Êï∞: ÊúàÈñì„Ç≠„ÉÜ„ÉçÈÄÅ‰ø°Á∑èÊï∞
„ÉªÊúàÈñìÁõÆÊ®ô: ÊúàÈñìÈÄÅ‰ø°ÁõÆÊ®ôÊï∞
„Éª1Êó•Âπ≥Âùá: ÈÄÅ‰ø°Êï∞ √∑ Âñ∂Ê•≠Êó•Êï∞
„ÉªÈÅîÊàêÁéáË®àÁÆó: ÈÄÅ‰ø°Êï∞ √∑ ÊúàÈñìÁõÆÊ®ô √ó 100
„ÉªÊé®Â•®Ë®≠ÂÆö: Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞ √ó 80„Äú120‰ª∂/Êúà

============================================
üéØ „Éñ„É©„É≥„ÉâÂà•KPIÂü∫Ê∫ñÂÄ§
============================================

„ÄêPremiumÂ∫óËàóÔºà„Ç∑„É£„Éñ„Éº„É´„Éª„ÉØ„É≥„Ç´„É©„ÉÉ„ÉàÔºâ„Äë
„ÉªÂ£≤‰∏äÁõÆÊ®ô: 17M„Äú35MÂÜÜ
„ÉªÊó•Ë®ò1Êó•Âπ≥Âùá: 250„Äú280ÊäïÁ®ø
„ÉªÂè£„Ç≥„ÉüÊúàÈñì: 200„Äú350‰ª∂
„Éª„Ç≠„ÉÜ„Éç1Êó•Âπ≥Âùá: 60„Äú85‰ª∂

„ÄêGrandOperaÂ∫óËàó„Äë
„ÉªÂ£≤‰∏äÁõÆÊ®ô: 23M„Äú36MÂÜÜ
„ÉªÊó•Ë®ò1Êó•Âπ≥Âùá: 120„Äú250ÊäïÁ®ø
„ÉªÂè£„Ç≥„ÉüÊúàÈñì: 130„Äú220‰ª∂
„Éª„Ç≠„ÉÜ„Éç1Êó•Âπ≥Âùá: 53„Äú77‰ª∂

„ÄêCLASSYÂ∫óËàó„Äë
„ÉªÂ£≤‰∏äÁõÆÊ®ô: 6M„Äú13MÂÜÜ
„ÉªÊó•Ë®ò1Êó•Âπ≥Âùá: 60„Äú203ÊäïÁ®ø
„ÉªÂè£„Ç≥„ÉüÊúàÈñì: 113„Äú256‰ª∂
„Éª„Ç≠„ÉÜ„Éç1Êó•Âπ≥Âùá: 27„Äú47‰ª∂

============================================
üìà ÁõÆÊ®ôË®≠ÂÆö„ÅÆË®àÁÆóÂºè
============================================

„ÄêÂÜô„É°Êó•Ë®òÁõÆÊ®ô„Äë
Âü∫Êú¨Ë®àÁÆó: Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞ √ó ÁõÆÊ®ôÊäïÁ®øÊï∞/Êó• √ó Âñ∂Ê•≠Êó•Êï∞
‰æã: 30‰∫∫ √ó 8ÊäïÁ®ø/Êó• √ó 30Êó• = 7,200ÊäïÁ®ø/Êúà

„ÄêÂè£„Ç≥„ÉüÁõÆÊ®ô„Äë
Âü∫Êú¨Ë®àÁÆó: Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞ √ó ÁõÆÊ®ôÂè£„Ç≥„ÉüÊï∞/Êúà
‰æã: 30‰∫∫ √ó 8‰ª∂/Êúà = 240‰ª∂/Êúà

„Äê„Ç≠„ÉÜ„ÉçÁõÆÊ®ô„Äë
Âü∫Êú¨Ë®àÁÆó: Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞ √ó ÁõÆÊ®ôÈÄÅ‰ø°Êï∞/Êúà
‰æã: 30‰∫∫ √ó 100‰ª∂/Êúà = 3,000‰ª∂/Êúà

„ÄêÂ£≤‰∏äÁõÆÊ®ô„Äë
ÂâçÂπ¥ÂêåÊúàÊØî110%„Åæ„Åü„ÅØÊ•≠ÁïåÊ®ôÊ∫ñ„ÇíÂèÇËÄÉ„Å´Ë®≠ÂÆö

============================================
‚ö†Ô∏è „Éá„Éº„ÇøÂÖ•ÂäõÊôÇ„ÅÆÊ≥®ÊÑèÁÇπ
============================================

1. Êï∞ÂÄ§„ÅØÂçäËßíÊï∞Â≠ó„ÅßÂÖ•ÂäõÔºà„Ç´„É≥„ÉûÂå∫Âàá„ÇäÂèØÔºâ
2. Â∫óËàóÂêç„ÅØÊ≠£Á¢∫„Å´ÂÖ•ÂäõÔºàËá™ÂãïË™çË≠òÔºâ
3. Á©∫Ê¨Ñ„ÅØ0„Åæ„Åü„ÅØÂâçÊúàÂÄ§„ÅßË£úÂÆå
4. ÁõÆÊ®ôÂÄ§„ÅØÁèæÂÆüÁöÑ„Å™Êï∞ÂÄ§„Å´Ë®≠ÂÆö
5. ÂÇôËÄÉÊ¨Ñ„ÅßÁâπË®ò‰∫ãÈ†Ö„ÇíË®òËºâ

============================================
üîÑ „Ç∑„Çπ„ÉÜ„É†ÂêåÊúüÊñπÊ≥ï
============================================

1. „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åß„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
2. ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†„ÅÆ„ÄåÂêåÊúü„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
3. Ëá™ÂãïÁöÑ„Å´ÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂèñÂæó„ÉªÂàÜÊûê
4. „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅßÁµêÊûú„ÇíÁ¢∫Ë™ç

============================================
üìû „Çµ„Éù„Éº„ÉàÊÉÖÂ†±
============================================

„Éá„Éº„Çø‰∏çÊï¥Âêà„ÇÑÂêåÊúü„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„ÅüÂ†¥ÂêàÔºö
„Éª„Éñ„É©„Ç¶„Ç∂„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´„ÅßfixSpreadsheetNow()ÂÆüË°å
„Éª„Åæ„Åü„ÅØforceResetStoreData()„ÅßÂÆåÂÖ®„É™„Çª„ÉÉ„Éà

„Åì„ÅÆ„Ç¨„Ç§„Éâ„ÅØÂÆöÊúüÁöÑ„Å´Êõ¥Êñ∞„Åï„Çå„Åæ„Åô„ÄÇ
ÊúÄÊñ∞Áâà„ÅØÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†„Åã„Çâ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
        }

        function showSpreadsheetGuide() {
            const guideContent = 
                '<div class="space-y-6 text-sm max-h-96 overflow-y-auto">' +
                '<div>' +
                '<h4 class="font-bold text-blue-600 mb-2">üìä ÊîπËâØÁâà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÊßãÈÄ†</h4>' +
                '<p class="text-gray-600 mb-3">KPIÈáçË¶ñ„ÅÆÊñ∞„Åó„ÅÑÂàóÊßãÈÄ†Ôºà18È†ÖÁõÆÔºâÔºö</p>' +
                '<div class="bg-gray-50 p-3 rounded text-xs font-mono overflow-x-auto">' +
                'Â∫óËàóÂêç | Â£≤‰∏äÂÆüÁ∏æ | Â£≤‰∏äÁõÆÊ®ô | ÂÜô„É°Êó•Ë®òÊäïÁ®øÊï∞ | ÂÜô„É°Êó•Ë®òÊúàÈñìÁõÆÊ®ô | Êó•Ë®ò1Êó•Âπ≥Âùá | Âè£„Ç≥„ÉüÁ∑èÊï∞ | Âè£„Ç≥„ÉüÊúàÈñìÁõÆÊ®ô | „Ç≠„ÉÜ„ÉçÈÄÅ‰ø°Êï∞ | „Ç≠„ÉÜ„ÉçÊúàÈñìÁõÆÊ®ô | „Ç≠„ÉÜ„Éç1Êó•Âπ≥Âùá | „Ç¢„ÇØ„Çª„ÇπÊï∞ | Âá∫Âã§‰∫∫Êï∞ | Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞ | „Éñ„É©„É≥„Éâ | ÈáçÁÇπKPI | ÊîπÂñÑÁÇπ | ÂÇôËÄÉ' +
                '</div>' +
                '</div>' +
                
                '<div>' +
                '<h4 class="font-bold text-green-600 mb-2">üéØ KPIÁõÆÊ®ôË®≠ÂÆö„Ç¨„Ç§„ÉâÔºàÊîπËâØÁâàÔºâ</h4>' +
                '<ul class="list-disc list-inside space-y-1 text-gray-700">' +
                '<li><strong>Â£≤‰∏äÁõÆÊ®ô</strong>: ÊúàÊ¨°Â£≤‰∏äÁõÆÊ®ôÈáëÈ°çÔºàÂâçÂπ¥ÂêåÊúàÊØî110%Êé®Â•®Ôºâ</li>' +
                '<li><strong>ÂÜô„É°Êó•Ë®òÁõÆÊ®ô</strong>: Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞ √ó 8„Äú10ÊäïÁ®ø/Êó• √ó Âñ∂Ê•≠Êó•Êï∞</li>' +
                '<li><strong>Âè£„Ç≥„ÉüÁõÆÊ®ô</strong>: Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞ √ó 8„Äú12‰ª∂/Êúà</li>' +
                '<li><strong>„Ç≠„ÉÜ„ÉçÁõÆÊ®ô</strong>: Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞ √ó 80„Äú120‰ª∂/Êúà</li>' +
                '<li><strong>Êó•Ë®ò1Êó•Âπ≥Âùá</strong>: Ëá™ÂãïË®àÁÆóÔºàÊäïÁ®øÊï∞√∑Âñ∂Ê•≠Êó•Êï∞Ôºâ</li>' +
                '<li><strong>„Ç≠„ÉÜ„Éç1Êó•Âπ≥Âùá</strong>: Ëá™ÂãïË®àÁÆóÔºàÈÄÅ‰ø°Êï∞√∑Âñ∂Ê•≠Êó•Êï∞Ôºâ</li>' +
                '</ul>' +
                '</div>' +

                '<div>' +
                '<h4 class="font-bold text-purple-600 mb-2">üìã Êñ∞„ÉÜ„É≥„Éó„É¨„Éº„ÉàÂ∞éÂÖ•ÊâãÈ†Ü</h4>' +
                '<ol class="list-decimal list-inside space-y-1 text-gray-700">' +
                '<li>ÊîπËâØÁâà„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</li>' +
                '<li>Google„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅßÊñ∞Ë¶è‰ΩúÊàê</li>' +
                '<li>CSV„Éï„Ç°„Ç§„É´„Çí„Ç§„É≥„Éù„Éº„Éà</li>' +
                '<li>ÂÆüÈöõ„ÅÆÂ∫óËàó„Éá„Éº„Çø„ÅßÊõ¥Êñ∞</li>' +
                '<li>„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÂÖ¨ÈñãË®≠ÂÆö„Å´„Åô„Çã</li>' +
                '<li>„Ç∑„Çπ„ÉÜ„É†„ÅÆ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàID„ÇíÊõ¥Êñ∞</li>' +
                '<li>„Åì„ÅÆ„Ç∑„Çπ„ÉÜ„É†„ÅßÂêåÊúü„ÉÜ„Çπ„ÉàÂÆüË°å</li>' +
                '</ol>' +
                '</div>' +

                '<div>' +
                '<h4 class="font-bold text-red-600 mb-2">‚ö° „Éñ„É©„É≥„ÉâÂà•Êé®Â•®KPIÂü∫Ê∫ñ</h4>' +
                '<div class="grid grid-cols-1 gap-2 text-xs">' +
                '<div class="bg-yellow-50 p-2 rounded">' +
                '<strong>PremiumÂ∫óËàó</strong>: Êó•Ë®ò250+/Êó•„ÄÅÂè£„Ç≥„Éü200+/Êúà„ÄÅ„Ç≠„ÉÜ„Éç60+/Êó•' +
                '</div>' +
                '<div class="bg-blue-50 p-2 rounded">' +
                '<strong>GrandOperaÂ∫óËàó</strong>: Êó•Ë®ò120-250/Êó•„ÄÅÂè£„Ç≥„Éü130-220/Êúà„ÄÅ„Ç≠„ÉÜ„Éç53-77/Êó•' +
                '</div>' +
                '<div class="bg-green-50 p-2 rounded">' +
                '<strong>CLASSYÂ∫óËàó</strong>: Êó•Ë®ò60-203/Êó•„ÄÅÂè£„Ç≥„Éü113-256/Êúà„ÄÅ„Ç≠„ÉÜ„Éç27-47/Êó•' +
                '</div>' +
                '</div>' +
                '</div>' +

                '<div>' +
                '<h4 class="font-bold text-orange-600 mb-2">üí° „Éá„Éº„ÇøÁ≤æÂ∫¶Âêë‰∏ä„ÅÆ„Ç≥„ÉÑ</h4>' +
                '<ul class="list-disc list-inside space-y-1 text-gray-700">' +
                '<li>Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞„ÇíÊ≠£Á¢∫„Å´ÂÖ•ÂäõÔºàÁõÆÊ®ôË®àÁÆó„ÅÆÂü∫Ê∫ñÔºâ</li>' +
                '<li>Âñ∂Ê•≠Êó•Êï∞„ÇíËÄÉÊÖÆ„Åó„ÅüÁõÆÊ®ôË®≠ÂÆö</li>' +
                '<li>ÈáçÁÇπKPIÊ¨Ñ„ÅßÂÑ™ÂÖàÊîπÂñÑÈ†ÖÁõÆ„ÇíÊòéË®ò</li>' +
                '<li>ÊîπÂñÑÁÇπÊ¨Ñ„ÅßÂÖ∑‰ΩìÁöÑ„Å™„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„ÇíË®òËºâ</li>' +
                '<li>ÈÄ±Ê¨°„Åæ„Åü„ÅØÊúà2Âõû„ÅÆÈ†ªÂ∫¶„Åß„Éá„Éº„ÇøÊõ¥Êñ∞</li>' +
                '</ul>' +
                '</div>' +

                '<div class="pt-4 border-t space-y-2">' +
                '<button class="btn btn-primary w-full mb-2" onclick="downloadSpreadsheetTemplate(); closeQuickActions();">' +
                '<i class="fas fa-download mr-2"></i>ÊîπËâØÁâà„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ' +
                '</button>' +
                '<button class="btn btn-success w-full mb-2" onclick="downloadKPICalculationGuide(); closeQuickActions();">' +
                '<i class="fas fa-calculator mr-2"></i>KPIË®àÁÆó„Ç¨„Ç§„Éâ„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ' +
                '</button>' +
                '<button class="btn btn-outline w-full" onclick="openSpreadsheet(); closeQuickActions();">' +
                '<i class="fas fa-external-link-alt mr-2"></i>ÁèæÂú®„ÅÆ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÈñã„Åè' +
                '</button>' +
                '</div>' +
                '</div>';

            showCustomModal('ÊîπËâØÁâà„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàË®≠ÂÆö„Ç¨„Ç§„Éâ', guideContent);
        }

        function showStoreDetails(storeId) {
            const store = storeData.find(s => s.id === storeId);
            if (!store) return;

            const content = 
                '<div class="space-y-4">' +
                '<div class="text-center">' +
                '<h3 class="text-xl font-bold text-gray-900">' + store.name + '</h3>' +
                '<p class="text-gray-600">' + (storeInfo[storeId]?.type || '') + '„Éñ„É©„É≥„Éâ</p>' +
                '</div>' +
                '<div class="grid grid-cols-2 gap-4">' +
                '<div class="text-center">' +
                '<div class="text-lg font-bold text-blue-600">' + (store.salesAchievementRate * 100).toFixed(1) + '%</div>' +
                '<div class="text-sm text-gray-600">Â£≤‰∏äÈÅîÊàêÁéá</div>' +
                '</div>' +
                '<div class="text-center">' +
                '<div class="text-lg font-bold text-green-600">' + store.totalAccess.toLocaleString() + '</div>' +
                '<div class="text-sm text-gray-600">Á∑è„Ç¢„ÇØ„Çª„ÇπÊï∞</div>' +
                '</div>' +
                '</div>' +
                '<div class="space-y-2">' +
                '<div class="flex justify-between">' +
                '<span>Â£≤‰∏äÂÆüÁ∏æ</span>' +
                '<span class="font-bold">¬•' + (store.totalSales / 1000000).toFixed(1) + 'M</span>' +
                '</div>' +
                '<div class="flex justify-between">' +
                '<span>Â£≤‰∏äÁõÆÊ®ô</span>' +
                '<span class="font-bold">¬•' + (store.salesTarget / 1000000).toFixed(1) + 'M</span>' +
                '</div>' +
                '<div class="flex justify-between">' +
                '<span>Êó•Ë®òÊäïÁ®øÊï∞</span>' +
                '<span class="font-bold">' + store.diaryPosts + '‰ª∂</span>' +
                '</div>' +
                '<div class="flex justify-between">' +
                '<span>Âè£„Ç≥„ÉüÊï∞</span>' +
                '<span class="font-bold">' + store.reviewPosts + '‰ª∂</span>' +
                '</div>' +
                '<div class="flex justify-between">' +
                '<span>Âá∫Âã§‰∫∫Êï∞</span>' +
                '<span class="font-bold">' + store.attendanceCount + '‰∫∫</span>' +
                '</div>' +
                '</div>' +
                '<button class="btn btn-outline w-full" onclick="closeQuickActions()">Èñâ„Åò„Çã</button>' +
                '</div>';

            showCustomModal(store.name + ' Ë©≥Á¥∞', content);
        }

        // „É¢„Éº„ÉÄ„É´ÁÆ°ÁêÜ
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
            }
            editingTaskId = null;
            editingEventId = null;
        }

        function showCustomModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = 
                '<div class="modal-content">' +
                '<div class="flex items-center justify-between mb-4">' +
                '<h3 class="text-lg font-bold text-gray-900">' + title + '</h3>' +
                '<button onclick="this.closest(\'.modal\').remove()" class="text-gray-500 hover:text-gray-700">' +
                '<i class="fas fa-times"></i>' +
                '</button>' +
                '</div>' +
                content +
                '</div>';

            document.body.appendChild(modal);

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // ÈÄöÁü•„Ç∑„Çπ„ÉÜ„É†
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification border-l-4 ' + 
                (type === 'success' ? 'border-green-500 bg-green-50 text-green-800' :
                type === 'error' ? 'border-red-500 bg-red-50 text-red-800' :
                type === 'warning' ? 'border-yellow-500 bg-yellow-50 text-yellow-800' :
                'border-blue-500 bg-blue-50 text-blue-800');

            const icon = type === 'success' ? 'check-circle' :
                        type === 'error' ? 'exclamation-circle' :
                        type === 'warning' ? 'exclamation-triangle' : 'info-circle';

            notification.innerHTML = 
                '<div class="flex items-center">' +
                '<i class="fas fa-' + icon + ' mr-2"></i>' +
                '<span class="font-medium">' + message + '</span>' +
                '<button onclick="this.parentElement.parentElement.remove()" class="ml-auto text-gray-500 hover:text-gray-700">' +
                '<i class="fas fa-times"></i>' +
                '</button>' +
                '</div>';

            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('ja-JP');
        }

        function getPriorityText(priority) {
            const priorities = { high: 'È´ò', medium: '‰∏≠', low: '‰Ωé' };
            return priorities[priority] || priority;
        }

        function getPriorityBadgeClass(priority) {
            const classes = {
                high: 'bg-red-100 text-red-800',
                medium: 'bg-yellow-100 text-yellow-800',
                low: 'bg-green-100 text-green-800'
            };
            return classes[priority] || 'bg-gray-100 text-gray-800';
        }

        function getEventClass(eventType) {
            const classes = {
                meeting: 'bg-blue-100 text-blue-800',
                shooting: 'bg-green-100 text-green-800',
                holiday: 'bg-red-100 text-red-800',
                deadline: 'bg-orange-100 text-orange-800'
            };
            return classes[eventType] || 'bg-gray-100 text-gray-800';
        }

        function getBrandEmoji(brand) {
            const emojis = {
                'CLASSY': 'üíé',
                'GrandOpera': 'üé≠',
                'Premium': 'üåü'
            };
            return emojis[brand] || 'üè™';
        }

        function getRankingEmoji(rank) {
            return rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : rank + '‰Ωç';
        }

        // „Éá„Éê„ÉÉ„Ç∞„Éª‰øÆÂæ©Èñ¢Êï∞
        window.fixSpreadsheetNow = function() {
            console.log('=== „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÂêåÊúü‰øÆÂæ©ÂÆüË°å ===');
            
            try {
                // „Åæ„ÅöstoreData„ÅåÊ≠£„Åó„ÅèÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç
                console.log('ÁèæÂú®„ÅÆstoreDataÂ∫óËàóÊï∞:', storeData.length);
                
                if (storeData.length < 10) {
                    console.log('‚ö†Ô∏è Â∫óËàó„Éá„Éº„Çø„Åå‰∏çÂÆåÂÖ®„Åß„Åô„ÄÇÂº∑Âà∂ÂÜçÂàùÊúüÂåñ„ÇíÂÆüË°å...');
                    forceResetStoreData();
                }
                
                // ‰øÆÂæ©„Éá„Éº„Çø„ÅßÂêåÊúüÂÆüË°å
                const emergencyData = generateCurrentBusinessData();
                const parsed = parseCSV(emergencyData);
                const updated = updateStoreDataFromSpreadsheet(parsed);
                
                setSyncStatus('success', '‰øÆÂæ©ÂÆå‰∫Ü');
                document.getElementById('lastSync').textContent = new Date().toLocaleString('ja-JP') + ' (‰øÆÂæ©Ê∏à„Åø)';
                
                renderCurrentPage();
                saveToLocalStorage();
                
                showNotification('‰øÆÂæ©ÂÆå‰∫ÜÔºÅ' + updated + 'Â∫óËàó„ÅßÂãï‰Ωú‰∏≠„ÄÇ', 'success');
                
                console.log('‚úÖ ‰øÆÂæ©ÂÆå‰∫Ü: ' + updated + 'Â∫óËàóÊõ¥Êñ∞');
                console.log('ÊúÄÁµÇÂ∫óËàóÊï∞:', storeData.length);
                return '‰øÆÂæ©ÂÆå‰∫Ü: ' + updated + '/' + storeData.length + 'Â∫óËàóÊõ¥Êñ∞';
                
            } catch (error) {
                console.error('‚ùå ‰øÆÂæ©„Ç®„É©„Éº:', error);
                return '‰øÆÂæ©„Ç®„É©„Éº: ' + error.message;
            }
        };

        window.forceResetStoreData = function() {
            console.log('=== Â∫óËàó„Éá„Éº„ÇøÂº∑Âà∂„É™„Çª„ÉÉ„Éà ===');
            
            // LocalStorage„Çí„ÇØ„É™„Ç¢
            localStorage.removeItem('classy_stores');
            
            // Â∫óËàó„Éá„Éº„Çø„ÇíÂº∑Âà∂ÁöÑ„Å´ÂÜçË®≠ÂÆö
            storeData = [
                {
                    id: 'shabour',
                    name: '„Ç∑„É£„Éñ„Éº„É´',
                    salesTarget: 33000000,
                    totalSales: 29544738,
                    totalAccess: 1967152,
                    diaryPosts: 7560,
                    reviewPosts: 344,
                    attendanceCount: 687,
                    salesAchievementRate: 0.8953,
                    diaryAchievementRate: 0.9,
                    reviewAchievementRate: 1.1467
                },
                {
                    id: 'onecarat',
                    name: '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà',
                    salesTarget: 17500000,
                    totalSales: 18314356,
                    totalAccess: 1241592,
                    diaryPosts: 8528,
                    reviewPosts: 156,
                    attendanceCount: 514,
                    salesAchievementRate: 1.0465,
                    diaryAchievementRate: 1.0727,
                    reviewAchievementRate: 0.78
                },
                {
                    id: 'go_nagoya',
                    name: 'GOÂêçÂè§Â±ã',
                    salesTarget: 28000000,
                    totalSales: 29265025,
                    totalAccess: 1349912,
                    diaryPosts: 3605,
                    reviewPosts: 216,
                    attendanceCount: 518,
                    salesAchievementRate: 1.0452,
                    diaryAchievementRate: 0.6676,
                    reviewAchievementRate: 1.0537
                },
                {
                    id: 'go_fukuoka',
                    name: 'GOÁ¶èÂ≤°',
                    salesTarget: 36000000,
                    totalSales: 37050068,
                    totalAccess: 1619670,
                    diaryPosts: 7828,
                    reviewPosts: 202,
                    attendanceCount: 514,
                    salesAchievementRate: 1.0292,
                    diaryAchievementRate: 1.0437,
                    reviewAchievementRate: 1.1222
                },
                {
                    id: 'go_tokyo',
                    name: 'GOÊù±‰∫¨',
                    salesTarget: 28000000,
                    totalSales: 27324427,
                    totalAccess: 1182336,
                    diaryPosts: 4164,
                    reviewPosts: 116,
                    attendanceCount: 457,
                    salesAchievementRate: 0.9759,
                    diaryAchievementRate: 0.5552,
                    reviewAchievementRate: 0.7733
                },
                {
                    id: 'go_yokohama',
                    name: 'GOÊ®™Êµú',
                    salesTarget: 23000000,
                    totalSales: 22547274,
                    totalAccess: 599756,
                    diaryPosts: 5077,
                    reviewPosts: 127,
                    attendanceCount: 407,
                    salesAchievementRate: 0.9803,
                    diaryAchievementRate: 0.8462,
                    reviewAchievementRate: 0.8759
                },
                {
                    id: 'opera_nishiki',
                    name: '„Ç™„Éö„É©Èå¶',
                    salesTarget: 24000000,
                    totalSales: 25123456,
                    totalAccess: 1273548,
                    diaryPosts: 7068,
                    reviewPosts: 195,
                    attendanceCount: 480,
                    salesAchievementRate: 1.0468,
                    diaryAchievementRate: 1.0709,
                    reviewAchievementRate: 1.0833
                },
                {
                    id: 'cl_nagoya',
                    name: 'CLÂêçÂè§Â±ã',
                    salesTarget: 6000000,
                    totalSales: 5300320,
                    totalAccess: 514243,
                    diaryPosts: 1851,
                    reviewPosts: 113,
                    attendanceCount: 197,
                    salesAchievementRate: 0.8834,
                    diaryAchievementRate: 0.7713,
                    reviewAchievementRate: 0.7533
                },
                {
                    id: 'cl_tokyo',
                    name: 'CLÊù±‰∫¨',
                    salesTarget: 7200000,
                    totalSales: 6719328,
                    totalAccess: 742231,
                    diaryPosts: 2079,
                    reviewPosts: 122,
                    attendanceCount: 238,
                    salesAchievementRate: 0.9332,
                    diaryAchievementRate: 0.693,
                    reviewAchievementRate: 0.6778
                },
                {
                    id: 'cl_yokkaichi',
                    name: 'CLÂõõÊó•Â∏Ç',
                    salesTarget: 12500000,
                    totalSales: 12943296,
                    totalAccess: 881476,
                    diaryPosts: 6301,
                    reviewPosts: 256,
                    attendanceCount: 356,
                    salesAchievementRate: 1.0355,
                    diaryAchievementRate: 1.0246,
                    reviewAchievementRate: 1.0667
                }
            ];
            
            console.log('‚úÖ Â∫óËàó„Éá„Éº„ÇøÂº∑Âà∂„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü: ' + storeData.length + 'Â∫óËàó');
            
            // Á¢∫Ë™çÁî®„Å´ÂÖ®Â∫óËàó„ÇíË°®Á§∫
            storeData.forEach((store, index) => {
                console.log((index + 1) + '. ' + store.name + ' (ID: ' + store.id + ')');
            });
            
            saveToLocalStorage();
            return storeData.length + 'Â∫óËàó„Åß„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü';
        };

        window.checkStoreData = function() {
            console.log('=== Â∫óËàó„Éá„Éº„ÇøË®∫Êñ≠ ===');
            console.log('storeDataÈÖçÂàóÈï∑:', storeData.length);
            console.log('storeInfoÂÆöÁæ©Êï∞:', Object.keys(storeInfo).length);
            
            console.log('storeDataÂÜÖÂÆπ:');
            if (storeData.length > 0) {
                storeData.forEach((store, index) => {
                    console.log((index + 1) + '. ID: ' + store.id + ', ÂêçÂâç: ' + store.name);
                });
            } else {
                console.log('‚ö†Ô∏è storeData„ÅåÁ©∫„Åß„Åô');
            }
            
            console.log('storeInfoÂÆöÁæ©:');
            Object.entries(storeInfo).forEach(([id, info]) => {
                const found = storeData.find(s => s.id === id);
                console.log('- ' + id + ' (' + info.name + ') - ' + (found ? '‚úÖ' : '‚ùå'));
            });
            
            return {
                storeDataCount: storeData.length,
                storeInfoCount: Object.keys(storeInfo).length,
                allFound: storeData.length === Object.keys(storeInfo).length
            };
        };

        window.openSpreadsheet = function() {
            const url = 'https://docs.google.com/spreadsheets/d/' + SPREADSHEET_ID + '/edit?gid=0#gid=0';
            window.open(url, '_blank');
            console.log('„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÊñ∞„Åó„ÅÑ„Çø„Éñ„ÅßÈñã„Åç„Åæ„Åó„Åü');
            return '„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÈñã„Åç„Åæ„Åó„Åü';
        };

        window.testRealSync = function() {
            console.log('ÂÆüÈöõ„ÅÆÂêåÊúü„ÉÜ„Çπ„ÉàÂÆüË°å');
            syncWithSpreadsheet();
            return 'ÂêåÊúü„ÉÜ„Çπ„ÉàÂÆüË°å';
        };

        window.showSyncStatus = function() {
            console.log('ÁèæÂú®„ÅÆÂêåÊúüÁä∂Ê≥Å:');
            console.log('ÂØæË±°„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà:', SPREADSHEET_ID);
            console.log('Â∫óËàó„Éá„Éº„ÇøÊï∞:', storeData.length);
            console.log('ÊúÄÁµÇÂêåÊúü:', document.getElementById('lastSync')?.textContent || 'Êú™ÂêåÊúü');
            console.log('ÂêåÊúüÁä∂ÊÖã:', document.getElementById('syncText')?.textContent || '‰∏çÊòé');
            
            console.log('Ë™çË≠ò„Åï„Çå„Å¶„ÅÑ„ÇãÂ∫óËàó:');
            storeData.forEach((store, index) => {
                const achievement = (store.salesAchievementRate * 100).toFixed(1);
                const status = store.salesAchievementRate >= 1.0 ? 'ÈÅîÊàê' : 'Êú™ÈÅîÊàê';
                console.log((index + 1) + '. ' + store.name + ' - ÈÅîÊàêÁéá: ' + achievement + '% ' + status);
            });
            
            return storeData.length + 'Â∫óËàóË™çË≠òÊ∏à„Åø';
        };

        window.testSystem = function() {
            console.log('=== „Ç∑„Çπ„ÉÜ„É†„ÉÜ„Çπ„Éà ===');
            console.log('„Çø„Çπ„ÇØÊï∞:', tasks.length);
            console.log('„Ç§„Éô„É≥„ÉàÊï∞:', events.length);
            console.log('Â∫óËàóÊï∞:', storeData.length);
            console.log('ÁèæÂú®„ÅÆ„Éö„Éº„Ç∏:', currentPage);
            
            console.log('Â∫óËàó‰∏ÄË¶ß:');
            storeData.forEach((store, index) => {
                console.log((index + 1) + '. ' + store.name + ' (¬•' + (store.totalSales / 1000000).toFixed(1) + 'M)');
            });
            
            return 'Ê≠£Â∏∏ - ' + storeData.length + 'Â∫óËàóË™çË≠ò';
        };

        window.showAllStores = function() {
            console.log('=== ÂÖ®Â∫óËàó„Éá„Éº„ÇøË©≥Á¥∞ ===');
            storeData.forEach(store => {
                console.log('Â∫óËàó: ' + store.name + ' (' + store.id + ')');
                console.log('„Éñ„É©„É≥„Éâ: ' + (storeInfo[store.id]?.type || ''));
                console.log('Â£≤‰∏äÂÆüÁ∏æ: ¬•' + store.totalSales.toLocaleString());
                console.log('Â£≤‰∏äÁõÆÊ®ô: ¬•' + store.salesTarget.toLocaleString());
                console.log('ÈÅîÊàêÁéá: ' + (store.salesAchievementRate * 100).toFixed(1) + '%');
                console.log('---');
            });
            return storeData.length + 'Â∫óËàó„ÅÆË©≥Á¥∞ÊÉÖÂ†±„ÇíË°®Á§∫';
        };

        // ÂàùÊúüÂåñÂÆå‰∫Ü„É°„ÉÉ„Çª„Éº„Ç∏
        console.log('CLASSYÊ•≠ÂãôÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† ÊîπËâØÁâàKPIÂØæÂøú ÂàùÊúüÂåñÂÆå‰∫Ü');
        console.log('=== Âà©Áî®ÂèØËÉΩ„Å™Â∫óËàóÊï∞: ' + Object.keys(storeInfo).length + ' ===');
        Object.entries(storeInfo).forEach(([id, info]) => {
            console.log('- ' + info.name + ' (' + id + ') - ' + info.type + '„Éñ„É©„É≥„Éâ');
        });
        
        console.log('');
        console.log('üÜï ÊîπËâØÁâàKPIÊ©üËÉΩ:');
        console.log('- 18È†ÖÁõÆ„ÅÆË©≥Á¥∞KPIÁÆ°ÁêÜ');
        console.log('- Êó•Ë®ò„Éª„Ç≠„ÉÜ„Éç„ÅÆ1Êó•Âπ≥ÂùáËá™ÂãïË®àÁÆó');
        console.log('- Âú®Á±ç„Ç≠„É£„Çπ„ÉàÊï∞„Å´„Çà„ÇãÁõÆÊ®ôÁÆóÂá∫');
        console.log('- „Éñ„É©„É≥„ÉâÂà•KPIÂü∫Ê∫ñË°®Á§∫');
        console.log('- ÈáçÁÇπKPI„ÉªÊîπÂñÑÁÇπ„ÅÆÁÆ°ÁêÜ');
        
        console.log('');
        console.log('üîß Â∫óËàó„Éá„Éº„ÇøÂïèÈ°åËß£Ê±∫„Ç≥„Éû„É≥„Éâ:');
        console.log('1. checkStoreData() - Â∫óËàó„Éá„Éº„ÇøË®∫Êñ≠');
        console.log('2. forceResetStoreData() - Â∫óËàó„Éá„Éº„ÇøÂº∑Âà∂„É™„Çª„ÉÉ„Éà');
        console.log('3. fixSpreadsheetNow() - ‰øÆÂæ©ÂÆüË°åÔºàÊé®Â•®Ôºâ');
        console.log('');
        console.log('üìä ÊîπËâØÁâà„ÉÜ„É≥„Éó„É¨„Éº„ÉàÈñ¢ÈÄ£:');
        console.log('- downloadSpreadsheetTemplate() : ÊîπËâØÁâà„ÉÜ„É≥„Éó„É¨„Éº„ÉàDL');
        console.log('- downloadKPICalculationGuide() : KPIË®àÁÆó„Ç¨„Ç§„ÉâDL');
        console.log('- showSpreadsheetGuide() : Ë®≠ÂÆö„Ç¨„Ç§„ÉâË°®Á§∫');
        console.log('');
        console.log('üìà „Åù„ÅÆ‰ªñ„ÅÆ„Ç≥„Éû„É≥„Éâ:');
        console.log('- testSystem() : „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖãÁ¢∫Ë™ç');
        console.log('- showAllStores() : ÂÖ®Â∫óËàó„Éá„Éº„ÇøË°®Á§∫');
        console.log('- showSyncStatus() : ÂêåÊúüÁä∂Ê≥ÅÁ¢∫Ë™ç');
        console.log('- openSpreadsheet() : „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÈñã„Åè');
        
        console.log('');
        console.log('ÂØæË±°„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà:');
        console.log('https://docs.google.com/spreadsheets/d/' + SPREADSHEET_ID + '/edit?gid=0#gid=0');
        
        // ÂàùÊúüË®∫Êñ≠„ÇíÂÆüË°å
        setTimeout(() => {
            console.log('');
            console.log('=== ÂàùÊúüË®∫Êñ≠ÂÆüË°å ===');
            const diagnosis = checkStoreData();
            if (!diagnosis.allFound) {
                console.log('‚ö†Ô∏è Â∫óËàó„Éá„Éº„Çø„Å´ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇforceResetStoreData() „ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            } else {
                console.log('‚úÖ Â∫óËàó„Éá„Éº„ÇøÊ≠£Â∏∏: ' + diagnosis.storeDataCount + 'Â∫óËàóË™çË≠ò');
            }
            console.log('');
            console.log('üöÄ ÊîπËâØÁâàÊ©üËÉΩ„Çí‰ΩøÁî®„Åô„Çã„Å´„ÅØ:');
            console.log('1. downloadSpreadsheetTemplate() „Åß„ÉÜ„É≥„Éó„É¨„Éº„ÉàDL');
            console.log('2. Google„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅßÊñ∞Ë¶è‰ΩúÊàê');
            console.log('3. ÂÆü„Éá„Éº„Çø„ÅßÊõ¥Êñ∞Âæå„ÄÅÂÖ¨ÈñãË®≠ÂÆö');
            console.log('4. „Ç∑„Çπ„ÉÜ„É†„ÅßÂêåÊúü„ÉÜ„Çπ„Éà');
        }, 1000);
    </script>
</body>
</html>
