<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI_Secretary v4 - ÊúâÈôê‰ºöÁ§æRispondere Áµ±ÂêàÊ•≠ÂãôÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'Noto Sans JP', 'sans-serif']
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1'
                        },
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            font-weight: 500;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 14px;
            min-height: 44px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.8);
            color: #374151;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 1);
        }
        
        .nav-tab {
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 0 4px;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .nav-tab:not(.active):hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateY(-1px);
        }
        
        .stats-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            backdrop-filter: blur(20px);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-fill {
            transition: stroke-dasharray 0.5s ease;
        }
        
        .calendar-day {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .calendar-day:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .calendar-day.today {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .calendar-day.has-event {
            background: rgba(245, 158, 11, 0.2);
            border: 2px solid #f59e0b;
        }
        
        .task-item {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
            transition: all 0.3s ease;
        }
        
        .task-item:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateX(4px);
        }
        
        .task-item.completed {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        .task-item.urgent {
            border-left: 4px solid #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }
        
        .task-item.priority-high {
            border-left: 4px solid #f59e0b;
            background: rgba(245, 158, 11, 0.05);
        }
        
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 420px;
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 24px;
            margin: 24px 0;
        }
        
        .col-span-3 { grid-column: span 3; }
        .col-span-4 { grid-column: span 4; }
        .col-span-6 { grid-column: span 6; }
        .col-span-8 { grid-column: span 8; }
        .col-span-12 { grid-column: span 12; }
        
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            .col-span-3 { grid-column: span 6; }
            .col-span-4 { grid-column: span 6; }
            .col-span-8 { grid-column: span 6; }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: repeat(1, 1fr);
                gap: 16px;
            }
            .col-span-3,
            .col-span-4,
            .col-span-6,
            .col-span-8,
            .col-span-12 {
                grid-column: span 1;
            }
        }
        
        .session-timer {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            color: white;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 12px;
            z-index: 1000;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .modal.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 24px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.show .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body>
    <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">
                    <i class="fas fa-building text-purple-600"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">AI Secretary v4</h1>
                <p class="text-gray-600">ÊúâÈôê‰ºöÁ§æRispondere<br>Áµ±ÂêàÊ•≠ÂãôÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-key mr-2"></i>„Éë„Çπ„ÉØ„Éº„Éâ
                    </label>
                    <input 
                        type="password" 
                        id="passwordInput" 
                        class="input-field" 
                        placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"
                        value=""
                    >
                </div>
                
                <button type="button" onclick="loginNow()" class="btn btn-primary w-full">
                    <i class="fas fa-sign-in-alt mr-2"></i>„É≠„Ç∞„Ç§„É≥
                </button>
                
                <button type="button" onclick="forceLogin()" class="btn btn-danger w-full">
                    <i class="fas fa-unlock mr-2"></i>Âº∑Âà∂„É≠„Ç∞„Ç§„É≥
                </button>
            </div>
            
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <div class="flex items-center text-blue-800 text-sm">
                    <i class="fas fa-shield-alt mr-2"></i>
                    „Çª„Ç≠„É•„Ç¢„É≠„Ç∞„Ç§„É≥„Éª„Çª„ÉÉ„Ç∑„Éß„É≥ÁÆ°ÁêÜ„ÉªËá™Âãï„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
                </div>
            </div>
        </div>
    </div>

    <!-- „Çª„ÉÉ„Ç∑„Éß„É≥„Çø„Ç§„Éû„ÉºÔºà‰∏ÄÊôÇÁöÑ„Å´ÈùûË°®Á§∫Ôºâ -->
    <div id="sessionTimer" class="session-timer" style="display: none;">
        <i class="fas fa-clock mr-2"></i>
        <span id="timeRemaining"></span>
    </div>

    <!-- „É°„Ç§„É≥„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ -->
    <div id="mainDashboard" style="display: none;" class="min-h-screen">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <div class="glass-card mx-4 mt-4 mb-6">
            <div class="p-6">
                <div class="flex flex-col lg:flex-row justify-between items-center space-y-4 lg:space-y-0">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 flex items-center">
                            <i class="fas fa-building mr-3 text-purple-600"></i>
                            Rispondere Áµ±ÂêàÁÆ°ÁêÜ
                        </h1>
                        <p class="text-gray-600 mt-1">AI Secretary v4 - ÂÖ®Â∫óËàó„ÉªÂÖ®ÈÉ®ÈñÄÁµ±Âêà„Ç∑„Çπ„ÉÜ„É†</p>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="text-center">
                            <div class="font-semibold text-gray-900" id="currentDate"></div>
                            <div class="text-sm text-gray-500" id="currentTime"></div>
                        </div>
                        <button onclick="showNotifications()" class="btn btn-secondary">
                            <i class="fas fa-bell mr-2"></i>
                            <span id="notificationCount" class="bg-red-500 text-white text-xs rounded-full px-2 py-1 ml-1">0</span>
                        </button>
                        <button onclick="logout()" class="btn btn-danger">
                            <i class="fas fa-sign-out-alt mr-2"></i>„É≠„Ç∞„Ç¢„Ç¶„Éà
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
        <div class="mx-4 mb-6">
            <div class="flex flex-wrap justify-center lg:justify-start gap-2">
                <button class="nav-tab active" data-tab="dashboard" onclick="switchTab('dashboard')">
                    <i class="fas fa-chart-line mr-2"></i>„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                </button>
                <button class="nav-tab" data-tab="tasks" onclick="switchTab('tasks')">
                    <i class="fas fa-tasks mr-2"></i>„Çø„Çπ„ÇØÁÆ°ÁêÜ
                </button>
                <button class="nav-tab" data-tab="schedule" onclick="switchTab('schedule')">
                    <i class="fas fa-calendar mr-2"></i>„Çπ„Ç±„Ç∏„É•„Éº„É´
                </button>
                <button class="nav-tab" data-tab="sales" onclick="switchTab('sales')">
                    <i class="fas fa-chart-bar mr-2"></i>Â£≤‰∏äÂàÜÊûê
                </button>
                <button class="nav-tab" data-tab="goals" onclick="switchTab('goals')">
                    <i class="fas fa-target mr-2"></i>ÁõÆÊ®ôÁÆ°ÁêÜ
                </button>
                <button class="nav-tab" data-tab="design" onclick="switchTab('design')">
                    <i class="fas fa-palette mr-2"></i>„Éá„Ç∂„Ç§„É≥ÈÉ®ÈñÄ
                </button>
                <button class="nav-tab" data-tab="tools" onclick="switchTab('tools')">
                    <i class="fas fa-tools mr-2"></i>„ÉÑ„Éº„É´
                </button>
            </div>
        </div>

        <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Çø„Éñ -->
        <div id="dashboardTab" class="tab-content mx-4">
            <!-- Áµ±Ë®à„Ç´„Éº„Éâ -->
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
                <div class="stats-card">
                    <div class="text-2xl font-bold text-purple-600 mb-2" id="totalTasks">0</div>
                    <div class="text-sm text-gray-600">Á∑è„Çø„Çπ„ÇØÊï∞</div>
                </div>
                <div class="stats-card">
                    <div class="text-2xl font-bold text-green-600 mb-2" id="completedTasks">0</div>
                    <div class="text-sm text-gray-600">ÂÆå‰∫ÜÊ∏à„Åø</div>
                </div>
                <div class="stats-card">
                    <div class="text-2xl font-bold text-red-600 mb-2" id="urgentTasks">0</div>
                    <div class="text-sm text-gray-600">Á∑äÊÄ•„Çø„Çπ„ÇØ</div>
                </div>
                <div class="stats-card">
                    <div class="text-2xl font-bold text-blue-600 mb-2" id="totalEvents">0</div>
                    <div class="text-sm text-gray-600">‰∫àÂÆöÊï∞</div>
                </div>
                <div class="stats-card">
                    <div class="text-2xl font-bold text-yellow-600 mb-2" id="totalStores">10</div>
                    <div class="text-sm text-gray-600">ÈÅãÂñ∂Â∫óËàó</div>
                </div>
                <div class="stats-card">
                    <div class="text-2xl font-bold text-indigo-600 mb-2" id="designProjects">0</div>
                    <div class="text-sm text-gray-600">„Éá„Ç∂„Ç§„É≥Ê°à‰ª∂</div>
                </div>
            </div>

            <!-- „ÇØ„Ç§„ÉÉ„ÇØÊ¶ÇË¶Å -->
            <div class="dashboard-grid">
                <div class="col-span-4">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-pie mr-2 text-purple-600"></i>‰ªäÊó•„ÅÆÈÄ≤Êçó
                        </h3>
                        <div class="flex items-center justify-center">
                            <div class="relative w-32 h-32">
                                <svg class="w-32 h-32 progress-ring">
                                    <circle cx="64" cy="64" r="56" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                                    <circle id="progressCircle" cx="64" cy="64" r="56" stroke="#667eea" stroke-width="8" 
                                            fill="none" stroke-linecap="round" class="progress-ring-fill"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span id="progressText" class="text-xl font-bold text-gray-900">0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <p class="text-sm text-gray-700 mb-3">${plan.description}</p>
                            <ul class="text-sm text-gray-600 space-y-1">
                                ${plan.actions.map(action => `<li class="flex items-center"><i class="fas fa-arrow-right text-xs mr-2"></i>${action}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateStorePeriod() {
            const selectedStore = document.getElementById('storeSelector').value;
            if (selectedStore) {
                renderStoreDetails(selectedStore);
            }
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        function setupEventListeners() {
            // „Ç®„É≥„Çø„Éº„Ç≠„Éº„Åß„ÅÆ„É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        loginNow();
                    }
                });
            }

            // „É°„É¢„ÅÆËá™Âãï‰øùÂ≠ò
            const memoArea = document.getElementById('memoArea');
            if (memoArea) {
                memoArea.addEventListener('input', saveMemo);
            }
        }

        // „Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        function loadAllData() {
            loadTasks();
            loadEvents();
            loadDesignProjects();
            loadPrompts();
            loadMemo();
            updateMemoDateSelector();
        }

        // Áµ±Ë®àÊõ¥Êñ∞
        function updateAllStats() {
            updateDashboardStats();
            updateTaskStats();
            updateDesignStats();
            updateProgressCircle();
        }

        function updateDashboardStats() {
            const tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]');
            const events = JSON.parse(localStorage.getItem(STORAGE_KEYS.events) || '[]');
            const designProjects = JSON.parse(localStorage.getItem(STORAGE_KEYS.designProjects) || '[]');
            
            const completedTasks = tasks.filter(task => task.completed).length;
            const urgentTasks = tasks.filter(task => task.priority === 'urgent' && !task.completed).length;
            const totalEvents = events.length;
            const designProjectsCount = designProjects.length;
            
            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('urgentTasks').textContent = urgentTasks;
            document.getElementById('totalEvents').textContent = totalEvents;
            document.getElementById('designProjects').textContent = designProjectsCount;
            
            // Á∑äÊÄ•„ÉªÈáçË¶Å‰∫ãÈ†Ö„ÅÆË°®Á§∫
            const urgentItems = document.getElementById('urgentItems');
            const urgentList = [
                ...tasks.filter(task => task.priority === 'urgent' && !task.completed).slice(0, 3),
                ...designProjects.filter(project => project.priority === 'urgent' && project.status !== 'completed').slice(0, 2)
            ];
            
            if (urgentList.length === 0) {
                urgentItems.innerHTML = '<p class="text-gray-500 text-center py-4">ÁèæÂú®„ÄÅÁ∑äÊÄ•‰∫ãÈ†Ö„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
            } else {
                urgentItems.innerHTML = urgentList.map(item => `
                    <div class="flex items-center justify-between p-3 bg-red-50 border border-red-200 rounded-lg">
                        <div>
                            <div class="font-medium">${item.title}</div>
                            <div class="text-sm text-gray-600">${item.store || item.client || ''}</div>
                        </div>
                        <div class="text-red-600">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateProgressCircle() {
            const tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]');
            const completed = tasks.filter(task => task.completed).length;
            const total = tasks.length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            const circle = document.getElementById('progressCircle');
            const text = document.getElementById('progressText');
            
            if (circle && text) {
                const circumference = 2 * Math.PI * 56;
                const offset = circumference - (percentage / 100) * circumference;
                
                circle.style.strokeDasharray = circumference;
                circle.style.strokeDashoffset = offset;
                text.textContent = percentage + '%';
            }
        }

        // „Çø„Çπ„ÇØÁÆ°ÁêÜ
        function loadTasks() {
            const tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]');
            const taskList = document.getElementById('taskList');
            if (!taskList) return;
            
            const filter = document.getElementById('taskFilter')?.value || 'all';
            const storeFilter = document.getElementById('taskStore')?.value || 'all';
            
            let filteredTasks = tasks;
            
            if (filter !== 'all') {
                if (filter === 'completed') {
                    filteredTasks = filteredTasks.filter(task => task.completed);
                } else {
                    filteredTasks = filteredTasks.filter(task => task.priority === filter && !task.completed);
                }
            }
            
            if (storeFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.store === storeFilter);
            }
            
            if (filteredTasks.length === 0) {
                taskList.innerHTML = '<div class="text-center py-8 text-gray-500">„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }
            
            taskList.innerHTML = filteredTasks.map((task, index) => {
                const originalIndex = tasks.findIndex(t => t.id === task.id);
                const priorityClass = task.priority === 'urgent' ? 'urgent' : task.priority === 'high' ? 'priority-high' : '';
                const storeInfo = STORES.find(s => s.id === task.store)?.name || task.store;
                
                return `
                    <div class="task-item ${task.completed ? 'completed' : ''} ${priorityClass}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center flex-1">
                                <input type="checkbox" class="mr-3 w-5 h-5" ${task.completed ? 'checked' : ''} 
                                       onchange="toggleTask(${originalIndex})">
                                <div class="flex-1">
                                    <div class="font-medium ${task.completed ? 'line-through text-gray-500' : ''}">${task.title}</div>
                                    <div class="text-sm text-gray-600">
                                        ${storeInfo} | ${getPriorityLabel(task.priority)}
                                        ${task.dueDate ? ` | ÊúüÈôê: ${new Date(task.dueDate).toLocaleDateString('ja-JP')}` : ''}
                                    </div>
                                    ${task.description ? `<div class="text-sm text-gray-500 mt-1">${task.description}</div>` : ''}
                                </div>
                            </div>
                            <button onclick="deleteTask(${originalIndex})" class="ml-3 p-2 text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addTask() {
            const title = document.getElementById('newTaskTitle').value.trim();
            const store = document.getElementById('newTaskStore').value;
            const priority = document.getElementById('newTaskPriority').value;
            const dueDate = document.getElementById('newTaskDue').value;
            const description = document.getElementById('newTaskDescription').value.trim();
            
            if (!title) {
                showNotification('„Çø„Çπ„ÇØÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            const tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]');
            const newTask = {
                id: Date.now(),
                title,
                store,
                priority,
                dueDate,
                description,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(newTask);
            localStorage.setItem(STORAGE_KEYS.tasks, JSON.stringify(tasks));
            
            // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢
            document.getElementById('newTaskTitle').value = '';
            document.getElementById('newTaskDescription').value = '';
            document.getElementById('newTaskDue').value = '';
            
            loadTasks();
            updateAllStats();
            showNotification('„Çø„Çπ„ÇØ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü', 'success');
            
            // Á∑äÊÄ•„Çø„Çπ„ÇØ„ÅÆÂ†¥Âêà„ÅØ„Ç¢„É©„Éº„ÉàËøΩÂä†
            if (priority === 'urgent') {
                addNotification(`Á∑äÊÄ•„Çø„Çπ„ÇØ„ÅåËøΩÂä†„Åï„Çå„Åæ„Åó„Åü: ${title}`, 'urgent');
            }
        }

        function toggleTask(index) {
            const tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]');
            tasks[index].completed = !tasks[index].completed;
            
            if (tasks[index].completed) {
                tasks[index].completedAt = new Date().toISOString();
            } else {
                delete tasks[index].completedAt;
            }
            
            localStorage.setItem(STORAGE_KEYS.tasks, JSON.stringify(tasks));
            loadTasks();
            updateAllStats();
        }

        function deleteTask(index) {
            if (confirm('„Åì„ÅÆ„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                const tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]');
                tasks.splice(index, 1);
                localStorage.setItem(STORAGE_KEYS.tasks, JSON.stringify(tasks));
                loadTasks();
                updateAllStats();
                showNotification('„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'info');
            }
        }

        function filterTasks() {
            loadTasks();
        }

        function updateTaskStats() {
            const tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]');
            const completed = tasks.filter(task => task.completed).length;
            const total = tasks.length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            const today = new Date().toDateString();
            const overdue = tasks.filter(task => 
                !task.completed && task.dueDate && new Date(task.dueDate) < new Date(today)
            ).length;
            const dueToday = tasks.filter(task => 
                !task.completed && task.dueDate && new Date(task.dueDate).toDateString() === today
            ).length;
            
            const completionRate = document.getElementById('taskCompletionRate');
            const progressBar = document.getElementById('taskProgressBar');
            const overdueCount = document.getElementById('overdueCount');
            const dueTodayCount = document.getElementById('dueTodayCount');
            
            if (completionRate) completionRate.textContent = percentage + '%';
            if (progressBar) progressBar.style.width = percentage + '%';
            if (overdueCount) overdueCount.textContent = overdue;
            if (dueTodayCount) dueTodayCount.textContent = dueToday;
        }

        function getPriorityLabel(priority) {
            const labels = {
                'urgent': 'üî¥ Á∑äÊÄ•',
                'high': 'üü° ÈáçË¶Å',
                'normal': 'üü¢ ÈÄöÂ∏∏'
            };
            return labels[priority] || 'ÈÄöÂ∏∏';
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„Éª„Çπ„Ç±„Ç∏„É•„Éº„É´ÁÆ°ÁêÜ
        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const currentMonthElement = document.getElementById('currentMonth');
            
            if (!calendar || !currentMonthElement) return;
            
            currentMonthElement.textContent = currentMonth.toLocaleDateString('ja-JP', { 
                year: 'numeric', 
                month: 'long' 
            });
            
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const events = JSON.parse(localStorage.getItem(STORAGE_KEYS.events) || '[]');
            const daysInMonth = lastDay.getDate();
            
            calendar.innerHTML = '';
            
            // ÊõúÊó•„Éò„ÉÉ„ÉÄ„Éº
            const weekdays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            weekdays.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'text-center text-sm font-medium text-gray-500 p-2';
                dayElement.textContent = day;
                calendar.appendChild(dayElement);
            });
            
            // „Ç´„É¨„É≥„ÉÄ„Éº„ÅÆÊó•‰ªò
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                
                const isCurrentMonth = date.getMonth() === month;
                const isToday = date.toDateString() === new Date().toDateString();
                const hasEvent = events.some(event => 
                    new Date(event.date).toDateString() === date.toDateString()
                );
                
                if (!isCurrentMonth) {
                    dayElement.classList.add('text-gray-300');
                }
                if (isToday) {
                    dayElement.classList.add('today');
                }
                if (hasEvent) {
                    dayElement.classList.add('has-event');
                }
                
                dayElement.onclick = () => selectDate(date);
                calendar.appendChild(dayElement);
            }
        }

        function prevMonth() {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
        }

        function selectDate(date) {
            document.getElementById('newEventDate').value = date.toISOString().split('T')[0];
        }

        function loadEvents() {
            // „Ç§„Éô„É≥„ÉàË™≠„ÅøËæº„ÅøÂá¶ÁêÜ
        }

        function addEvent() {
            const title = document.getElementById('newEventTitle').value.trim();
            const date = document.getElementById('newEventDate').value;
            const time = document.getElementById('newEventTime').value;
            const type = document.getElementById('newEventType').value;
            const description = document.getElementById('newEventDescription').value.trim();
            
            if (!title || !date) {
                showNotification('‰∫àÂÆöÂêç„Å®Êó•‰ªò„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            const events = JSON.parse(localStorage.getItem(STORAGE_KEYS.events) || '[]');
            const newEvent = {
                id: Date.now(),
                title,
                date,
                time,
                type,
                description,
                createdAt: new Date().toISOString()
            };
            
            events.push(newEvent);
            localStorage.setItem(STORAGE_KEYS.events, JSON.stringify(events));
            
            // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢
            document.getElementById('newEventTitle').value = '';
            document.getElementById('newEventDate').value = '';
            document.getElementById('newEventTime').value = '';
            document.getElementById('newEventDescription').value = '';
            
            renderCalendar();
            loadTodayEvents();
            updateAllStats();
            showNotification('‰∫àÂÆö„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü', 'success');
        }

        function loadTodayEvents() {
            const today = new Date().toISOString().split('T')[0];
            const events = JSON.parse(localStorage.getItem(STORAGE_KEYS.events) || '[]');
            const todayEvents = events.filter(event => event.date === today);
            
            const container = document.getElementById('todayEvents');
            if (!container) return;
            
            if (todayEvents.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">‰ªäÊó•„ÅÆ‰∫àÂÆö„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }
            
            container.innerHTML = todayEvents.map(event => `
                <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="font-medium">${event.title}</div>
                    <div class="text-sm text-gray-600">
                        ${event.time || 'ÊôÇÈñìÊú™Ë®≠ÂÆö'} | ${getEventTypeLabel(event.type)}
                    </div>
                    ${event.description ? `<div class="text-sm text-gray-500 mt-1">${event.description}</div>` : ''}
                </div>
            `).join('');
        }

        function getEventTypeLabel(type) {
            const labels = {
                'meeting': '‰ºöË≠∞',
                'deadline': 'Á∑†Âàá',
                'event': '„Ç§„Éô„É≥„Éà',
                'reminder': '„É™„Éû„Ç§„É≥„ÉÄ„Éº',
                'goal_setting': 'ÁõÆÊ®ôË®≠ÂÆö'
            };
            return labels[type] || '„Åù„ÅÆ‰ªñ';
        }

        // „Éá„Ç∂„Ç§„É≥ÈÉ®ÈñÄÁÆ°ÁêÜ
        function loadDesignProjects() {
            const projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.designProjects) || '[]');
            const projectList = document.getElementById('designProjectList');
            if (!projectList) return;
            
            const filter = document.getElementById('designFilter')?.value || 'all';
            let filteredProjects = projects;
            
            if (filter !== 'all') {
                filteredProjects = projects.filter(project => project.status === filter);
            }
            
            if (filteredProjects.length === 0) {
                projectList.innerHTML = '<div class="text-center py-8 text-gray-500">Ê°à‰ª∂„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }
            
            projectList.innerHTML = filteredProjects.map((project, index) => {
                const originalIndex = projects.findIndex(p => p.id === project.id);
                const priorityClass = project.priority === 'urgent' ? 'urgent' : project.priority === 'high' ? 'priority-high' : '';
                
                return `
                    <div class="task-item ${priorityClass}">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="font-medium">${project.title}</div>
                                <div class="text-sm text-gray-600">
                                    ${project.client} | ${getDesignTypeLabel(project.type)} | ${getDesignStatusLabel(project.status)}
                                    ${project.dueDate ? ` | ÊúüÈôê: ${new Date(project.dueDate).toLocaleDateString('ja-JP')}` : ''}
                                </div>
                                ${project.description ? `<div class="text-sm text-gray-500 mt-1">${project.description}</div>` : ''}
                            </div>
                            <div class="flex space-x-2">
                                <select onchange="updateDesignStatus(${originalIndex}, this.value)" class="text-xs p-1 border rounded">
                                    <option value="planning" ${project.status === 'planning' ? 'selected' : ''}>‰ºÅÁîª‰∏≠</option>
                                    <option value="designing" ${project.status === 'designing' ? 'selected' : ''}>„Éá„Ç∂„Ç§„É≥‰∏≠</option>
                                    <option value="review" ${project.status === 'review' ? 'selected' : ''}>„É¨„Éì„É•„Éº‰∏≠</option>
                                    <option value="completed" ${project.status === 'completed' ? 'selected' : ''}>ÂÆå‰∫Ü</option>
                                </select>
                                <button onclick="deleteDesignProject(${originalIndex})" class="p-2 text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addDesignProject() {
            const title = document.getElementById('newDesignTitle').value.trim();
            const type = document.getElementById('newDesignType').value;
            const priority = document.getElementById('newDesignPriority').value;
            const dueDate = document.getElementById('newDesignDue').value;
            const client = document.getElementById('newDesignClient').value.trim();
            const status = document.getElementById('newDesignStatus').value;
            const description = document.getElementById('newDesignDescription').value.trim();
            
            if (!title || !client) {
                showNotification('Ê°à‰ª∂Âêç„Å®‰æùÈ†ºËÄÖ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            const projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.designProjects) || '[]');
            const newProject = {
                id: Date.now(),
                title,
                type,
                priority,
                dueDate,
                client,
                status,
                description,
                createdAt: new Date().toISOString()
            };
            
            projects.push(newProject);
            localStorage.setItem(STORAGE_KEYS.designProjects, JSON.stringify(projects));
            
            // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢
            document.getElementById('newDesignTitle').value = '';
            document.getElementById('newDesignClient').value = '';
            document.getElementById('newDesignDue').value = '';
            document.getElementById('newDesignDescription').value = '';
            
            loadDesignProjects();
            updateDesignStats();
            updateAllStats();
            showNotification('„Éá„Ç∂„Ç§„É≥Ê°à‰ª∂„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü', 'success');
        }

        function updateDesignStatus(index, newStatus) {
            const projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.designProjects) || '[]');
            projects[index].status = newStatus;
            
            if (newStatus === 'completed') {
                projects[index].completedAt = new Date().toISOString();
            }
            
            localStorage.setItem(STORAGE_KEYS.designProjects, JSON.stringify(projects));
            loadDesignProjects();
            updateDesignStats();
            updateAllStats();
        }

        function deleteDesignProject(index) {
            if (confirm('„Åì„ÅÆÊ°à‰ª∂„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                const projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.designProjects) || '[]');
                projects.splice(index, 1);
                localStorage.setItem(STORAGE_KEYS.designProjects, JSON.stringify(projects));
                loadDesignProjects();
                updateDesignStats();
                updateAllStats();
                showNotification('Ê°à‰ª∂„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'info');
            }
        }

        function filterDesignProjects() {
            loadDesignProjects();
        }

        function updateDesignStats() {
            const projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.designProjects) || '[]');
            
            const planningCount = projects.filter(p => p.status === 'planning').length;
            const designingCount = projects.filter(p => p.status === 'designing').length;
            const reviewCount = projects.filter(p => p.status === 'review').length;
            const completedCount = projects.filter(p => p.status === 'completed').length;
            
            const planningElement = document.getElementById('planningCount');
            const designingElement = document.getElementById('designingCount');
            const reviewElement = document.getElementById('reviewCount');
            const completedElement = document.getElementById('designCompletedCount');
            
            if (planningElement) planningElement.textContent = planningCount;
            if (designingElement) designingElement.textContent = designingCount;
            if (reviewElement) reviewElement.textContent = reviewCount;
            if (completedElement) completedElement.textContent = completedCount;
            
            // Á∑†ÂàáËø´„ÇãÊ°à‰ª∂
            const today = new Date();
            const urgentProjects = projects.filter(project => {
                if (!project.dueDate || project.status === 'completed') return false;
                const dueDate = new Date(project.dueDate);
                const daysUntilDue = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                return daysUntilDue <= 3 && daysUntilDue >= 0;
            });
            
            const urgentContainer = document.getElementById('urgentDesignProjects');
            if (urgentContainer) {
                if (urgentProjects.length === 0) {
                    urgentContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Á∑†ÂàáËø´„ÇãÊ°à‰ª∂„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                } else {
                    urgentContainer.innerHTML = urgentProjects.map(project => `
                        <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                            <div class="font-medium text-sm">${project.title}</div>
                            <div class="text-xs text-gray-600">${project.client}</div>
                            <div class="text-xs text-red-600 mt-1">
                                ÊúüÈôê: ${new Date(project.dueDate).toLocaleDateString('ja-JP')}
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        function getDesignTypeLabel(type) {
            const labels = {
                'logo': '„É≠„Ç¥',
                'flyer': '„ÉÅ„É©„Ç∑',
                'web': 'Web',
                'banner': '„Éê„Éä„Éº',
                'package': '„Éë„ÉÉ„Ç±„Éº„Ç∏',
                'interior': 'Â∫óËàóÂÜÖË£Ö',
                'other': '„Åù„ÅÆ‰ªñ'
            };
            return labels[type] || '„Åù„ÅÆ‰ªñ';
        }

        function getDesignStatusLabel(status) {
            const labels = {
                'planning': '‰ºÅÁîª‰∏≠',
                'designing': '„Éá„Ç∂„Ç§„É≥‰∏≠',
                'review': '„É¨„Éì„É•„Éº‰∏≠',
                'completed': 'ÂÆå‰∫Ü'
            };
            return labels[status] || '‰∏çÊòé';
        }

        // Â£≤‰∏äÂàÜÊûê
        function uploadSalesData(event) {
            const file = event.target.files[0];
            if (!file) {
                showNotification('„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            // Excel(.xlsx)„Å®CSV(.csv)‰∏°Êñπ„Å´ÂØæÂøú
            if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                handleExcelUpload(file);
            } else if (file.name.endsWith('.csv')) {
                handleCSVUpload(file);
            } else {
                showNotification('Excel(.xlsx)„Åæ„Åü„ÅØCSV(.csv)„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
            }
        }

        function handleExcelUpload(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    
                    // JSON„Å´Â§âÊèõ
                    const rawData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    const processedData = processExcelData(rawData);
                    
                    localStorage.setItem(STORAGE_KEYS.salesData, JSON.stringify(processedData));
                    analyzeSalesData(processedData);
                    showNotification('Excel„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü', 'success');
                } catch (error) {
                    console.error('ExcelË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                    showNotification('Excel„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function handleCSVUpload(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.trim().split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    const salesData = lines.slice(1).map(line => {
                        const values = line.split(',');
                        const data = {};
                        headers.forEach((header, index) => {
                            data[header] = values[index]?.trim() || '';
                        });
                        return data;
                    });
                    
                    localStorage.setItem(STORAGE_KEYS.salesData, JSON.stringify(salesData));
                    analyzeSalesData(salesData);
                    showNotification('CSV„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü', 'success');
                } catch (error) {
                    showNotification('CSV„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        function processExcelData(rawData) {
            if (rawData.length < 2) return [];
            
            const headers = rawData[0];
            const dataRows = rawData.slice(1);
            
            return dataRows.map(row => {
                if (!row[0] || !row[1]) return null;
                
                // Êó•‰ªò„ÅÆÂá¶ÁêÜÔºàExcel„Ç∑„É™„Ç¢„É´ÂÄ§„ÇíÊó•‰ªò„Å´Â§âÊèõÔºâ
                let normalizedDate = '';
                if (row[0]) {
                    if (typeof row[0] === 'number') {
                        // Excel„Ç∑„É™„Ç¢„É´ÂÄ§„ÅÆÂ†¥Âêà
                        const excelDate = new Date((row[0] - 25569) * 86400 * 1000);
                        normalizedDate = excelDate.toISOString().split('T')[0];
                    } else if (typeof row[0] === 'string') {
                        // ÊñáÂ≠óÂàóÂΩ¢Âºè„ÅÆÂ†¥ÂêàÔºà6/1„Å™„Å©Ôºâ
                        const dateStr = row[0].toString();
                        if (dateStr.includes('/')) {
                            const parts = dateStr.split('/');
                            if (parts.length === 2) {
                                const month = parts[0].padStart(2, '0');
                                const day = parts[1].padStart(2, '0');
                                normalizedDate = `2025-${month}-${day}`;
                            }
                        }
                    }
                }
                
                // Â£≤‰∏ä„ÅÆÂá¶ÁêÜÔºà„Ç´„É≥„ÉûÈô§Âéª„ÄÅÊï∞ÂÄ§ÂåñÔºâ
                let salesAmount = 0;
                if (row[2]) {
                    const cleanSales = row[2].toString().replace(/,/g, '').replace(/¬•/g, '');
                    salesAmount = parseFloat(cleanSales) || 0;
                }
                
                return {
                    Êó•‰ªò: normalizedDate,
                    Â∫óËàó: row[1],
                    Â£≤‰∏ä: salesAmount,
                    ÂÜô„É°Êó•Ë®ò: parseInt(row[3]) || 0,
                    Âè£„Ç≥„Éü: parseInt(row[4]) || 0
                };
            }).filter(item => item !== null);
        }

        function analyzeSalesData(data) {
            document.getElementById('salesUploadArea').classList.add('hidden');
            document.getElementById('salesAnalysis').classList.remove('hidden');
            
            // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å´‰øùÂ≠ò
            currentSalesData = data;
            
            // Â∫óËàóÂà•Áµ±Ë®à„ÅÆË®àÁÆó
            const storeStats = {};
            const dateStats = {};
            let totalSales = 0;
            let totalDiary = 0;
            let totalReviews = 0;
            
            data.forEach(row => {
                const store = row.Â∫óËàó || row['Â∫óËàóÂêç'] || row.store || '‰∏çÊòé';
                const sales = parseFloat(row.Â£≤‰∏ä || row.sales || '0');
                const diary = parseInt(row.ÂÜô„É°Êó•Ë®ò || row.diary || '0');
                const reviews = parseInt(row.Âè£„Ç≥„Éü || row.reviews || '0');
                const date = row.Êó•‰ªò || row.date || '';
                
                // Â∫óËàóÂà•ÈõÜË®à
                if (!storeStats[store]) {
                    storeStats[store] = {
                        Á∑èÂ£≤‰∏ä: 0,
                        Á∑èÂÜô„É°Êó•Ë®ò: 0,
                        Á∑èÂè£„Ç≥„Éü: 0,
                        Êó•Êï∞: 0,
                        Â£≤‰∏ä„Éá„Éº„Çø: []
                    };
                }
                
                storeStats[store].Á∑èÂ£≤‰∏ä += sales;
                storeStats[store].Á∑èÂÜô„É°Êó•Ë®ò += diary;
                storeStats[store].Á∑èÂè£„Ç≥„Éü += reviews;
                storeStats[store].Êó•Êï∞++;
                storeStats[store].Â£≤‰∏ä„Éá„Éº„Çø.push({ Êó•‰ªò: date, Â£≤‰∏ä: sales });
                
                // Êó•‰ªòÂà•ÈõÜË®à
                if (date && !dateStats[date]) {
                    dateStats[date] = { Á∑èÂ£≤‰∏ä: 0, Â∫óËàóÊï∞: 0 };
                }
                if (date) {
                    dateStats[date].Á∑èÂ£≤‰∏ä += sales;
                    dateStats[date].Â∫óËàóÊï∞++;
                }
                
                totalSales += sales;
                totalDiary += diary;
                totalReviews += reviews;
            });
            
            // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å´‰øùÂ≠ò
            currentStoreStats = storeStats;
            
            // ‰∏ä‰ΩçÂ∫óËàó„ÅÆÁâπÂÆö
            const sortedStores = Object.entries(storeStats)
                .sort(([,a], [,b]) => b.Á∑èÂ£≤‰∏ä - a.Á∑èÂ£≤‰∏ä);
            const topStore = sortedStores[0] ? sortedStores[0][0] : '‰∏çÊòé';
            
            // Âπ≥ÂùáÂ£≤‰∏ä„ÅÆË®àÁÆó
            const averageSales = data.length > 0 ? totalSales / data.length : 0;
            
            // ÂâçÊúàÊØîÊàêÈï∑Áéá„ÅÆË®àÁÆó
            const growthRate = calculateGrowthRate(dateStats);
            
            // Âü∫Êú¨Áµ±Ë®à„ÅÆË°®Á§∫
            document.getElementById('totalSales').textContent = `¬•${Math.round(totalSales).toLocaleString()}`;
            document.getElementById('averageSales').textContent = `¬•${Math.round(averageSales).toLocaleString()}`;
            document.getElementById('topStore').textContent = topStore;
            document.getElementById('growthRate').textContent = `+${growthRate.toFixed(1)}%`;
            
            // Â∫óËàó„Çª„É¨„ÇØ„Çø„Éº„ÅÆÂàùÊúüÂåñ
            initializeStoreSelector(storeStats);
            
            // „ÉÅ„É£„Éº„ÉàË°®Á§∫
            renderSalesChart(storeStats);
            
            // ÁõÆÊ®ôÁÆ°ÁêÜ„Å®„ÅÆÈÄ£Êê∫
            updateGoalsWithSalesData();
        }

        function initializeStoreSelector(storeStats) {
            const selector = document.getElementById('storeSelector');
            if (!selector) return;
            
            // Êó¢Â≠ò„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥„Çí„ÇØ„É™„Ç¢ÔºàÊúÄÂàù„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥„ÅØÊÆã„ÅôÔºâ
            while (selector.children.length > 1) {
                selector.removeChild(selector.lastChild);
            }
            
            // Â£≤‰∏äÈ†Ü„Åß„ÇΩ„Éº„Éà„Åó„ÅüÂ∫óËàó„ÇíËøΩÂä†
            const sortedStores = Object.entries(storeStats)
                .sort(([,a], [,b]) => b.Á∑èÂ£≤‰∏ä - a.Á∑èÂ£≤‰∏ä);
            
            sortedStores.forEach(([store, stats], index) => {
                const option = document.createElement('option');
                option.value = store;
                const rank = index + 1;
                const rankIcon = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : '';
                option.textContent = `${rankIcon} ${store} (¬•${Math.round(stats.Á∑èÂ£≤‰∏ä / stats.Êó•Êï∞).toLocaleString()}/Êó•)`;
                selector.appendChild(option);
            });
        }

        function updateGoalsWithSalesData() {
            // ÁõÆÊ®ôÁÆ°ÁêÜ„Çø„Éñ„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÊõ¥Êñ∞
            if (currentTab === 'goals') {
                loadGoalProgress();
            }
        }

        function calculateGrowthRate(dateStats) {
            const dates = Object.keys(dateStats).sort();
            if (dates.length < 7) return 0;
            
            const recentWeek = dates.slice(-7);
            const previousWeek = dates.slice(-14, -7);
            
            const recentTotal = recentWeek.reduce((sum, date) => sum + dateStats[date].Á∑èÂ£≤‰∏ä, 0);
            const previousTotal = previousWeek.reduce((sum, date) => sum + dateStats[date].Á∑èÂ£≤‰∏ä, 0);
            
            if (previousTotal === 0) return 0;
            return ((recentTotal - previousTotal) / previousTotal) * 100;
        }

        function renderSalesChart(storeData) {
            const canvas = document.getElementById('salesChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const stores = Object.keys(storeData);
            const sales = Object.values(storeData).map(store => store.Á∑èÂ£≤‰∏ä);
            
            // „Ç≠„É£„É≥„Éê„Çπ„ÇØ„É™„Ç¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Á∞°ÊòìÊ£í„Ç∞„É©„Éï
            const maxSales = Math.max(...sales);
            const barWidth = Math.max(20, (canvas.width - 40) / stores.length - 10);
            const barHeight = canvas.height - 60;
            
            stores.forEach((store, index) => {
                const x = index * (barWidth + 10) + 20;
                const height = (sales[index] / maxSales) * barHeight;
                const y = canvas.height - height - 40;
                
                // „Éê„ÉºÊèèÁîª
                ctx.fillStyle = `hsl(${index * 30}, 70%, 50%)`;
                ctx.fillRect(x, y, barWidth, height);
                
                // Â∫óËàóÂêç
                ctx.fillStyle = '#333';
                ctx.font = '10px Arial';
                ctx.save();
                ctx.translate(x + barWidth/2, canvas.height - 20);
                ctx.rotate(-Math.PI/4);
                ctx.textAlign = 'right';
                ctx.fillText(store.length > 8 ? store.substring(0, 6) + '...' : store, 0, 0);
                ctx.restore();
                
                // Â£≤‰∏äÈáëÈ°ç
                ctx.fillStyle = '#333';
                ctx.font = '8px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`¬•${Math.round(sales[index]/1000)}K`, x + barWidth/2, y - 5);
            });
        }

        function downloadSalesTemplate() {
            const templateData = [
                ['Êó•‰ªò', 'Â∫óËàóÂêç', 'Â£≤‰∏ä', 'ÂÜô„É°Êó•Ë®ò', 'Âè£„Ç≥„Éü'],
                ['2025-06-01', 'CLASSYÊù±‰∫¨', '150000', '25', '3'],
                ['2025-06-01', 'CLASSYÂêçÂè§Â±ã', '120000', '20', '2'],
                ['2025-06-02', 'CLASSYÊù±‰∫¨', '180000', '30', '4']
            ];
            
            const csv = templateData.map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Â£≤‰∏ä„Éá„Éº„Çø„ÉÜ„É≥„Éó„É¨„Éº„Éà.csv';
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü', 'success');
        }

        function loadSampleData() {
            // „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„ÅüExcel„Éï„Ç°„Ç§„É´„ÅÆÂÆüÈöõ„ÅÆ„Éá„Éº„Çø„Çí„Çµ„É≥„Éó„É´„Å®„Åó„Å¶‰ΩøÁî®
            const sampleData = [
                { Êó•‰ªò: '2025-06-01', Â∫óËàó: 'CLASSYÂõõÊó•Â∏Ç', Â£≤‰∏ä: 475000, ÂÜô„É°Êó•Ë®ò: 228, Âè£„Ç≥„Éü: 7 },
                { Êó•‰ªò: '2025-06-01', Â∫óËàó: 'CLASSYÊù±‰∫¨', Â£≤‰∏ä: 81900, ÂÜô„É°Êó•Ë®ò: 44, Âè£„Ç≥„Éü: 0 },
                { Êó•‰ªò: '2025-06-01', Â∫óËàó: 'CLASSYÂêçÂè§Â±ã', Â£≤‰∏ä: 122564, ÂÜô„É°Êó•Ë®ò: 48, Âè£„Ç≥„Éü: 3 },
                { Êó•‰ªò: '2025-06-01', Â∫óËàó: 'GrandOperaÊù±‰∫¨', Â£≤‰∏ä: 765860, ÂÜô„É°Êó•Ë®ò: 129, Âè£„Ç≥„Éü: 9 },
                { Êó•‰ªò: '2025-06-01', Â∫óËàó: 'GrandOperaÊ®™Êµú', Â£≤‰∏ä: 678500, ÂÜô„É°Êó•Ë®ò: 152, Âè£„Ç≥„Éü: 2 },
                { Êó•‰ªò: '2025-06-01', Â∫óËàó: 'GrandOperaÂêçÂè§Â±ã', Â£≤‰∏ä: 713800, ÂÜô„É°Êó•Ë®ò: 128, Âè£„Ç≥„Éü: 12 },
                { Êó•‰ªò: '2025-06-01', Â∫óËàó: 'GrandOperaÁ¶èÂ≤°', Â£≤‰∏ä: 1130380, ÂÜô„É°Êó•Ë®ò: 267, Âè£„Ç≥„Éü: 8 },
                { Êó•‰ªò: '2025-06-01', Â∫óËàó: '„Ç™„Éö„É©Èå¶', Â£≤‰∏ä: 102900, ÂÜô„É°Êó•Ë®ò: 46, Âè£„Ç≥„Éü: 6 },
                { Êó•‰ªò: '2025-06-01', Â∫óËàó: '„Ç∑„É£„Éñ„Éº„É´', Â£≤‰∏ä: 702640, ÂÜô„É°Êó•Ë®ò: 232, Âè£„Ç≥„Éü: 13 },
                { Êó•‰ªò: '2025-06-01', Â∫óËàó: '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà', Â£≤‰∏ä: 520000, ÂÜô„É°Êó•Ë®ò: 180, Âè£„Ç≥„Éü: 5 },
                // 30Êó•ÂàÜ„ÅÆ„Éá„Éº„Çø„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
                ...Array.from({ length: 290 }, (_, i) => {
                    const date = new Date('2025-06-02');
                    date.setDate(date.getDate() + Math.floor(i / 10));
                    const stores = ['CLASSYÂõõÊó•Â∏Ç', 'CLASSYÊù±‰∫¨', 'CLASSYÂêçÂè§Â±ã', 'GrandOperaÊù±‰∫¨', 'GrandOperaÊ®™Êµú', 'GrandOperaÂêçÂè§Â±ã', 'GrandOperaÁ¶èÂ≤°', '„Ç™„Éö„É©Èå¶', '„Ç∑„É£„Éñ„Éº„É´', '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà'];
                    const store = stores[i % 10];
                    const baseStats = {
                        'CLASSYÂõõÊó•Â∏Ç': { base: 220000, diary: 103, reviews: 4.2 },
                        'CLASSYÊù±‰∫¨': { base: 112000, diary: 31, reviews: 2.1 },
                        'CLASSYÂêçÂè§Â±ã': { base: 61000, diary: 21, reviews: 1.4 },
                        'GrandOperaÊù±‰∫¨': { base: 538000, diary: 73, reviews: 2.4 },
                        'GrandOperaÊ®™Êµú': { base: 413000, diary: 84, reviews: 2.2 },
                        'GrandOperaÂêçÂè§Â±ã': { base: 511000, diary: 53, reviews: 4.0 },
                        'GrandOperaÁ¶èÂ≤°': { base: 677000, diary: 139, reviews: 3.7 },
                        '„Ç™„Éö„É©Èå¶': { base: 58000, diary: 30, reviews: 1.8 },
                        '„Ç∑„É£„Éñ„Éº„É´': { base: 499000, diary: 119, reviews: 6.5 },
                        '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà': { base: 323000, diary: 156, reviews: 3.3 }
                    };
                    
                    const stats = baseStats[store];
                    const variation = 0.8 + Math.random() * 0.4; // ¬±20%„ÅÆÂ§âÂãï
                    
                    return {
                        Êó•‰ªò: date.toISOString().split('T')[0],
                        Â∫óËàó: store,
                        Â£≤‰∏ä: Math.round(stats.base * variation),
                        ÂÜô„É°Êó•Ë®ò: Math.round(stats.diary * variation),
                        Âè£„Ç≥„Éü: Math.round(stats.reviews * variation)
                    };
                })
            ];
            
            localStorage.setItem(STORAGE_KEYS.salesData, JSON.stringify(sampleData));
            analyzeSalesData(sampleData);
            showNotification('Ê•≠ÂãôÁÆ°ÁêÜ„Éá„Éº„ÇøÔºà„Çµ„É≥„Éó„É´30Êó•ÂàÜÔºâ„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü', 'success');
        }

        // ÁõÆÊ®ôÁÆ°ÁêÜ - ‰øÆÊ≠£Áâà
        function initGoalSettings() {
            const container = document.getElementById('goalSettings');
            if (!container) return;
            
            const currentMonth = document.getElementById('goalMonth').value;
            
            container.innerHTML = STORES.map(store => `
                <div class="p-4 border border-gray-200 rounded-lg hover:border-blue-300 transition-colors">
                    <h5 class="font-semibold mb-3 flex items-center">
                        <i class="fas fa-store mr-2 text-blue-600"></i>${store.name}
                        <span id="storeRanking_${store.id}" class="ml-2 text-sm text-gray-500"></span>
                    </h5>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">
                                Â£≤‰∏äÁõÆÊ®ô <span class="text-xs text-gray-400">(ÊúàÈ°ç„ÉªÂÜÜ)</span>
                            </label>
                            <input type="number" id="sales_${store.id}" class="input-field" placeholder="‰æã: 3000000">
                            <div id="salesSuggestion_${store.id}" class="text-xs text-blue-600 mt-1"></div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">
                                ÂÜô„É°Êó•Ë®òÁõÆÊ®ô <span class="text-xs text-gray-400">(ÊúàÂêàË®à„Éª‰ª∂Êï∞)</span>
                            </label>
                            <input type="number" id="diary_${store.id}" class="input-field" placeholder="‰æã: 900">
                            <div id="diarySuggestion_${store.id}" class="text-xs text-blue-600 mt-1"></div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">
                                Âè£„Ç≥„ÉüÁõÆÊ®ô <span class="text-xs text-gray-400">(ÊúàÂêàË®à„Éª‰ª∂Êï∞)</span>
                            </label>
                            <input type="number" id="review_${store.id}" class="input-field" placeholder="‰æã: 45">
                            <div id="reviewSuggestion_${store.id}" class="text-xs text-blue-600 mt-1"></div>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-500 bg-gray-50 p-2 rounded">
                        <i class="fas fa-info-circle mr-1"></i>
                        Â£≤‰∏ä„ÉªÂÜô„É°Êó•Ë®ò„ÉªÂè£„Ç≥„Éü„Åô„Åπ„Å¶ÊúàÂêàË®à„ÅßË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                    </div>
                </div>
            `).join('');
            
            // Êó¢Â≠ò„ÅÆÁõÆÊ®ô„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
            loadExistingGoals(currentMonth);
            
            // ÂÆüÁ∏æ„Éô„Éº„Çπ„ÅÆÊé®Â•®ÂÄ§„ÇíË°®Á§∫
            showGoalSuggestions();
        }

        function loadExistingGoals(month) {
            const goals = JSON.parse(localStorage.getItem(STORAGE_KEYS.goals) || '{}');
            const monthGoals = goals[month] || {};
            
            STORES.forEach(store => {
                const storeGoals = monthGoals[store.id] || {};
                const salesInput = document.getElementById(`sales_${store.id}`);
                const diaryInput = document.getElementById(`diary_${store.id}`);
                const reviewInput = document.getElementById(`review_${store.id}`);
                
                if (salesInput) salesInput.value = storeGoals.sales || '';
                if (diaryInput) diaryInput.value = storeGoals.diary || '';
                if (reviewInput) reviewInput.value = storeGoals.review || '';
            });
        }

        function showGoalSuggestions() {
            if (!currentSalesData || currentSalesData.length === 0) return;
            
            // Áõ¥Ëøë30Êó•„ÅÆ„Éá„Éº„Çø„Åã„ÇâÊé®Â•®ÂÄ§„ÇíË®àÁÆó
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            STORES.forEach(store => {
                const storeMapping = {
                    'classy_tokyo': 'CLASSYÊù±‰∫¨',
                    'classy_nagoya': 'CLASSYÂêçÂè§Â±ã', 
                    'classy_yokkaichi': 'CLASSYÂõõÊó•Â∏Ç',
                    'grandopera_tokyo': 'GrandOperaÊù±‰∫¨',
                    'grandopera_yokohama': 'GrandOperaÊ®™Êµú',
                    'grandopera_nagoya': 'GrandOperaÂêçÂè§Â±ã',
                    'grandopera_fukuoka': 'GrandOperaÁ¶èÂ≤°',
                    'wancarat': '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà',
                    'shabour': '„Ç∑„É£„Éñ„Éº„É´',
                    'opera_nishiki': '„Ç™„Éö„É©Èå¶'
                };
                
                const targetStoreName = storeMapping[store.id];
                const storeData = currentSalesData.filter(row => 
                    (row.Â∫óËàó || row.Â∫óËàóÂêç) === targetStoreName
                );
                
                if (storeData.length > 0) {
                    const totalSales = storeData.reduce((sum, row) => sum + (row.Â£≤‰∏ä || 0), 0);
                    const totalDiary = storeData.reduce((sum, row) => sum + (row.ÂÜô„É°Êó•Ë®ò || 0), 0);
                    const totalReviews = storeData.reduce((sum, row) => sum + (row.Âè£„Ç≥„Éü || 0), 0);
                    
                    // ÊàêÈï∑Áéá„ÇíËÄÉÊÖÆ„Åó„ÅüÊé®Â•®ÂÄ§Ôºà5%Âêë‰∏ä„ÇíÁõÆÊ®ôÔºâ
                    const recommendedSales = Math.round(totalSales * 1.05);
                    const recommendedDiary = Math.round(totalDiary * 1.05);
                    const recommendedReviews = Math.round(totalReviews * 1.05);
                    
                    // „É©„É≥„Ç≠„É≥„Ç∞Ë°®Á§∫
                    if (currentStoreStats[targetStoreName]) {
                        const sortedStores = Object.entries(currentStoreStats)
                            .sort(([,a], [,b]) => b.Á∑èÂ£≤‰∏ä - a.Á∑èÂ£≤‰∏ä);
                        const rank = sortedStores.findIndex(([storeName,]) => storeName === targetStoreName) + 1;
                        const rankElement = document.getElementById(`storeRanking_${store.id}`);
                        if (rankElement) {
                            const rankIcon = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : `#${rank}`;
                            rankElement.textContent = `${rankIcon} ÁèæÂú®${rank}‰Ωç`;
                        }
                    }
                    
                    // Êé®Â•®ÂÄ§Ë°®Á§∫
                    const salesSuggestion = document.getElementById(`salesSuggestion_${store.id}`);
                    const diarySuggestion = document.getElementById(`diarySuggestion_${store.id}`);
                    const reviewSuggestion = document.getElementById(`reviewSuggestion_${store.id}`);
                    
                    if (salesSuggestion) salesSuggestion.textContent = `Êé®Â•®: ¬•${recommendedSales.toLocaleString()} (+5%)`;
                    if (diarySuggestion) diarySuggestion.textContent = `Êé®Â•®: ${recommendedDiary}‰ª∂/Êúà (+5%)`;
                    if (reviewSuggestion) reviewSuggestion.textContent = `Êé®Â•®: ${recommendedReviews}‰ª∂/Êúà (+5%)`;
                }
            });
        }

        function copyPreviousMonthGoals() {
            const currentMonth = document.getElementById('goalMonth').value;
            const prevMonth = new Date(currentMonth + '-01');
            prevMonth.setMonth(prevMonth.getMonth() - 1);
            const prevMonthString = prevMonth.toISOString().substr(0, 7);
            
            const goals = JSON.parse(localStorage.getItem(STORAGE_KEYS.goals) || '{}');
            const prevMonthGoals = goals[prevMonthString];
            
            if (!prevMonthGoals) {
                showNotification('ÂâçÊúà„ÅÆÁõÆÊ®ô„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'warning');
                return;
            }
            
            STORES.forEach(store => {
                const storeGoals = prevMonthGoals[store.id] || {};
                const salesInput = document.getElementById(`sales_${store.id}`);
                const diaryInput = document.getElementById(`diary_${store.id}`);
                const reviewInput = document.getElementById(`review_${store.id}`);
                
                if (salesInput) salesInput.value = storeGoals.sales || '';
                if (diaryInput) diaryInput.value = storeGoals.diary || '';
                if (reviewInput) reviewInput.value = storeGoals.review || '';
            });
            
            showNotification('ÂâçÊúà„ÅÆÁõÆÊ®ô„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü', 'success');
        }

        function saveGoals() {
            const month = document.getElementById('goalMonth').value;
            const goals = JSON.parse(localStorage.getItem(STORAGE_KEYS.goals) || '{}');
            
            if (!goals[month]) {
                goals[month] = {};
            }
            
            STORES.forEach(store => {
                const sales = document.getElementById(`sales_${store.id}`).value;
                const diary = document.getElementById(`diary_${store.id}`).value;
                const review = document.getElementById(`review_${store.id}`).value;
                
                goals[month][store.id] = {
                    sales: sales ? parseInt(sales) : 0,
                    diary: diary ? parseInt(diary) : 0,
                    review: review ? parseInt(review) : 0
                };
            });
            
            localStorage.setItem(STORAGE_KEYS.goals, JSON.stringify(goals));
            loadGoalProgress();
            showNotification('ÁõÆÊ®ô„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', 'success');
        }

        function refreshGoalData() {
            loadGoalProgress();
            showNotification('ÁõÆÊ®ô„Éá„Éº„Çø„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü', 'info');
        }

        function loadGoalProgress() {
            const month = document.getElementById('goalMonth').value;
            const goals = JSON.parse(localStorage.getItem(STORAGE_KEYS.goals) || '{}');
            const monthGoals = goals[month] || {};
            
            const container = document.getElementById('goalProgress');
            if (!container) return;
            
            const salesData = JSON.parse(localStorage.getItem(STORAGE_KEYS.salesData) || '[]');
            const viewMode = document.getElementById('goalViewMode')?.value || 'overview';
            
            let totalSalesGoal = 0, totalSalesActual = 0;
            let totalDiaryGoal = 0, totalDiaryActual = 0;
            let totalReviewGoal = 0, totalReviewActual = 0;
            let storeCount = 0;
            
            const storeResults = STORES.map(store => {
                const storeGoals = monthGoals[store.id] || {};
                const currentSales = calculateCurrentSales(salesData, store.id, month);
                const currentDiary = calculateCurrentDiary(salesData, store.id, month);
                const currentReviews = calculateCurrentReviews(salesData, store.id, month);
                
                const salesProgress = storeGoals.sales > 0 ? (currentSales / storeGoals.sales) * 100 : 0;
                const diaryProgress = storeGoals.diary > 0 ? (currentDiary / storeGoals.diary) * 100 : 0;
                const reviewsProgress = storeGoals.review > 0 ? (currentReviews / storeGoals.review) * 100 : 0;
                
                const overallProgress = (salesProgress + diaryProgress + reviewsProgress) / 3;
                
                // ÂÖ®‰ΩìÁµ±Ë®à„Å´Âä†ÁÆó
                totalSalesGoal += storeGoals.sales || 0;
                totalSalesActual += currentSales;
                totalDiaryGoal += storeGoals.diary || 0;
                totalDiaryActual += currentDiary;
                totalReviewGoal += storeGoals.review || 0;
                totalReviewActual += currentReviews;
                storeCount++;
                
                return {
                    store,
                    storeGoals,
                    currentSales,
                    currentDiary,
                    currentReviews,
                    salesProgress,
                    diaryProgress,
                    reviewsProgress,
                    overallProgress
                };
            });
            
            // ÂÖ®‰ΩìÈÅîÊàêÁéá„ÇíÊõ¥Êñ∞
            const overallSalesAchievement = totalSalesGoal > 0 ? Math.round((totalSalesActual / totalSalesGoal) * 100) : 0;
            const overallDiaryAchievement = totalDiaryGoal > 0 ? Math.round((totalDiaryActual / totalDiaryGoal) * 100) : 0;
            const overallReviewAchievement = totalReviewGoal > 0 ? Math.round((totalReviewActual / totalReviewGoal) * 100) : 0;
            
            document.getElementById('overallSalesAchievement').textContent = `${overallSalesAchievement}%`;
            document.getElementById('overallDiaryAchievement').textContent = `${overallDiaryAchievement}%`;
            document.getElementById('overallReviewAchievement').textContent = `${overallReviewAchievement}%`;
            
            // Â∫óËàóÂà•ÈÄ≤ÊçóË°®Á§∫
            if (viewMode === 'overview') {
                container.innerHTML = storeResults.map(result => {
                    const {store, storeGoals, currentSales, currentDiary, currentReviews, salesProgress, diaryProgress, reviewsProgress, overallProgress} = result;
                    
                    // ÂÜô„É°Êó•Ë®ò„ÅØÊó•Âπ≥Âùá„ÅßË°®Á§∫
                    const avgDiary = storeGoals.diary > 0 ? Math.round(storeGoals.diary / 30 * 10) / 10 : 0;
                    const currentAvgDiary = Math.round(currentDiary / 30 * 10) / 10;
                    
                    return `
                        <div class="p-4 border border-gray-200 rounded-lg ${overallProgress >= 100 ? 'bg-green-50 border-green-200' : overallProgress >= 80 ? 'bg-yellow-50 border-yellow-200' : 'bg-red-50 border-red-200'}">
                            <div class="flex justify-between items-center mb-3">
                                <h6 class="font-medium">${store.name}</h6>
                                <span class="text-sm font-bold ${overallProgress >= 100 ? 'text-green-600' : overallProgress >= 80 ? 'text-yellow-600' : 'text-red-600'}">
                                    ${Math.round(overallProgress)}%
                                </span>
                            </div>
                            <div class="grid grid-cols-3 gap-3 text-sm">
                                <div class="text-center">
                                    <div class="font-medium text-blue-600">Â£≤‰∏ä</div>
                                    <div class="text-xs text-gray-600">¬•${currentSales.toLocaleString()}</div>
                                    <div class="text-xs text-gray-500">/ ¬•${storeGoals.sales?.toLocaleString() || 0}</div>
                                    <div class="${salesProgress >= 100 ? 'text-green-600' : salesProgress >= 80 ? 'text-yellow-600' : 'text-red-600'} font-bold">
                                        ${Math.round(salesProgress)}%
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="font-medium text-purple-600">ÂÜô„É°Êó•Ë®ò</div>
                                    <div class="text-xs text-gray-600">${currentAvgDiary}‰ª∂/Êó•</div>
                                    <div class="text-xs text-gray-500">/ ${avgDiary}‰ª∂/Êó•</div>
                                    <div class="${diaryProgress >= 100 ? 'text-green-600' : diaryProgress >= 80 ? 'text-yellow-600' : 'text-red-600'} font-bold">
                                        ${Math.round(diaryProgress)}%
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="font-medium text-orange-600">Âè£„Ç≥„Éü</div>
                                    <div class="text-xs text-gray-600">${currentReviews}‰ª∂/Êúà</div>
                                    <div class="text-xs text-gray-500">/ ${storeGoals.review || 0}‰ª∂/Êúà</div>
                                    <div class="${reviewsProgress >= 100 ? 'text-green-600' : reviewsProgress >= 80 ? 'text-yellow-600' : 'text-red-600'} font-bold">
                                        ${Math.round(reviewsProgress)}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                // Ë©≥Á¥∞Ë°®Á§∫
                container.innerHTML = storeResults.map(result => {
                    const {store, storeGoals, currentSales, currentDiary, currentReviews, salesProgress, diaryProgress, reviewsProgress, overallProgress} = result;
                    
                    return `
                        <div class="p-4 border border-gray-200 rounded-lg ${overallProgress >= 100 ? 'bg-green-50 border-green-200' : overallProgress >= 80 ? 'bg-yellow-50 border-yellow-200' : 'bg-red-50 border-red-200'}">
                            <div class="flex justify-between items-center mb-3">
                                <h6 class="font-medium">${store.name}</h6>
                                <span class="text-sm font-bold ${overallProgress >= 100 ? 'text-green-600' : overallProgress >= 80 ? 'text-yellow-600' : 'text-red-600'}">
                                    Á∑èÂêà ${Math.round(overallProgress)}%
                                </span>
                            </div>
                            <div class="space-y-3">
                                <!-- Â£≤‰∏äÈÄ≤Êçó -->
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Â£≤‰∏äÁõÆÊ®ô</span>
                                        <span>¬•${currentSales.toLocaleString()} / ¬•${storeGoals.sales?.toLocaleString() || 0}</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full" style="width: ${Math.min(salesProgress, 100)}%"></div>
                                    </div>
                                    <div class="text-xs text-gray-600 mt-1 flex justify-between">
                                        <span>${Math.round(salesProgress)}% ÈÅîÊàê</span>
                                        <span>ÊÆã„Çä: ¬•${Math.max(0, (storeGoals.sales || 0) - currentSales).toLocaleString()}</span>
                                    </div>
                                </div>
                                
                                <!-- ÂÜô„É°Êó•Ë®òÈÄ≤Êçó -->
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>ÂÜô„É°Êó•Ë®òÁõÆÊ®ô (ÊúàÂêàË®à)</span>
                                        <span>${currentDiary} / ${storeGoals.diary || 0}‰ª∂/Êúà</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-purple-500 h-2 rounded-full" style="width: ${Math.min(diaryProgress, 100)}%"></div>
                                    </div>
                                    <div class="text-xs text-gray-600 mt-1 flex justify-between">
                                        <span>${Math.round(diaryProgress)}% ÈÅîÊàê</span>
                                        <span>Â∑Æ: ${currentDiary - (storeGoals.diary || 0)}‰ª∂/Êúà</span>
                                    </div>
                                </div>
                                
                                <!-- Âè£„Ç≥„ÉüÈÄ≤Êçó -->
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Âè£„Ç≥„ÉüÁõÆÊ®ô (ÊúàÂêàË®à)</span>
                                        <span>${currentReviews} / ${storeGoals.review || 0}‰ª∂/Êúà</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: ${Math.min(reviewsProgress, 100)}%"></div>
                                    </div>
                                    <div class="text-xs text-gray-600 mt-1 flex justify-between">
                                        <span>${Math.round(reviewsProgress)}% ÈÅîÊàê</span>
                                        <span>Â∑Æ: ${currentReviews - (storeGoals.review || 0)}‰ª∂/Êúà</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // „ÉÅ„É£„Éº„Éà„Å®„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„ÇíÊõ¥Êñ∞
            renderGoalAchievementChart(storeResults);
            generateGoalActionPlan(storeResults);
        }

        function renderGoalAchievementChart(storeResults) {
            const canvas = document.getElementById('goalAchievementChart');
            if (!canvas || storeResults.length === 0) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const chartWidth = canvas.width - 100;
            const chartHeight = canvas.height - 80;
            
            // Ëª∏„ÅÆÊèèÁîª
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            // YËª∏
            ctx.beginPath();
            ctx.moveTo(60, 20);
            ctx.lineTo(60, chartHeight + 20);
            ctx.stroke();
            
            // XËª∏
            ctx.beginPath();
            ctx.moveTo(60, chartHeight + 20);
            ctx.lineTo(chartWidth + 60, chartHeight + 20);
            ctx.stroke();
            
            // „Éá„Éº„Çø„Éê„Éº„ÅÆÊèèÁîª
            const barWidth = chartWidth / storeResults.length - 10;
            
            storeResults.forEach((result, index) => {
                const x = 60 + index * (barWidth + 10) + 5;
                const salesHeight = (result.salesProgress / 100) * (chartHeight / 3);
                const diaryHeight = (result.diaryProgress / 100) * (chartHeight / 3);
                const reviewHeight = (result.reviewsProgress / 100) * (chartHeight / 3);
                
                // Â£≤‰∏ä„Éê„ÉºÔºàÈùíÔºâ
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(x, chartHeight + 20 - salesHeight, barWidth / 3 - 2, salesHeight);
                
                // ÂÜô„É°Êó•Ë®ò„Éê„ÉºÔºàÁ¥´Ôºâ
                ctx.fillStyle = '#8b5cf6';
                ctx.fillRect(x + barWidth / 3, chartHeight + 20 - diaryHeight, barWidth / 3 - 2, diaryHeight);
                
                // Âè£„Ç≥„Éü„Éê„ÉºÔºàÁ∑ëÔºâ
                ctx.fillStyle = '#10b981';
                ctx.fillRect(x + (barWidth / 3) * 2, chartHeight + 20 - reviewHeight, barWidth / 3 - 2, reviewHeight);
                
                // Â∫óËàóÂêç„É©„Éô„É´
                ctx.fillStyle = '#374151';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.save();
                ctx.translate(x + barWidth / 2, chartHeight + 40);
                ctx.rotate(-Math.PI / 4);
                ctx.fillText(result.store.name, 0, 0);
                ctx.restore();
            });
            
            // YËª∏„É©„Éô„É´
            ctx.fillStyle = '#374151';
            ctx.font = '12px Arial';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 4; i++) {
                const y = chartHeight + 20 - (i / 4) * chartHeight;
                ctx.fillText(`${i * 25}%`, 55, y + 3);
            }
            
            // Âá°‰æã
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillStyle = '#3b82f6';
            ctx.fillRect(chartWidth - 150, 30, 12, 12);
            ctx.fillStyle = '#374151';
            ctx.fillText('Â£≤‰∏ä', chartWidth - 130, 41);
            
            ctx.fillStyle = '#8b5cf6';
            ctx.fillRect(chartWidth - 150, 50, 12, 12);
            ctx.fillStyle = '#374151';
            ctx.fillText('ÂÜô„É°Êó•Ë®ò', chartWidth - 130, 61);
            
            ctx.fillStyle = '#10b981';
            ctx.fillRect(chartWidth - 150, 70, 12, 12);
            ctx.fillStyle = '#374151';
            ctx.fillText('Âè£„Ç≥„Éü', chartWidth - 130, 81);
        }

        function generateGoalActionPlan(storeResults) {
            const container = document.getElementById('goalActionPlan');
            if (!container) return;
            
            const plans = [];
            
            // ‰ΩéÈÅîÊàêÁéáÂ∫óËàó„Å∏„ÅÆÊèêÊ°à
            const lowPerformers = storeResults.filter(result => result.overallProgress < 80);
            lowPerformers.forEach(result => {
                plans.push({
                    type: 'warning',
                    title: `${result.store.name} - ÁõÆÊ®ôÈÅîÊàêÁéáÂêë‰∏ä„ÅåÂøÖË¶Å`,
                    description: `ÁèæÂú®${Math.round(result.overallProgress)}%„ÄÇ80%‰ª•‰∏ä„ÇíÁõÆÊåá„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,
                    actions: [
                        result.salesProgress < 80 ? 'Â£≤‰∏äÂêë‰∏äÊñΩÁ≠ñ„ÅÆÂÆüÊñΩ' : null,
                        result.diaryProgress < 80 ? 'ÂÜô„É°Êó•Ë®òÊäïÁ®øÂ¢óÂä†ÊñΩÁ≠ñ' : null,
                        result.reviewsProgress < 80 ? 'Âè£„Ç≥„ÉüÁç≤ÂæóÂº∑Âåñ' : null
                    ].filter(Boolean)
                });
            });
            
            // È´òÈÅîÊàêÁéáÂ∫óËàó„ÅÆÁß∞Ë≥õ
            const topPerformers = storeResults.filter(result => result.overallProgress >= 100);
            if (topPerformers.length > 0) {
                plans.push({
                    type: 'success',
                    title: 'ÁõÆÊ®ôÈÅîÊàê„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ',
                    description: `${topPerformers.map(r => r.store.name).join('„ÄÅ')}„ÅåÁõÆÊ®ô„ÇíÈÅîÊàê„Åó„Åæ„Åó„Åü„ÄÇ`,
                    actions: [
                        'ÊàêÂäüË¶ÅÂõ†„ÅÆÂàÜÊûê„Å®ÊñáÊõ∏Âåñ',
                        '‰ªñÂ∫óËàó„Å∏„ÅÆÊàêÂäü‰∫ã‰æãÂÖ±Êúâ',
                        'Ê¨°ÊúàÁõÆÊ®ô„ÅÆ‰∏äÊñπ‰øÆÊ≠£Ê§úË®é'
                    ]
                });
            }
            
            // ÂÖ®‰ΩìÁöÑ„Å™ÊîπÂñÑÊèêÊ°à
            const avgProgress = storeResults.reduce((sum, result) => sum + result.overallProgress, 0) / storeResults.length;
            if (avgProgress < 90) {
                plans.push({
                    type: 'info',
                    title: 'ÂÖ®‰ΩìÁöÑ„Å™ÁõÆÊ®ôÈÅîÊàêÁéáÂêë‰∏äÊñΩÁ≠ñ',
                    description: `ÂÖ®‰ΩìÂπ≥Âùá${Math.round(avgProgress)}%„ÄÇÁµÑÁπîÂÖ®‰Ωì„Åß„ÅÆÂèñ„ÇäÁµÑ„Åø„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`,
                    actions: [
                        'ÊúàÊ¨°ÁõÆÊ®ô„ÅÆË¶ãÁõ¥„ÅóÔºàÁèæÂÆüÁöÑ„Å™Ë®≠ÂÆöÔºâ',
                        'Â∫óËàóÈñì„Åß„ÅÆÊÉÖÂ†±ÂÖ±ÊúâÂº∑Âåñ',
                        '„Ç§„É≥„Çª„É≥„ÉÜ„Ç£„ÉñÂà∂Â∫¶„ÅÆÊ§úË®é',
                        'ÂÆöÊúüÁöÑ„Å™ÈÄ≤ÊçóÁ¢∫Ë™ç‰ºöË≠∞„ÅÆÂÆüÊñΩ'
                    ]
                });
            }
            
            container.innerHTML = plans.map(plan => `
                <div class="border border-${getActionPlanColor(plan.type)}-200 bg-${getActionPlanColor(plan.type)}-50 rounded-lg p-4">
                    <div class="flex items-start">
                        <i class="fas fa-${getActionPlanIcon(plan.type)} text-${getActionPlanColor(plan.type)}-600 mr-3 mt-1"></i>
                        <div class="flex-1">
                            <h6 class="font-medium text-${getActionPlanColor(plan.type)}-800 mb-2">${plan.title}</h6>
                            <p class="text-sm text-gray-700 mb-3">${plan.description}</p>
                            <ul class="text-sm text-gray-600 space-y-1">
                                ${plan.actions.map(action => `<li class="flex items-center"><i class="fas fa-arrow-right text-xs mr-2"></i>${action}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function generateGoalReport() {
            const month = document.getElementById('goalMonth').value;
            const goals = JSON.parse(localStorage.getItem(STORAGE_KEYS.goals) || '{}');
            const monthGoals = goals[month] || {};
            const salesData = JSON.parse(localStorage.getItem(STORAGE_KEYS.salesData) || '[]');
            
            const reportData = {
                ÂØæË±°Êúà: month,
                ÁîüÊàêÊó•ÊôÇ: new Date().toLocaleString('ja-JP'),
                Â∫óËàóÂà•ÁõÆÊ®ôÈÅîÊàêÁä∂Ê≥Å: {}
            };
            
            STORES.forEach(store => {
                const storeGoals = monthGoals[store.id] || {};
                const currentSales = calculateCurrentSales(salesData, store.id, month);
                const currentDiary = calculateCurrentDiary(salesData, store.id, month);
                const currentReviews = calculateCurrentReviews(salesData, store.id, month);
                
                reportData.Â∫óËàóÂà•ÁõÆÊ®ôÈÅîÊàêÁä∂Ê≥Å[store.name] = {
                    Â£≤‰∏ä: {
                        ÁõÆÊ®ô: storeGoals.sales || 0,
                        ÂÆüÁ∏æ: currentSales,
                        ÈÅîÊàêÁéá: storeGoals.sales > 0 ? Math.round((currentSales / storeGoals.sales) * 100) : 0
                    },
                    ÂÜô„É°Êó•Ë®ò: {
                        ÁõÆÊ®ô: storeGoals.diary || 0,
                        ÂÆüÁ∏æ: currentDiary,
                        ÈÅîÊàêÁéá: storeGoals.diary > 0 ? Math.round((currentDiary / storeGoals.diary) * 100) : 0
                    },
                    Âè£„Ç≥„Éü: {
                        ÁõÆÊ®ô: storeGoals.review || 0,
                        ÂÆüÁ∏æ: currentReviews,
                        ÈÅîÊàêÁéá: storeGoals.review > 0 ? Math.round((currentReviews / storeGoals.review) * 100) : 0
                    }
                };
            });
            
            const reportText = JSON.stringify(reportData, null, 2);
            const blob = new Blob([reportText], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ÁõÆÊ®ôÁÆ°ÁêÜ„É¨„Éù„Éº„Éà_${month}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('ÁõÆÊ®ôÁÆ°ÁêÜ„É¨„Éù„Éº„Éà„ÇíÁîüÊàê„Åó„Åæ„Åó„Åü', 'success');
        }

        function calculateCurrentSales(salesData, storeId, month) {
            const storeName = STORES.find(s => s.id === storeId)?.name || storeId;
            
            // Â∫óËàóÂêç„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞ÔºàExcelÂÜÖ„ÅÆË°®Ë®ò„Å®Áµ±‰∏ÄÔºâ
            const storeMapping = {
                'classy_tokyo': 'CLASSYÊù±‰∫¨',
                'classy_nagoya': 'CLASSYÂêçÂè§Â±ã', 
                'classy_yokkaichi': 'CLASSYÂõõÊó•Â∏Ç',
                'grandopera_tokyo': 'GrandOperaÊù±‰∫¨',
                'grandopera_yokohama': 'GrandOperaÊ®™Êµú',
                'grandopera_nagoya': 'GrandOperaÂêçÂè§Â±ã',
                'grandopera_fukuoka': 'GrandOperaÁ¶èÂ≤°',
                'wancarat': '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà',
                'shabour': '„Ç∑„É£„Éñ„Éº„É´',
                'opera_nishiki': '„Ç™„Éö„É©Èå¶'
            };
            
            const targetStoreName = storeMapping[storeId] || storeName;
            
            return salesData
                .filter(row => {
                    const date = row['Êó•‰ªò'] || row['date'] || row.Êó•‰ªò || '';
                    const store = row['Â∫óËàóÂêç'] || row['Â∫óËàó'] || row['store'] || row.Â∫óËàó || '';
                    return date.includes(month) && store === targetStoreName;
                })
                .reduce((sum, row) => {
                    const sales = parseFloat(row['Â£≤‰∏ä'] || row['sales'] || row.Â£≤‰∏ä || '0');
                    return sum + sales;
                }, 0);
        }

        function calculateCurrentDiary(salesData, storeId, month) {
            const storeMapping = {
                'classy_tokyo': 'CLASSYÊù±‰∫¨',
                'classy_nagoya': 'CLASSYÂêçÂè§Â±ã', 
                'classy_yokkaichi': 'CLASSYÂõõÊó•Â∏Ç',
                'grandopera_tokyo': 'GrandOperaÊù±‰∫¨',
                'grandopera_yokohama': 'GrandOperaÊ®™Êµú',
                'grandopera_nagoya': 'GrandOperaÂêçÂè§Â±ã',
                'grandopera_fukuoka': 'GrandOperaÁ¶èÂ≤°',
                'wancarat': '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà',
                'shabour': '„Ç∑„É£„Éñ„Éº„É´',
                'opera_nishiki': '„Ç™„Éö„É©Èå¶'
            };
            
            const targetStoreName = storeMapping[storeId];
            const storeData = salesData.filter(row => {
                const date = row['Êó•‰ªò'] || row['date'] || row.Êó•‰ªò || '';
                const store = row['Â∫óËàóÂêç'] || row['Â∫óËàó'] || row['store'] || row.Â∫óËàó || '';
                return date.includes(month) && store === targetStoreName;
            });
            
            if (storeData.length === 0) return 0;
            
            const totalDiary = storeData.reduce((sum, row) => {
                const diary = parseInt(row['ÂÜô„É°Êó•Ë®ò'] || row['diary'] || row.ÂÜô„É°Êó•Ë®ò || '0');
                return sum + diary;
            }, 0);
            
            // ÊúàÂêàË®à„ÇíËøî„Åô
            return totalDiary;
        }

        function calculateCurrentReviews(salesData, storeId, month) {
            const storeMapping = {
                'classy_tokyo': 'CLASSYÊù±‰∫¨',
                'classy_nagoya': 'CLASSYÂêçÂè§Â±ã', 
                'classy_yokkaichi': 'CLASSYÂõõÊó•Â∏Ç',
                'grandopera_tokyo': 'GrandOperaÊù±‰∫¨',
                'grandopera_yokohama': 'GrandOperaÊ®™Êµú',
                'grandopera_nagoya': 'GrandOperaÂêçÂè§Â±ã',
                'grandopera_fukuoka': 'GrandOperaÁ¶èÂ≤°',
                'wancarat': '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà',
                'shabour': '„Ç∑„É£„Éñ„Éº„É´',
                'opera_nishiki': '„Ç™„Éö„É©Èå¶'
            };
            
            const targetStoreName = storeMapping[storeId];
            const storeData = salesData.filter(row => {
                const date = row['Êó•‰ªò'] || row['date'] || row.Êó•‰ªò || '';
                const store = row['Â∫óËàóÂêç'] || row['Â∫óËàó'] || row['store'] || row.Â∫óËàó || '';
                return date.includes(month) && store === targetStoreName;
            });
            
            if (storeData.length === 0) return 0;
            
            const totalReviews = storeData.reduce((sum, row) => {
                const reviews = parseInt(row['Âè£„Ç≥„Éü'] || row['reviews'] || row.Âè£„Ç≥„Éü || '0');
                return sum + reviews;
            }, 0);
            
            // ÊúàÂêàË®à„ÇíËøî„Åô
            return totalReviews;
        }

        // ÂÖ±ÈÄöÈñ¢Êï∞
        function getActionPlanColor(type) {
            const colors = {
                'warning': 'yellow',
                'info': 'blue',
                'success': 'green'
            };
            return colors[type] || 'gray';
        }

        function getActionPlanIcon(type) {
            const icons = {
                'warning': 'exclamation-triangle',
                'info': 'info-circle',
                'success': 'check-circle'
            };
            return icons[type] || 'info-circle';
        }

        // „Éó„É≠„É≥„Éó„ÉàÁÆ°ÁêÜ
        function loadPrompts() {
            const prompts = JSON.parse(localStorage.getItem(STORAGE_KEYS.prompts) || '[]');
            const promptList = document.getElementById('promptList');
            if (!promptList) return;
            
            const filteredPrompts = currentPromptCategory === 'all' ? 
                prompts : 
                prompts.filter(p => p.category === currentPromptCategory);
            
            if (filteredPrompts.length === 0) {
                promptList.innerHTML = '<div class="text-center py-4 text-gray-500">„Éó„É≠„É≥„Éó„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }
            
            promptList.innerHTML = filteredPrompts.map((prompt, index) => {
                const originalIndex = prompts.findIndex(p => p.id === prompt.id);
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <button onclick="copyPrompt('${prompt.text.replace(/'/g, "\\'")}', '${prompt.label}')" 
                                class="btn btn-primary flex-1 mr-3 text-sm">
                            <i class="fas fa-copy mr-2"></i>${prompt.label}
                        </button>
                        <span class="text-xs text-gray-500 px-2 py-1 bg-white rounded mr-2">
                            ${getPromptCategoryLabel(prompt.category)}
                        </span>
                        <button onclick="deletePrompt(${originalIndex})" 
                                class="text-red-500 hover:text-red-700 p-1">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                `;
            }).join('');
        }

        function switchPromptCategory(category) {
            currentPromptCategory = category;
            document.querySelectorAll('#promptCategoryTabs .nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            loadPrompts();
        }

        function addPrompt() {
            const category = document.getElementById('newPromptCategory').value;
            const label = document.getElementById('newPromptLabel').value.trim();
            const text = document.getElementById('newPromptText').value.trim();
            
            if (!label || !text) {
                showNotification('„Éú„Çø„É≥Âêç„Å®„Éó„É≠„É≥„Éó„ÉàÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            const prompts = JSON.parse(localStorage.getItem(STORAGE_KEYS.prompts) || '[]');
            const newPrompt = {
                id: Date.now(),
                label,
                text,
                category,
                createdAt: new Date().toISOString()
            };
            
            prompts.push(newPrompt);
            localStorage.setItem(STORAGE_KEYS.prompts, JSON.stringify(prompts));
            
            // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢
            document.getElementById('newPromptLabel').value = '';
            document.getElementById('newPromptText').value = '';
            
            loadPrompts();
            showNotification('„Éó„É≠„É≥„Éó„Éà„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü', 'success');
        }

        function deletePrompt(index) {
            if (confirm('„Åì„ÅÆ„Éó„É≠„É≥„Éó„Éà„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                const prompts = JSON.parse(localStorage.getItem(STORAGE_KEYS.prompts) || '[]');
                prompts.splice(index, 1);
                localStorage.setItem(STORAGE_KEYS.prompts, JSON.stringify(prompts));
                loadPrompts();
                showNotification('„Éó„É≠„É≥„Éó„Éà„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'info');
            }
        }

        function copyPrompt(text, label) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification(`„Äå${label}„Äç„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`, 'success');
            }).catch(() => {
                showNotification('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            });
        }

        function getPromptCategoryLabel(category) {
            const labels = {
                'line': 'LINE',
                'sns': 'SNS',
                'report': 'Â†±Âëä',
                'design': '„Éá„Ç∂„Ç§„É≥',
                'other': '„Åù„ÅÆ‰ªñ'
            };
            return labels[category] || '„Åù„ÅÆ‰ªñ';
        }

        // „É°„É¢ÁÆ°ÁêÜ
        function getMemoKey(date = null) {
            const today = date || new Date().toISOString().split('T')[0];
            return STORAGE_KEYS.memos + today;
        }

        function loadMemo() {
            const today = new Date().toISOString().split('T')[0];
            const memoKey = getMemoKey(today);
            const savedMemo = localStorage.getItem(memoKey) || '';
            const memoArea = document.getElementById('memoArea');
            const memoSaveDate = document.getElementById('memoSaveDate');
            
            if (memoArea) memoArea.value = savedMemo;
            if (memoSaveDate) {
                memoSaveDate.textContent = '‰ªäÊó• ' + new Date().toLocaleTimeString('ja-JP', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            }
        }

        function saveMemo() {
            const selectedDate = document.getElementById('memoDateSelector').value;
            const today = selectedDate || new Date().toISOString().split('T')[0];
            const memoKey = getMemoKey(today);
            const memoArea = document.getElementById('memoArea');
            
            if (memoArea) {
                const memoText = memoArea.value;
                localStorage.setItem(memoKey, memoText);
                updateMemoDateSelector();
            }
        }

        function clearMemo() {
            if (confirm('ÁèæÂú®„ÅÆ„É°„É¢„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü')) {
                const memoArea = document.getElementById('memoArea');
                if (memoArea) {
                    memoArea.value = '';
                    saveMemo();
                    showNotification('„É°„É¢„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü', 'info');
                }
            }
        }

        function updateMemoDateSelector() {
            const selector = document.getElementById('memoDateSelector');
            if (!selector) return;
            
            selector.innerHTML = '<option value="">‰ªäÊó•„ÅÆ„É°„É¢</option>';
            
            const dates = [];
            for (let i = 1; i < 30; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const memoKey = getMemoKey(dateStr);
                if (localStorage.getItem(memoKey)) {
                    dates.push({
                        value: dateStr,
                        label: date.toLocaleDateString('ja-JP', { 
                            month: 'numeric', 
                            day: 'numeric', 
                            weekday: 'short' 
                        })
                    });
                }
            }
            
            dates.forEach(date => {
                const option = document.createElement('option');
                option.value = date.value;
                option.textContent = date.label;
                selector.appendChild(option);
            });
        }

        function loadSelectedMemo() {
            const selector = document.getElementById('memoDateSelector');
            const selectedDate = selector.value;
            
            if (selectedDate) {
                const memoKey = getMemoKey(selectedDate);
                const savedMemo = localStorage.getItem(memoKey) || '';
                const memoArea = document.getElementById('memoArea');
                const memoSaveDate = document.getElementById('memoSaveDate');
                
                if (memoArea) memoArea.value = savedMemo;
                if (memoSaveDate) {
                    memoSaveDate.textContent = new Date(selectedDate).toLocaleDateString('ja-JP', { 
                        month: 'numeric', 
                        day: 'numeric', 
                        weekday: 'short' 
                    });
                }
            } else {
                loadMemo();
            }
        }

        // ÈÄöÁü•„Éª„Ç¢„É©„Éº„Éà„Ç∑„Çπ„ÉÜ„É†
        function checkAlerts() {
            const tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]');
            const events = JSON.parse(localStorage.getItem(STORAGE_KEYS.events) || '[]');
            const designProjects = JSON.parse(localStorage.getItem(STORAGE_KEYS.designProjects) || '[]');
            
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            // ÊúüÈôêÂàá„Çå„Çø„Çπ„ÇØ
            const overdueTasks = tasks.filter(task => 
                !task.completed && task.dueDate && new Date(task.dueDate) < today
            );
            
            // ‰ªäÊó•ÊúüÈôê„ÅÆ„Çø„Çπ„ÇØ
            const dueTodayTasks = tasks.filter(task => 
                !task.completed && task.dueDate && 
                new Date(task.dueDate).toDateString() === today.toDateString()
            );
            
            // ÊòéÊó•ÊúüÈôê„ÅÆ„Çø„Çπ„ÇØ
            const dueTomorrowTasks = tasks.filter(task => 
                !task.completed && task.dueDate && 
                new Date(task.dueDate).toDateString() === tomorrow.toDateString()
            );
            
            // ‰ªäÊó•„ÅÆ‰∫àÂÆö
            const todayEvents = events.filter(event => 
                event.date === today.toISOString().split('T')[0]
            );
            
            // „Éá„Ç∂„Ç§„É≥Ê°à‰ª∂„ÅÆÁ∑äÊÄ•„Ç¢„É©„Éº„Éà
            const urgentDesign = designProjects.filter(project => {
                if (!project.dueDate || project.status === 'completed') return false;
                const dueDate = new Date(project.dueDate);
                const daysUntilDue = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                return daysUntilDue <= 2 && daysUntilDue >= 0;
            });
            
            // ÈÄöÁü•„ÅÆËøΩÂä†
            if (overdueTasks.length > 0) {
                addNotification(`ÊúüÈôêÂàá„Çå„Çø„Çπ„ÇØ„Åå${overdueTasks.length}‰ª∂„ÅÇ„Çä„Åæ„Åô`, 'urgent');
            }
            
            if (dueTodayTasks.length > 0) {
                addNotification(`‰ªäÊó•ÊúüÈôê„ÅÆ„Çø„Çπ„ÇØ„Åå${dueTodayTasks.length}‰ª∂„ÅÇ„Çä„Åæ„Åô`, 'warning');
            }
            
            if (dueTomorrowTasks.length > 0) {
                addNotification(`ÊòéÊó•ÊúüÈôê„ÅÆ„Çø„Çπ„ÇØ„Åå${dueTomorrowTasks.length}‰ª∂„ÅÇ„Çä„Åæ„Åô`, 'info');
            }
            
            if (todayEvents.length > 0) {
                addNotification(`‰ªäÊó•„ÅÆ‰∫àÂÆö„Åå${todayEvents.length}‰ª∂„ÅÇ„Çä„Åæ„Åô`, 'info');
            }
            
            if (urgentDesign.length > 0) {
                addNotification(`Á∑äÊÄ•„Éá„Ç∂„Ç§„É≥Ê°à‰ª∂„Åå${urgentDesign.length}‰ª∂„ÅÇ„Çä„Åæ„Åô`, 'urgent');
            }
            
            updateNotificationCount();
        }

        function addNotification(message, type = 'info') {
            const notification = {
                id: Date.now(),
                message,
                type,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            notifications.push(notification);
            
            // ÊúÄÂ§ß100‰ª∂„Åæ„Åß‰øùÊåÅ
            if (notifications.length > 100) {
                notifications = notifications.slice(-100);
            }
            
            updateNotificationCount();
        }

        function updateNotificationCount() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const countElement = document.getElementById('notificationCount');
            if (countElement) {
                countElement.textContent = unreadCount;
                countElement.style.display = unreadCount > 0 ? 'inline' : 'none';
            }
        }

        function showNotifications() {
            const modal = document.getElementById('notificationModal');
            const list = document.getElementById('notificationList');
            
            if (notifications.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-4">ÈÄöÁü•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
            } else {
                list.innerHTML = notifications.slice(-20).reverse().map(notification => `
                    <div class="p-3 border rounded-lg ${notification.read ? 'bg-gray-50' : 'bg-blue-50 border-blue-200'}">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="text-sm ${getNotificationIcon(notification.type)} mr-2">
                                    ${notification.message}
                                </div>
                                <div class="text-xs text-gray-500 mt-1">
                                    ${new Date(notification.timestamp).toLocaleString('ja-JP')}
                                </div>
                            </div>
                            <button onclick="markAsRead(${notification.id})" 
                                    class="text-gray-400 hover:text-gray-600 ml-2">
                                <i class="fas fa-check"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            modal.classList.add('show');
        }

        function getNotificationIcon(type) {
            const icons = {
                'urgent': 'üî¥',
                'warning': 'üü°',
                'info': 'üîµ',
                'success': 'üü¢'
            };
            return icons[type] || 'üîµ';
        }

        function markAsRead(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                updateNotificationCount();
                showNotifications(); // „É™„Éï„É¨„ÉÉ„Ç∑„É•
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // „Éá„Éº„ÇøÁÆ°ÁêÜ
        function exportAllData() {
            const data = {
                exportDate: new Date().toISOString(),
                version: '4.0',
                tasks: JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]'),
                events: JSON.parse(localStorage.getItem(STORAGE_KEYS.events) || '[]'),
                prompts: JSON.parse(localStorage.getItem(STORAGE_KEYS.prompts) || '[]'),
                designProjects: JSON.parse(localStorage.getItem(STORAGE_KEYS.designProjects) || '[]'),
                goals: JSON.parse(localStorage.getItem(STORAGE_KEYS.goals) || '{}'),
                salesData: JSON.parse(localStorage.getItem(STORAGE_KEYS.salesData) || '[]'),
                memos: {}
            };
            
            // „É°„É¢„Éá„Éº„Çø„ÅÆÂèéÈõÜ
            for (let i = 0; i < 30; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const memoKey = getMemoKey(dateStr);
                const memo = localStorage.getItem(memoKey);
                if (memo) {
                    data.memos[dateStr] = memo;
                }
            }
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Rispondere_ÂÖ®„Éá„Éº„Çø_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('ÂÖ®„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü', 'success');
        }

        function importAllData() {
            document.getElementById('importFileInput').click();
        }

        function handleDataImport(event) {
            const file = event.target.files[0];
            if (!file || !file.name.endsWith('.json')) {
                showNotification('JSON„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åô„ÅãÔºü\nÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ')) {
                        // „Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ
                        if (data.tasks) localStorage.setItem(STORAGE_KEYS.tasks, JSON.stringify(data.tasks));
                        if (data.events) localStorage.setItem(STORAGE_KEYS.events, JSON.stringify(data.events));
                        if (data.prompts) localStorage.setItem(STORAGE_KEYS.prompts, JSON.stringify(data.prompts));
                        if (data.designProjects) localStorage.setItem(STORAGE_KEYS.designProjects, JSON.stringify(data.designProjects));
                        if (data.goals) localStorage.setItem(STORAGE_KEYS.goals, JSON.stringify(data.goals));
                        if (data.salesData) localStorage.setItem(STORAGE_KEYS.salesData, JSON.stringify(data.salesData));
                        
                        // „É°„É¢„Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ
                        if (data.memos) {
                            Object.keys(data.memos).forEach(date => {
                                localStorage.setItem(getMemoKey(date), data.memos[date]);
                            });
                        }
                        
                        // UIÊõ¥Êñ∞
                        loadAllData();
                        updateAllStats();
                        showNotification('„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü', 'success');
                    }
                } catch (error) {
                    showNotification('„Éï„Ç°„Ç§„É´ÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì', 'error');
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è „Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                if (confirm('Êú¨ÂΩì„Å´„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü„Åô„Åπ„Å¶„ÅÆ„Çø„Çπ„ÇØ„ÄÅ‰∫àÂÆö„ÄÅ„É°„É¢„ÅåÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ')) {
                    // ÂÖ®„Éá„Éº„Çø„ÇØ„É™„Ç¢
                    Object.values(STORAGE_KEYS).forEach(key => {
                        if (key.includes('memos_')) {
                            // „É°„É¢„ÅØÂÄãÂà•„Å´ÂâäÈô§
                            for (let i = 0; i < 30; i++) {
                                const date = new Date();
                                date.setDate(date.getDate() - i);
                                const dateStr = date.toISOString().split('T')[0];
                                localStorage.removeItem(getMemoKey(dateStr));
                            }
                        } else {
                            localStorage.removeItem(key);
                        }
                    });
                    
                    // UIÊõ¥Êñ∞
                    loadAllData();
                    updateAllStats();
                    notifications = [];
                    updateNotificationCount();
                    
                    showNotification('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'info');
                }
            }
        }

        function generateReport() {
            const tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]');
            const events = JSON.parse(localStorage.getItem(STORAGE_KEYS.events) || '[]');
            const designProjects = JSON.parse(localStorage.getItem(STORAGE_KEYS.designProjects) || '[]');
            const salesData = JSON.parse(localStorage.getItem(STORAGE_KEYS.salesData) || '[]');
            
            const today = new Date();
            const reportData = {
                ÁîüÊàêÊó•ÊôÇ: today.toLocaleString('ja-JP'),
                „Çø„Çπ„ÇØÁµ±Ë®à: {
                    Á∑èÊï∞: tasks.length,
                    ÂÆå‰∫Ü: tasks.filter(t => t.completed).length,
                    Á∑äÊÄ•: tasks.filter(t => t.priority === 'urgent' && !t.completed).length,
                    ÊúüÈôêÂàá„Çå: tasks.filter(t => !t.completed && t.dueDate && new Date(t.dueDate) < today).length
                },
                ‰∫àÂÆöÁµ±Ë®à: {
                    Á∑èÊï∞: events.length,
                    ‰ªäÊúà: events.filter(e => e.date && e.date.includes(today.toISOString().substr(0, 7))).length
                },
                „Éá„Ç∂„Ç§„É≥Ê°à‰ª∂Áµ±Ë®à: {
                    Á∑èÊï∞: designProjects.length,
                    ‰ºÅÁîª‰∏≠: designProjects.filter(p => p.status === 'planning').length,
                    „Éá„Ç∂„Ç§„É≥‰∏≠: designProjects.filter(p => p.status === 'designing').length,
                    „É¨„Éì„É•„Éº‰∏≠: designProjects.filter(p => p.status === 'review').length,
                    ÂÆå‰∫Ü: designProjects.filter(p => p.status === 'completed').length
                },
                Â£≤‰∏ä„Éá„Éº„Çø: {
                    „Éá„Éº„Çø‰ª∂Êï∞: salesData.length,
                    ÊúÄÁµÇÊõ¥Êñ∞: salesData.length > 0 ? 'Âà©Áî®ÂèØËÉΩ' : 'Êú™ÁôªÈå≤'
                }
            };
            
            const reportText = JSON.stringify(reportData, null, 2);
            const blob = new Blob([reportText], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Rispondere_„É¨„Éù„Éº„Éà_${today.toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('„É¨„Éù„Éº„Éà„ÇíÁîüÊàê„Åó„Åæ„Åó„Åü', 'success');
        }

        // ÈÄöÁü•„Ç∑„Çπ„ÉÜ„É†
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${getNotificationIconClass(type)} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function getNotificationIconClass(type) {
            const icons = {
                'success': 'check-circle',
                'error': 'exclamation-triangle',
                'warning': 'exclamation-circle',
                'info': 'info-circle'
            };
            return icons[type] || 'info-circle';
        }

        // 2Êó•„ÅÆÁõÆÊ®ôË®≠ÂÆö„É™„Éû„Ç§„É≥„ÉÄ„Éº
        function checkGoalSettingReminder() {
            const today = new Date();
            if (today.getDate() === 2) {
                addNotification('‰ªäÊó•„ÅØÊúàÊ¨°ÁõÆÊ®ôË®≠ÂÆöÊó•„Åß„Åô', 'warning');
                
                // ÁõÆÊ®ôË®≠ÂÆö„Çø„Éñ„Å∏„ÅÆË™òÂ∞é
                setTimeout(() => {
                    if (confirm('‰ªäÊó•„ÅØÊúàÊ¨°ÁõÆÊ®ôË®≠ÂÆöÊó•„Åß„Åô„ÄÇÁõÆÊ®ôÁÆ°ÁêÜ„Çø„Éñ„ÇíÈñã„Åç„Åæ„Åô„ÅãÔºü')) {
                        switchTab('goals');
                    }
                }, 5000);
            }
        }

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÂØæÂøú„ÅÆËøΩÂä†
        function setupSalesUploadDragDrop() {
            const uploadArea = document.getElementById('salesUploadArea');
            if (!uploadArea) return;
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            uploadArea.addEventListener('dragenter', (e) => {
                uploadArea.classList.add('border-blue-400', 'bg-blue-50');
            });
            
            uploadArea.addEventListener('dragleave', (e) => {
                if (!uploadArea.contains(e.relatedTarget)) {
                    uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
                }
            });
            
            uploadArea.addEventListener('dragover', (e) => {
                uploadArea.classList.add('border-blue-400', 'bg-blue-50');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        handleExcelUpload(file);
                    } else if (file.name.endsWith('.csv')) {
                        handleCSVUpload(file);
                    } else {
                        showNotification('Excel(.xlsx)„Åæ„Åü„ÅØCSV(.csv)„Éï„Ç°„Ç§„É´„Çí„Éâ„É≠„ÉÉ„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                    }
                }
            });
        }

        // „Çª„ÉÉ„Ç∑„Éß„É≥Êã°ÂºµÊ©üËÉΩ„ÅÆÊîπËâØ
        function extendSession() {
            if (sessionStorage.getItem('isLoggedIn')) {
                sessionStorage.setItem('loginTime', Date.now().toString());
                if (sessionTimer) {
                    clearInterval(sessionTimer);
                    startSessionTimer(SESSION_DURATION);
                }
            }
        }

        // „Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£Áõ£Ë¶ñ„ÅÆÂº∑Âåñ
        function setupActivityMonitoring() {
            let lastActivity = Date.now();
            
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'].forEach(event => {
                document.addEventListener(event, () => {
                    if (sessionStorage.getItem('isLoggedIn')) {
                        const now = Date.now();
                        if (now - lastActivity > 10 * 60 * 1000) { // 10ÂàÜÈñìÈöî
                            sessionStorage.setItem('lastActivity', now.toString());
                            extendSession();
                            lastActivity = now;
                        }
                    }
                }, { passive: true });
            });
        }

        // „Éá„Éº„ÇøÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
        function validateDataIntegrity() {
            try {
                // ÂêÑ„Çπ„Éà„É¨„Éº„Ç∏„Ç≠„Éº„ÅÆ„Éá„Éº„Çø„ÇíÊ§úË®º
                Object.values(STORAGE_KEYS).forEach(key => {
                    const data = localStorage.getItem(key);
                    if (data && data !== '[]' && data !== '{}') {
                        JSON.parse(data); // JSON„Éë„Éº„Çπ„Ç®„É©„Éº„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                    }
                });
                return true;
            } catch (error) {
                console.error('Data integrity check failed:', error);
                showNotification('„Éá„Éº„Çø„ÅÆÊï¥ÂêàÊÄß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
                return false;
            }
        }

        // Ëá™Âãï„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÊ©üËÉΩ
        function performAutoBackup() {
            try {
                const backupData = {
                    timestamp: new Date().toISOString(),
                    tasks: localStorage.getItem(STORAGE_KEYS.tasks),
                    events: localStorage.getItem(STORAGE_KEYS.events),
                    goals: localStorage.getItem(STORAGE_KEYS.goals),
                    salesData: localStorage.getItem(STORAGE_KEYS.salesData)
                };
                
                localStorage.setItem('autoBackup', JSON.stringify(backupData));
                console.log('Auto backup completed');
            } catch (error) {
                console.error('Auto backup failed:', error);
            }
        }

        // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÅÆÂº∑Âåñ
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            showNotification('„Ç∑„Çπ„ÉÜ„É†„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            showNotification('Âá¶ÁêÜ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
        });

        // ÂÆöÊúüÂÆüË°å„Çø„Çπ„ÇØ
        setInterval(() => {
            if (sessionStorage.getItem('isLoggedIn')) {
                checkAlerts();
                checkGoalSettingReminder();
                validateDataIntegrity();
                performAutoBackup();
            }
        }, 30 * 60 * 1000); // 30ÂàÜ„Åî„Å®

        // ÂàùÊúüÂåñÂÆå‰∫ÜÂæå„ÅÆÂá¶ÁêÜ
        document.addEventListener('DOMContentLoaded', () => {
            setupActivityMonitoring();
            setTimeout(() => {
                if (document.getElementById('salesUploadArea')) {
                    setupSalesUploadDragDrop();
                }
            }, 1000);
        });

        // „Éö„Éº„Ç∏„ÅÆÂèØË¶ñÊÄßÂ§âÊõ¥ÊôÇ„ÅÆÂá¶ÁêÜ
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && sessionStorage.getItem('isLoggedIn')) {
                // „Éö„Éº„Ç∏„ÅåÂÜçË°®Á§∫„Åï„Çå„Åü„Å®„Åç„ÅÆ„Éá„Éº„ÇøÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
                setTimeout(validateDataIntegrity, 1000);
            }
        });

        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÅÆÂ§âÊõ¥Áõ£Ë¶ñ
        window.addEventListener('storage', (e) => {
            if (e.key && Object.values(STORAGE_KEYS).includes(e.key)) {
                // ‰ªñ„ÅÆ„Çø„Éñ„Åß„Éá„Éº„Çø„ÅåÂ§âÊõ¥„Åï„Çå„ÅüÂ†¥Âêà„ÅÆÂá¶ÁêÜ
                if (currentTab === 'dashboard') {
                    updateAllStats();
                }
            }
        });

        // PWAÂØæÂøú„ÅÆÂü∫Êú¨Ë®≠ÂÆö
        if ('serviceWorker' in navigator) {
            // Service Worker„ÅØÂÆüË£Ö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åå„ÄÅÂ∞ÜÊù•„ÅÆÊã°Âºµ„ÅÆ„Åü„ÇÅ„ÅÆÊ∫ñÂÇô
            console.log('Service Worker support detected');
        }

        // „Ç™„Éï„É©„Ç§„É≥ÂØæÂøú„ÅÆÂü∫Êú¨Ê§úÁü•
        window.addEventListener('online', () => {
            showNotification('„Ç™„É≥„É©„Ç§„É≥„Å´Âæ©Â∏∞„Åó„Åæ„Åó„Åü', 'success');
        });

        window.addEventListener('offline', () => {
            showNotification('„Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ„Åß„Åô„ÄÇ‰∏ÄÈÉ®Ê©üËÉΩ„ÅåÂà∂Èôê„Åï„Çå„Åæ„Åô', 'warning');
        });

        // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñ
        function monitorPerformance() {
            if ('performance' in window) {
                setTimeout(() => {
                    const navigation = performance.getEntriesByType('navigation')[0];
                    if (navigation && navigation.loadEventEnd > 5000) {
                        console.warn('Slow page load detected:', navigation.loadEventEnd);
                    }
                }, 5000);
            }
        }

        // „É°„É¢„É™‰ΩøÁî®Èáè„ÅÆÁõ£Ë¶ñÔºàÂèØËÉΩ„Å™Â†¥ÂêàÔºâ
        function checkMemoryUsage() {
            if ('memory' in performance) {
                const memInfo = performance.memory;
                const usedMB = Math.round(memInfo.usedJSHeapSize / 1048576);
                if (usedMB > 100) { // 100MB‰ª•‰∏ä„ÅÆÂ†¥ÂêàË≠¶Âëä
                    console.warn('High memory usage detected:', usedMB, 'MB');
                }
            }
        }

        // ÂÆöÊúü„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÅ„Çß„ÉÉ„ÇØ
        setInterval(() => {
            if (sessionStorage.getItem('isLoggedIn')) {
                checkMemoryUsage();
            }
        }, 5 * 60 * 1000); // 5ÂàÜ„Åî„Å®

        // ÂàùÊúü„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñ
        window.addEventListener('load', monitorPerformance);

        // „Éö„Éº„Ç∏Èñâ„Åò„ÇãÂâç„ÅÆÁ¢∫Ë™ç
        window.addEventListener('beforeunload', (e) => {
            if (sessionStorage.getItem('isLoggedIn')) {
                const message = '‰ΩúÊ•≠‰∏≠„ÅÆ„Éá„Éº„Çø„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Éö„Éº„Ç∏„ÇíÈõ¢„Çå„Åæ„Åô„ÅãÔºü';
                e.returnValue = message;
                return message;
            }
        });

        // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });
    </script>
</body>
</html>sm text-gray-600">„Çø„Çπ„ÇØÂÆå‰∫ÜÁéá</p>
                        </div>
                    </div>
                </div>

                <div class="col-span-8">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-exclamation-triangle mr-2 text-red-600"></i>Á∑äÊÄ•„ÉªÈáçË¶Å‰∫ãÈ†Ö
                        </h3>
                        <div id="urgentItems" class="space-y-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- „Çø„Çπ„ÇØÁÆ°ÁêÜ„Çø„Éñ -->
        <div id="tasksTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-8">
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-tasks mr-2 text-purple-600"></i>ÂÖ®Á§æ„Çø„Çπ„ÇØÁÆ°ÁêÜ
                            </h3>
                            <div class="flex space-x-2">
                                <select id="taskFilter" class="input-field w-40" onchange="filterTasks()">
                                    <option value="all">„Åô„Åπ„Å¶</option>
                                    <option value="urgent">Á∑äÊÄ•</option>
                                    <option value="high">ÈáçË¶Å</option>
                                    <option value="normal">ÈÄöÂ∏∏</option>
                                    <option value="completed">ÂÆå‰∫ÜÊ∏à„Åø</option>
                                </select>
                                <select id="taskStore" class="input-field w-40" onchange="filterTasks()">
                                    <option value="all">ÂÖ®Â∫óËàó</option>
                                    <option value="classy_tokyo">CLASSYÊù±‰∫¨</option>
                                    <option value="classy_nagoya">CLASSYÂêçÂè§Â±ã</option>
                                    <option value="classy_yokkaichi">CLASSYÂõõÊó•Â∏Ç</option>
                                    <option value="grandopera_tokyo">GrandOperaÊù±‰∫¨</option>
                                    <option value="grandopera_yokohama">GrandOperaÊ®™Êµú</option>
                                    <option value="grandopera_nagoya">GrandOperaÂêçÂè§Â±ã</option>
                                    <option value="grandopera_fukuoka">GrandOperaÁ¶èÂ≤°</option>
                                    <option value="wancarat">„ÉØ„É≥„Ç´„É©„ÉÉ„Éà</option>
                                    <option value="shabour">„Ç∑„É£„Éñ„Éº„É´</option>
                                    <option value="opera_nishiki">„Ç™„Éö„É©Èå¶</option>
                                    <option value="design">„Éá„Ç∂„Ç§„É≥ÈÉ®ÈñÄ</option>
                                    <option value="head_office">Êú¨Á§æ</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="taskList" class="space-y-3 mb-6 max-h-96 overflow-y-auto"></div>
                        
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíËøΩÂä†</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                <input id="newTaskTitle" type="text" class="input-field" placeholder="„Çø„Çπ„ÇØÂêç">
                                <select id="newTaskStore" class="input-field">
                                    <option value="head_office">Êú¨Á§æ</option>
                                    <option value="classy_tokyo">CLASSYÊù±‰∫¨</option>
                                    <option value="classy_nagoya">CLASSYÂêçÂè§Â±ã</option>
                                    <option value="classy_yokkaichi">CLASSYÂõõÊó•Â∏Ç</option>
                                    <option value="grandopera_tokyo">GrandOperaÊù±‰∫¨</option>
                                    <option value="grandopera_yokohama">GrandOperaÊ®™Êµú</option>
                                    <option value="grandopera_nagoya">GrandOperaÂêçÂè§Â±ã</option>
                                    <option value="grandopera_fukuoka">GrandOperaÁ¶èÂ≤°</option>
                                    <option value="wancarat">„ÉØ„É≥„Ç´„É©„ÉÉ„Éà</option>
                                    <option value="shabour">„Ç∑„É£„Éñ„Éº„É´</option>
                                    <option value="opera_nishiki">„Ç™„Éö„É©Èå¶</option>
                                    <option value="design">„Éá„Ç∂„Ç§„É≥ÈÉ®ÈñÄ</option>
                                </select>
                                <select id="newTaskPriority" class="input-field">
                                    <option value="normal">ÈÄöÂ∏∏</option>
                                    <option value="high">ÈáçË¶Å</option>
                                    <option value="urgent">Á∑äÊÄ•</option>
                                </select>
                                <input id="newTaskDue" type="date" class="input-field">
                            </div>
                            <textarea id="newTaskDescription" class="input-field mb-3" rows="2" placeholder="Ë©≥Á¥∞Ë™¨Êòé"></textarea>
                            <button onclick="addTask()" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i>„Çø„Çπ„ÇØ„ÇíËøΩÂä†
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-span-4">
                    <div class="glass-card p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-bar mr-2 text-green-600"></i>„Çø„Çπ„ÇØÁµ±Ë®à
                        </h3>
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span>ÂÆå‰∫ÜÁéá</span>
                                <span id="taskCompletionRate">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="taskProgressBar" class="bg-green-500 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-center">
                                <div>
                                    <div class="text-xl font-bold text-red-600" id="overdueCount">0</div>
                                    <div class="text-xs text-gray-600">ÊúüÈôêÂàá„Çå</div>
                                </div>
                                <div>
                                    <div class="text-xl font-bold text-yellow-600" id="dueTodayCount">0</div>
                                    <div class="text-xs text-gray-600">‰ªäÊó•ÊúüÈôê</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-bell mr-2 text-yellow-600"></i>„Ç¢„É©„Éº„ÉàË®≠ÂÆö
                        </h3>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="alertDeadline" class="mr-2" checked>
                                <span class="text-sm">ÊúüÈôêÂâçÈÄöÁü•</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="alertOverdue" class="mr-2" checked>
                                <span class="text-sm">ÊúüÈôêÂàá„ÇåÈÄöÁü•</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="alertMilestone" class="mr-2" checked>
                                <span class="text-sm">„Éû„Ç§„É´„Çπ„Éà„Éº„É≥ÈÄöÁü•</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- „Çπ„Ç±„Ç∏„É•„Éº„É´ÁÆ°ÁêÜ„Çø„Éñ -->
        <div id="scheduleTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-8">
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-calendar mr-2 text-blue-600"></i>„Ç´„É¨„É≥„ÉÄ„Éº
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="prevMonth()" class="btn btn-secondary">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span id="currentMonth" class="px-4 py-2 font-semibold"></span>
                                <button onclick="nextMonth()" class="btn btn-secondary">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div id="calendar" class="grid grid-cols-7 gap-2 mb-6"></div>
                        
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">‰∫àÂÆö„ÇíËøΩÂä†</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                <input id="newEventTitle" type="text" class="input-field" placeholder="‰∫àÂÆöÂêç">
                                <input id="newEventDate" type="date" class="input-field">
                                <input id="newEventTime" type="time" class="input-field">
                                <select id="newEventType" class="input-field">
                                    <option value="meeting">‰ºöË≠∞</option>
                                    <option value="deadline">Á∑†Âàá</option>
                                    <option value="event">„Ç§„Éô„É≥„Éà</option>
                                    <option value="reminder">„É™„Éû„Ç§„É≥„ÉÄ„Éº</option>
                                    <option value="goal_setting">ÁõÆÊ®ôË®≠ÂÆöÊó•</option>
                                </select>
                            </div>
                            <textarea id="newEventDescription" class="input-field mb-3" rows="2" placeholder="Ë©≥Á¥∞"></textarea>
                            <button onclick="addEvent()" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i>‰∫àÂÆö„ÇíËøΩÂä†
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-span-4">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-list mr-2 text-green-600"></i>‰ªäÊó•„ÅÆ‰∫àÂÆö
                        </h3>
                        <div id="todayEvents" class="space-y-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Â£≤‰∏äÂàÜÊûê„Çø„Éñ -->
        <div id="salesTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-12">
                    <div class="glass-card p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-chart-line mr-2 text-green-600"></i>Â£≤‰∏ä„Éá„Éº„ÇøÂàÜÊûê„ÉªÊ•≠ÂãôÁÆ°ÁêÜ
                            </h3>
                            <div class="flex space-x-2">
                                <input type="file" id="salesFileInput" accept=".csv,.xlsx,.xls" class="hidden" onchange="uploadSalesData(event)">
                                <button onclick="document.getElementById('salesFileInput').click()" class="btn btn-primary">
                                    <i class="fas fa-upload mr-2"></i>Excel/CSVË™≠Ëæº
                                </button>
                                <button onclick="downloadSalesTemplate()" class="btn btn-secondary">
                                    <i class="fas fa-download mr-2"></i>„ÉÜ„É≥„Éó„É¨„Éº„Éà
                                </button>
                                <button onclick="loadSampleData()" class="btn btn-success">
                                    <i class="fas fa-database mr-2"></i>„Çµ„É≥„Éó„É´„Éá„Éº„Çø
                                </button>
                            </div>
                        </div>
                        
                        <div id="salesUploadArea" class="text-center py-12 border-2 border-dashed border-gray-300 rounded-lg">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 mb-2">Â£≤‰∏äExcel/CSV„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            <p class="text-sm text-gray-400">ÂØæÂøúÂΩ¢Âºè: .xlsx, .xls, .csv | „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Åæ„Åü„ÅØ„ÇØ„É™„ÉÉ„ÇØ</p>
                            <div class="mt-4 text-sm text-blue-600">
                                <i class="fas fa-info-circle mr-2"></i>
                                Ê•≠ÂãôÁÆ°ÁêÜ.xlsx„Éï„Ç°„Ç§„É´„ÇíÁõ¥Êé•Ë™≠„ÅøËæº„ÅøÂèØËÉΩ
                            </div>
                        </div>
                        
                        <div id="salesAnalysis" class="hidden">
                            <!-- ÂÖ®‰ΩìÁµ±Ë®à -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="stats-card">
                                    <div class="text-xl font-bold text-green-600 mb-2" id="totalSales">¬•0</div>
                                    <div class="text-sm text-gray-600">Á∑èÂ£≤‰∏ä</div>
                                </div>
                                <div class="stats-card">
                                    <div class="text-xl font-bold text-blue-600 mb-2" id="averageSales">¬•0</div>
                                    <div class="text-sm text-gray-600">Âπ≥ÂùáÂ£≤‰∏ä</div>
                                </div>
                                <div class="stats-card">
                                    <div class="text-xl font-bold text-purple-600 mb-2" id="topStore">-</div>
                                    <div class="text-sm text-gray-600">ÊúÄÈ´òÂ£≤‰∏äÂ∫óËàó</div>
                                </div>
                                <div class="stats-card">
                                    <div class="text-xl font-bold text-orange-600 mb-2" id="growthRate">0%</div>
                                    <div class="text-sm text-gray-600">ÈÄ±ÈñìÊàêÈï∑Áéá</div>
                                </div>
                            </div>
                            
                            <!-- Â∫óËàóÂà•ÂàÜÊûê„Çª„ÇØ„Ç∑„Éß„É≥ -->
                            <div class="glass-card p-6 mb-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h4 class="font-semibold flex items-center">
                                        <i class="fas fa-store mr-2 text-blue-600"></i>Â∫óËàóÂà•Ë©≥Á¥∞ÂàÜÊûê
                                    </h4>
                                    <div class="flex space-x-3">
                                        <select id="storeSelector" class="input-field w-48" onchange="showStoreDetails()">
                                            <option value="">ÂÖ®Â∫óËàóÊ¶ÇË¶Å</option>
                                            <option value="CLASSYÂõõÊó•Â∏Ç">CLASSYÂõõÊó•Â∏Ç</option>
                                            <option value="CLASSYÊù±‰∫¨">CLASSYÊù±‰∫¨</option>
                                            <option value="CLASSYÂêçÂè§Â±ã">CLASSYÂêçÂè§Â±ã</option>
                                            <option value="GrandOperaÊù±‰∫¨">GrandOperaÊù±‰∫¨</option>
                                            <option value="GrandOperaÊ®™Êµú">GrandOperaÊ®™Êµú</option>
                                            <option value="GrandOperaÂêçÂè§Â±ã">GrandOperaÂêçÂè§Â±ã</option>
                                            <option value="GrandOperaÁ¶èÂ≤°">GrandOperaÁ¶èÂ≤°</option>
                                            <option value="„Ç™„Éö„É©Èå¶">„Ç™„Éö„É©Èå¶</option>
                                            <option value="„Ç∑„É£„Éñ„Éº„É´">„Ç∑„É£„Éñ„Éº„É´</option>
                                            <option value="„ÉØ„É≥„Ç´„É©„ÉÉ„Éà">„ÉØ„É≥„Ç´„É©„ÉÉ„Éà</option>
                                        </select>
                                        <select id="periodSelector" class="input-field w-32" onchange="updateStorePeriod()">
                                            <option value="30">30Êó•Èñì</option>
                                            <option value="14">2ÈÄ±Èñì</option>
                                            <option value="7">1ÈÄ±Èñì</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- ÂÖ®Â∫óËàóÊ¶ÇË¶ÅË°®Á§∫ -->
                                <div id="allStoresView">
                                    <div class="chart-container mb-6">
                                        <h5 class="font-semibold mb-4">Â∫óËàóÂà•Â£≤‰∏ä„ÉÅ„É£„Éº„Éà</h5>
                                        <canvas id="salesChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                                
                                <!-- ÂÄãÂà•Â∫óËàóË©≥Á¥∞Ë°®Á§∫ -->
                                <div id="individualStoreView" class="hidden">
                                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                        <!-- Â∫óËàóKPI -->
                                        <div class="lg:col-span-1">
                                            <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-6">
                                                <h5 class="font-semibold mb-4 text-gray-800" id="selectedStoreName">Â∫óËàóÂêç</h5>
                                                <div class="space-y-4">
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">Á∑èÂ£≤‰∏ä</span>
                                                        <span class="font-bold text-lg text-green-600" id="storeDetailSales">¬•0</span>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">Êó•Âπ≥ÂùáÂ£≤‰∏ä</span>
                                                        <span class="font-bold text-blue-600" id="storeDetailAvgSales">¬•0</span>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">ÂÜô„É°Êó•Ë®ò (Êó•Âπ≥Âùá)</span>
                                                        <span class="font-bold text-purple-600" id="storeDetailDiary">0‰ª∂/Êó•</span>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">Êó•Âπ≥ÂùáÂÜô„É°Êó•Ë®ò</span>
                                                        <span class="font-bold text-purple-600" id="storeDetailAvgDiary">0‰ª∂/Êó•</span>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">Âè£„Ç≥„Éü (Êó•Âπ≥Âùá)</span>
                                                        <span class="font-bold text-orange-600" id="storeDetailReviews">0‰ª∂/Êó•</span>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-gray-600">Âè£„Ç≥„ÉüËª¢ÊèõÁéá</span>
                                                        <span class="font-bold text-green-600" id="storeDetailConversion">0%</span>
                                                    </div>
                                                    <div class="pt-3 border-t">
                                                        <div class="flex justify-between items-center">
                                                            <span class="text-sm text-gray-600">Â∫óËàó„É©„É≥„Ç≠„É≥„Ç∞</span>
                                                            <span class="font-bold text-xl" id="storeDetailRank">#1</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Â£≤‰∏äÊé®Áßª„Ç∞„É©„Éï -->
                                        <div class="lg:col-span-2">
                                            <div class="bg-white rounded-lg p-6 border">
                                                <h5 class="font-semibold mb-4">Â£≤‰∏äÊé®Áßª</h5>
                                                <canvas id="storeDetailChart" width="600" height="300"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Ë©≥Á¥∞„Éá„Éº„Çø„ÉÜ„Éº„Éñ„É´ -->
                                    <div class="bg-white rounded-lg p-6 border">
                                        <h5 class="font-semibold mb-4">Êó•Âà•Ë©≥Á¥∞„Éá„Éº„Çø</h5>
                                        <div class="overflow-x-auto">
                                            <table id="storeDetailTable" class="w-full text-sm">
                                                <thead class="bg-gray-50">
                                                    <tr>
                                                        <th class="px-4 py-2 text-left">Êó•‰ªò</th>
                                                        <th class="px-4 py-2 text-right">Â£≤‰∏ä</th>
                                                        <th class="px-4 py-2 text-right">ÂÜô„É°Êó•Ë®ò</th>
                                                        <th class="px-4 py-2 text-right">Âè£„Ç≥„Éü</th>
                                                        <th class="px-4 py-2 text-right">Ëª¢ÊèõÁéá</th>
                                                        <th class="px-4 py-2 text-center">ÁõÆÊ®ôÈÅîÊàê</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="storeDetailTableBody">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    
                                    <!-- Â∫óËàóÂà•„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥ -->
                                    <div class="bg-white rounded-lg p-6 border mt-6">
                                        <h5 class="font-semibold mb-4 flex items-center">
                                            <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>Â∫óËàóÂà•ÊîπÂñÑÊèêÊ°à
                                        </h5>
                                        <div id="storeActionPlan" class="space-y-3">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÁõÆÊ®ôÁÆ°ÁêÜ„Çø„Éñ -->
        <div id="goalsTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-6">
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-target mr-2 text-red-600"></i>ÊúàÊ¨°ÁõÆÊ®ôË®≠ÂÆö
                            </h3>
                            <div class="text-sm text-gray-600">
                                Ê¨°ÂõûË®≠ÂÆöÊó•: <span id="nextGoalDate" class="font-semibold">2025Âπ¥7Êúà2Êó•</span>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <label class="font-medium">ÂØæË±°Êúà</label>
                                <div class="flex space-x-2">
                                    <input type="month" id="goalMonth" class="input-field w-48" value="2025-07" onchange="loadExistingGoals(this.value); loadGoalProgress();">
                                    <button onclick="copyPreviousMonthGoals()" class="btn btn-secondary">
                                        <i class="fas fa-copy mr-2"></i>ÂâçÊúà„Ç≥„Éî„Éº
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="goalSettings" class="space-y-6">
                            <!-- Â∫óËàóÂà•ÁõÆÊ®ôË®≠ÂÆö -->
                        </div>
                        
                        <div class="flex space-x-3 mt-6">
                            <button onclick="saveGoals()" class="btn btn-primary flex-1">
                                <i class="fas fa-save mr-2"></i>ÁõÆÊ®ô„Çí‰øùÂ≠ò
                            </button>
                            <button onclick="generateGoalReport()" class="btn btn-secondary">
                                <i class="fas fa-file-alt mr-2"></i>„É¨„Éù„Éº„Éà
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-span-6">
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-chart-pie mr-2 text-blue-600"></i>ÁõÆÊ®ôÈÅîÊàêÁä∂Ê≥Å
                            </h3>
                            <div class="flex space-x-2">
                                <select id="goalViewMode" class="input-field w-32" onchange="loadGoalProgress()">
                                    <option value="overview">Ê¶ÇË¶Å</option>
                                    <option value="detailed">Ë©≥Á¥∞</option>
                                </select>
                                <button onclick="refreshGoalData()" class="btn btn-secondary">
                                    <i class="fas fa-sync mr-2"></i>Êõ¥Êñ∞
                                </button>
                            </div>
                        </div>
                        
                        <!-- ÂÖ®‰ΩìÈÄ≤Êçó„Çµ„Éû„É™„Éº -->
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <div class="text-2xl font-bold text-green-600" id="overallSalesAchievement">0%</div>
                                <div class="text-sm text-gray-600">Â£≤‰∏äÈÅîÊàêÁéá</div>
                            </div>
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600" id="overallDiaryAchievement">0%</div>
                                <div class="text-sm text-gray-600">ÂÜô„É°Êó•Ë®òÈÅîÊàêÁéá<br>(Êó•Âπ≥Âùá)</div>
                            </div>
                            <div class="text-center p-4 bg-orange-50 rounded-lg">
                                <div class="text-2xl font-bold text-orange-600" id="overallReviewAchievement">0%</div>
                                <div class="text-sm text-gray-600">Âè£„Ç≥„ÉüÈÅîÊàêÁéá<br>(ÊúàÂêàË®à)</div>
                            </div>
                        </div>
                        
                        <div id="goalProgress" class="space-y-4">
                            <!-- ÁõÆÊ®ôÈÄ≤ÊçóË°®Á§∫ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ë©≥Á¥∞ÂàÜÊûê„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="glass-card p-6 mt-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-analytics mr-2 text-indigo-600"></i>ÁõÆÊ®ôÂàÜÊûê„ÉªÊîπÂñÑÊèêÊ°à
                </h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- ÈÅîÊàêÁä∂Ê≥Å„ÉÅ„É£„Éº„Éà -->
                    <div>
                        <h4 class="font-semibold mb-4">Â∫óËàóÂà•ÈÅîÊàêÁä∂Ê≥Å</h4>
                        <canvas id="goalAchievementChart" width="400" height="300"></canvas>
                    </div>
                    
                    <!-- ÊîπÂñÑÊèêÊ°à -->
                    <div>
                        <h4 class="font-semibold mb-4">ÊîπÂñÑÊèêÊ°à„Éª„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥</h4>
                        <div id="goalActionPlan" class="space-y-3 max-h-64 overflow-y-auto">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„ÇãÊîπÂñÑÊèêÊ°à -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- „Éá„Ç∂„Ç§„É≥ÈÉ®ÈñÄ„Çø„Éñ -->
        <div id="designTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-8">
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-palette mr-2 text-pink-600"></i>„Éá„Ç∂„Ç§„É≥Ê°à‰ª∂ÁÆ°ÁêÜ
                            </h3>
                            <div class="flex space-x-2">
                                <select id="designFilter" class="input-field w-40" onchange="filterDesignProjects()">
                                    <option value="all">„Åô„Åπ„Å¶</option>
                                    <option value="planning">‰ºÅÁîª‰∏≠</option>
                                    <option value="designing">„Éá„Ç∂„Ç§„É≥‰∏≠</option>
                                    <option value="review">„É¨„Éì„É•„Éº‰∏≠</option>
                                    <option value="completed">ÂÆå‰∫Ü</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="designProjectList" class="space-y-3 mb-6 max-h-96 overflow-y-auto"></div>
                        
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">Êñ∞„Åó„ÅÑÊ°à‰ª∂„ÇíËøΩÂä†</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                <input id="newDesignTitle" type="text" class="input-field" placeholder="Ê°à‰ª∂Âêç">
                                <select id="newDesignType" class="input-field">
                                    <option value="logo">„É≠„Ç¥„Éá„Ç∂„Ç§„É≥</option>
                                    <option value="flyer">„ÉÅ„É©„Ç∑„Éª„Éï„É©„Ç§„É§„Éº</option>
                                    <option value="web">Web„Éá„Ç∂„Ç§„É≥</option>
                                    <option value="banner">„Éê„Éä„ÉºÂà∂‰Ωú</option>
                                    <option value="package">„Éë„ÉÉ„Ç±„Éº„Ç∏„Éá„Ç∂„Ç§„É≥</option>
                                    <option value="interior">Â∫óËàóÂÜÖË£Ö</option>
                                    <option value="other">„Åù„ÅÆ‰ªñ</option>
                                </select>
                                <select id="newDesignPriority" class="input-field">
                                    <option value="normal">ÈÄöÂ∏∏</option>
                                    <option value="high">ÈáçË¶Å</option>
                                    <option value="urgent">Á∑äÊÄ•</option>
                                </select>
                                <input id="newDesignDue" type="date" class="input-field">
                                <input id="newDesignClient" type="text" class="input-field" placeholder="‰æùÈ†ºËÄÖ„ÉªÂ∫óËàó">
                                <select id="newDesignStatus" class="input-field">
                                    <option value="planning">‰ºÅÁîª‰∏≠</option>
                                    <option value="designing">„Éá„Ç∂„Ç§„É≥‰∏≠</option>
                                    <option value="review">„É¨„Éì„É•„Éº‰∏≠</option>
                                </select>
                            </div>
                            <textarea id="newDesignDescription" class="input-field mb-3" rows="3" placeholder="Ë©≥Á¥∞„ÉªË¶Å‰ª∂"></textarea>
                            <button onclick="addDesignProject()" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i>Ê°à‰ª∂„ÇíËøΩÂä†
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-span-4">
                    <div class="glass-card p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-doughnut mr-2 text-purple-600"></i>Ê°à‰ª∂Áä∂Ê≥Å
                        </h3>
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span class="text-sm">‰ºÅÁîª‰∏≠</span>
                                <span id="planningCount" class="font-bold text-blue-600">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm">„Éá„Ç∂„Ç§„É≥‰∏≠</span>
                                <span id="designingCount" class="font-bold text-yellow-600">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm">„É¨„Éì„É•„Éº‰∏≠</span>
                                <span id="reviewCount" class="font-bold text-purple-600">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm">ÂÆå‰∫Ü</span>
                                <span id="designCompletedCount" class="font-bold text-green-600">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-clock mr-2 text-orange-600"></i>Á∑†ÂàáËø´„ÇãÊ°à‰ª∂
                        </h3>
                        <div id="urgentDesignProjects" class="space-y-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- „ÉÑ„Éº„É´„Çø„Éñ -->
        <div id="toolsTab" class="tab-content mx-4 hidden">
            <div class="dashboard-grid">
                <div class="col-span-6">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-brain mr-2 text-purple-600"></i>„Éó„É≠„É≥„Éó„ÉàÈõÜ
                        </h3>
                        
                        <div class="flex flex-wrap gap-2 mb-4" id="promptCategoryTabs">
                            <button class="nav-tab active" data-category="all" onclick="switchPromptCategory('all')">„Åô„Åπ„Å¶</button>
                            <button class="nav-tab" data-category="line" onclick="switchPromptCategory('line')">LINE</button>
                            <button class="nav-tab" data-category="sns" onclick="switchPromptCategory('sns')">SNS</button>
                            <button class="nav-tab" data-category="report" onclick="switchPromptCategory('report')">Â†±Âëä</button>
                            <button class="nav-tab" data-category="design" onclick="switchPromptCategory('design')">„Éá„Ç∂„Ç§„É≥</button>
                        </div>

                        <div id="promptList" class="space-y-3 mb-6 max-h-64 overflow-y-auto"></div>
                        
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">Êñ∞„Åó„ÅÑ„Éó„É≠„É≥„Éó„Éà„ÇíËøΩÂä†</h4>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <select id="newPromptCategory" class="input-field">
                                    <option value="line">LINEÁî®</option>
                                    <option value="sns">SNSÁî®</option>
                                    <option value="report">Â†±ÂëäÁî®</option>
                                    <option value="design">„Éá„Ç∂„Ç§„É≥Áî®</option>
                                    <option value="other">„Åù„ÅÆ‰ªñ</option>
                                </select>
                                <input id="newPromptLabel" type="text" class="input-field" placeholder="„Éú„Çø„É≥Âêç">
                            </div>
                            <textarea id="newPromptText" class="input-field mb-3" rows="3" placeholder="„Éó„É≠„É≥„Éó„ÉàÂÜÖÂÆπ"></textarea>
                            <button onclick="addPrompt()" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i>„Éó„É≠„É≥„Éó„Éà„ÇíËøΩÂä†
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col-span-6">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-sticky-note mr-2 text-yellow-600"></i>„É°„É¢„Éª„Åµ„Åõ„Çì
                        </h3>
                        
                        <div class="flex justify-between items-center mb-4">
                            <select id="memoDateSelector" class="input-field w-40" onchange="loadSelectedMemo()">
                                <option value="">‰ªäÊó•„ÅÆ„É°„É¢</option>
                            </select>
                            <button onclick="clearMemo()" class="btn btn-warning">
                                <i class="fas fa-eraser mr-2"></i>„ÇØ„É™„Ç¢
                            </button>
                        </div>
                        
                        <div class="mb-3 text-sm text-gray-600">
                            <i class="fas fa-clock mr-2"></i>
                            <span id="memoSaveDate"></span>
                        </div>
                        
                        <textarea id="memoArea" class="input-field resize-none" rows="12" 
                                placeholder="Ê∞ó„Å•„Åç„ÉªÊåáÁ§∫‰∫ãÈ†Ö„ÉªÈáçË¶Å„Å™„Éù„Ç§„É≥„Éà„Çí„É°„É¢..."></textarea>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid mt-6">
                <div class="col-span-12">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-cogs mr-2 text-gray-600"></i>„Ç∑„Çπ„ÉÜ„É†ÁÆ°ÁêÜ
                        </h3>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="exportAllData()" class="btn btn-secondary">
                                <i class="fas fa-download mr-2"></i>ÂÖ®„Éá„Éº„ÇøÂá∫Âäõ
                            </button>
                            <button onclick="importAllData()" class="btn btn-secondary">
                                <i class="fas fa-upload mr-2"></i>„Éá„Éº„ÇøÂèñËæº
                            </button>
                            <button onclick="clearAllData()" class="btn btn-danger">
                                <i class="fas fa-trash mr-2"></i>ÂÖ®„Éá„Éº„ÇøÂâäÈô§
                            </button>
                            <button onclick="generateReport()" class="btn btn-primary">
                                <i class="fas fa-file-alt mr-2"></i>„É¨„Éù„Éº„ÉàÁîüÊàê
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- „É¢„Éº„ÉÄ„É´ -->
    <div id="notificationModal" class="modal">
        <div class="modal-content w-96">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">ÈÄöÁü•„Éª„Ç¢„É©„Éº„Éà</h3>
                <button onclick="closeModal('notificationModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="notificationList" class="space-y-3 max-h-64 overflow-y-auto"></div>
        </div>
    </div>

    <!-- Èö†„Åó„Éï„Ç°„Ç§„É´ÂÖ•Âäõ -->
    <input type="file" id="importFileInput" accept=".json" class="hidden" onchange="handleDataImport(event)">

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        const CORRECT_PASSWORD = 'iam1104JP';
        const SESSION_DURATION = 30 * 60 * 1000;
        const MAX_LOGIN_ATTEMPTS = 5;
        
        let currentTab = 'dashboard';
        let currentPromptCategory = 'all';
        let currentDesignFilter = 'all';
        let loginAttempts = 0;
        let sessionTimer = null;
        let notifications = [];
        let currentMonth = new Date();
        
        // ÊâãÂãï„Éë„Çπ„ÉØ„Éº„ÉâË®≠ÂÆöÊ©üËÉΩ
        function manualPasswordCheck() {
            const userInput = prompt('„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
            if (userInput === CORRECT_PASSWORD) {
                emergencyLogin();
            } else if (userInput === null) {
                // „Ç≠„É£„É≥„Çª„É´„Åï„Çå„ÅüÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            } else {
                alert('„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô');
            }
        }

        // Á∑äÊÄ•„É≠„Ç∞„Ç§„É≥Ê©üËÉΩ
        function emergencyLogin() {
            // Âº∑Âà∂ÁöÑ„Å´„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÇíË°®Á§∫
            sessionStorage.setItem('isLoggedIn', 'true');
            sessionStorage.setItem('loginTime', Date.now().toString());
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainDashboard').classList.remove('hidden');
            
            loadAllData();
            updateAllStats();
            startSessionTimer(SESSION_DURATION);
            
            alert('„É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åó„Åü');
        }
        
        // „Éá„Éº„ÇøÁÆ°ÁêÜ„Ç≠„Éº
        const STORAGE_KEYS = {
            tasks: 'rispondere_tasks',
            events: 'rispondere_events', 
            prompts: 'rispondere_prompts',
            designProjects: 'rispondere_design_projects',
            goals: 'rispondere_goals',
            salesData: 'rispondere_sales_data',
            memos: 'rispondere_memos_'
        };

        // Â∫óËàó„É™„Çπ„Éà
        const STORES = [
            { id: 'classy_tokyo', name: 'CLASSYÊù±‰∫¨' },
            { id: 'classy_nagoya', name: 'CLASSYÂêçÂè§Â±ã' },
            { id: 'classy_yokkaichi', name: 'CLASSYÂõõÊó•Â∏Ç' },
            { id: 'grandopera_tokyo', name: 'GrandOperaÊù±‰∫¨' },
            { id: 'grandopera_yokohama', name: 'GrandOperaÊ®™Êµú' },
            { id: 'grandopera_nagoya', name: 'GrandOperaÂêçÂè§Â±ã' },
            { id: 'grandopera_fukuoka', name: 'GrandOperaÁ¶èÂ≤°' },
            { id: 'wancarat', name: '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà' },
            { id: 'shabour', name: '„Ç∑„É£„Éñ„Éº„É´' },
            { id: 'opera_nishiki', name: '„Ç™„Éö„É©Èå¶' }
        ];

        // Â£≤‰∏äÂàÜÊûê„ÉªÂ∫óËàóÂà•Ë©≥Á¥∞ÂàÜÊûê
        let currentSalesData = [];
        let currentStoreStats = {};

        // ÂàùÊúüÂåñ
        window.onload = () => {
            checkAuthentication();
            setupEventListeners();
            updateDateTime();
            setInterval(updateDateTime, 60000);
            
            // „Éë„Çπ„ÉØ„Éº„Éâ„Éï„Ç£„Éº„É´„Éâ„Å´„Éï„Ç©„Éº„Ç´„Çπ
            setTimeout(() => {
                const input = document.getElementById('passwordInput');
                if (input) {
                    input.focus();
                    input.value = ''; // Á¢∫ÂÆü„Å´„ÇØ„É™„Ç¢
                }
            }, 200);
            
            // „Ç¢„É©„Éº„Éà„ÉÅ„Çß„ÉÉ„ÇØ„ÅØÂæå„ÅßÊúâÂäπÂåñ
            setTimeout(() => {
                checkAlerts();
                setInterval(checkAlerts, 60000);
            }, 5000);
        };

        // Ë™çË®ºÂá¶ÁêÜ
        function checkAuthentication() {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            
            if (isLoggedIn === 'true') {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainDashboard').style.display = 'block';
                loadAllData();
                updateAllStats();
            } else {
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('mainDashboard').style.display = 'none';
                
                setTimeout(() => {
                    const input = document.getElementById('passwordInput');
                    if (input) input.focus();
                }, 100);
            }
        }

        // „Ç∑„É≥„Éó„É´„Å™„É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ
        function simpleLogin(event) {
            if (event) event.preventDefault();
            
            const passwordInput = document.getElementById('passwordInput');
            const password = passwordInput ? passwordInput.value : '';
            
            // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÇíË°®Á§∫
            console.log('ÂÖ•Âäõ„Åï„Çå„Åü„Éë„Çπ„ÉØ„Éº„Éâ:', password);
            console.log('Ê≠£„Åó„ÅÑ„Éë„Çπ„ÉØ„Éº„Éâ:', CORRECT_PASSWORD);
            console.log('„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰∏ÄËá¥:', password === CORRECT_PASSWORD);
            
            alert(`„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±:
ÂÖ•Âäõ: "${password}"
Ê≠£Ëß£: "${CORRECT_PASSWORD}"
Èï∑„Åï: ${password.length}
‰∏ÄËá¥: ${password === CORRECT_PASSWORD}`);
            
            if (password === CORRECT_PASSWORD) {
                // „É≠„Ç∞„Ç§„É≥ÊàêÂäü
                sessionStorage.setItem('isLoggedIn', 'true');
                sessionStorage.setItem('loginTime', Date.now().toString());
                
                // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÇíË°®Á§∫
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainDashboard').classList.remove('hidden');
                
                // „Éá„Éº„Çø„É≠„Éº„Éâ„Å®Áµ±Ë®àÊõ¥Êñ∞
                loadAllData();
                updateAllStats();
                
                // „Çª„ÉÉ„Ç∑„Éß„É≥„Çø„Ç§„Éû„ÉºÈñãÂßã
                startSessionTimer(SESSION_DURATION);
                
                // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏
                alert('„É≠„Ç∞„Ç§„É≥„Å´ÊàêÂäü„Åó„Åæ„Åó„ÅüÔºÅ');
                
                return false;
            } else {
                // „É≠„Ç∞„Ç§„É≥Â§±Êïó
                alert('„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                if (passwordInput) {
                    passwordInput.value = '';
                    passwordInput.focus();
                }
                return false;
            }
        }

        function updateLoginAttemptDisplay() {
            const attemptsDiv = document.getElementById('loginAttempts');
            const countSpan = document.getElementById('attemptCount');
            
            if (loginAttempts > 0) {
                countSpan.textContent = loginAttempts;
                attemptsDiv.classList.remove('hidden');
            }
        }

        function lockLogin() {
            const passwordInput = document.getElementById('passwordInput');
            const submitBtn = document.querySelector('button[type="submit"]');
            
            passwordInput.disabled = true;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-lock mr-2"></i>„É≠„ÉÉ„ÇØ‰∏≠...';
            
            setTimeout(() => {
                passwordInput.disabled = false;
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>„É≠„Ç∞„Ç§„É≥';
                localStorage.removeItem('loginAttempts');
                loginAttempts = 0;
                document.getElementById('loginAttempts').classList.add('hidden');
                showNotification('„É≠„ÉÉ„ÇØ„ÅåËß£Èô§„Åï„Çå„Åæ„Åó„Åü', 'info');
            }, 30 * 1000); // 30Áßí„Å´Áü≠Á∏Æ
        }

        // „Éë„Çπ„ÉØ„Éº„Éâ„Éï„Ç£„Éº„É´„Éâ„ÅÆÁä∂ÊÖã„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åô„ÇãÈñ¢Êï∞
        function checkPasswordFieldStatus() {
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                console.log('„Éë„Çπ„ÉØ„Éº„Éâ„Éï„Ç£„Éº„É´„ÉâÁä∂ÊÖã:', {
                    disabled: passwordInput.disabled,
                    readOnly: passwordInput.readOnly,
                    value: passwordInput.value,
                    style: passwordInput.style.cssText
                });
                
                alert(`„Éë„Çπ„ÉØ„Éº„Éâ„Éï„Ç£„Éº„É´„ÉâÁä∂ÊÖã:
ÁÑ°ÂäπÂåñ: ${passwordInput.disabled}
Ë™≠„ÅøÂèñ„ÇäÂ∞ÇÁî®: ${passwordInput.readOnly}
ÂÄ§: "${passwordInput.value}"
„Çπ„Çø„Ç§„É´: ${passwordInput.style.cssText}`);
            }
        }

        // „É≠„Ç∞„Ç§„É≥Áä∂ÊÖã„ÇíÂº∑Âà∂„É™„Çª„ÉÉ„Éà„Åô„ÇãÈñ¢Êï∞
        function forceResetLogin() {
            // ÂÖ®„Å¶„ÅÆ„É≠„Ç∞„Ç§„É≥Èñ¢ÈÄ£„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
            localStorage.removeItem('loginAttempts');
            sessionStorage.removeItem('isLoggedIn');
            sessionStorage.removeItem('loginTime');
            loginAttempts = 0;
            
            // „Éë„Çπ„ÉØ„Éº„Éâ„Éï„Ç£„Éº„É´„Éâ„ÇíÁ¢∫ÂÆü„Å´ÊúâÂäπÂåñ
            const passwordInput = document.getElementById('passwordInput');
            const submitBtn = document.querySelector('button[type="submit"]');
            const attemptsDiv = document.getElementById('loginAttempts');
            
            if (passwordInput) {
                passwordInput.disabled = false;
                passwordInput.readOnly = false;
                passwordInput.value = '';
                passwordInput.style.pointerEvents = 'auto';
                passwordInput.style.opacity = '1';
                passwordInput.removeAttribute('disabled');
                passwordInput.removeAttribute('readonly');
                
                // Â∞ë„ÅóÈÅÖÂª∂„Åó„Å¶„Åã„Çâ„Éï„Ç©„Éº„Ç´„Çπ
                setTimeout(() => {
                    passwordInput.focus();
                }, 100);
            }
            
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>„É≠„Ç∞„Ç§„É≥';
            }
            
            if (attemptsDiv) {
                attemptsDiv.classList.add('hidden');
            }
            
            // „Çª„ÉÉ„Ç∑„Éß„É≥„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
            if (sessionTimer) {
                clearInterval(sessionTimer);
            }
            
            console.log('„É≠„Ç∞„Ç§„É≥Áä∂ÊÖã„ÇíÂº∑Âà∂„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
            alert('„É≠„Ç∞„Ç§„É≥Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü„ÄÇ\n„Éë„Çπ„ÉØ„Éº„Éâ: iam1104JP\n\n„Éë„Çπ„ÉØ„Éº„Éâ„Éï„Ç£„Éº„É´„Éâ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }

        function logout() {
            if (confirm('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åô„ÅãÔºü')) {
                sessionStorage.removeItem('isLoggedIn');
                sessionStorage.removeItem('loginTime');
                
                if (sessionTimer) {
                    clearInterval(sessionTimer);
                }
                
                showLoginScreen();
                alert('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü');
            }
        }

        function startSessionTimer(duration) {
            // „Çª„ÉÉ„Ç∑„Éß„É≥„Çø„Ç§„Éû„Éº„ÇíÁ∞°Á¥†ÂåñÔºàÂøÖË¶Å„Å´Âøú„Åò„Å¶Âæå„ÅßÂÆüË£ÖÔºâ
            console.log('„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßã');
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainDashboard').classList.add('hidden');
            document.getElementById('sessionTimer').classList.add('hidden');
            
            // „É≠„Ç∞„Ç§„É≥Áä∂ÊÖã„ÇíÂº∑Âà∂„É™„Çª„ÉÉ„Éà
            forceResetLogin();
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainDashboard').classList.remove('hidden');
            loadAllData();
            updateAllStats();
        }

        // Êó•ÊôÇÊõ¥Êñ∞
        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('ja-JP', { 
                year: 'numeric', 
                month: 'numeric', 
                day: 'numeric',
                weekday: 'short'
            });
            const timeStr = now.toLocaleTimeString('ja-JP', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const currentDateElement = document.getElementById('currentDate');
            const currentTimeElement = document.getElementById('currentTime');
            
            if (currentDateElement) currentDateElement.textContent = dateStr;
            if (currentTimeElement) currentTimeElement.textContent = timeStr;
        }

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchTab(tabName) {
            // „Çø„Éñ„Éú„Çø„É≥„ÅÆÊõ¥Êñ∞
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆÂàá„ÇäÊõø„Åà
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}Tab`).classList.remove('hidden');
            
            currentTab = tabName;
            
            // „Çø„ÉñÂõ∫Êúâ„ÅÆÂàùÊúüÂåñ
            switch(tabName) {
                case 'schedule':
                    renderCalendar();
                    loadTodayEvents();
                    break;
                case 'tasks':
                    loadTasks();
                    updateTaskStats();
                    break;
                case 'design':
                    loadDesignProjects();
                    updateDesignStats();
                    break;
                case 'goals':
                    initGoalSettings();
                    loadGoalProgress();
                    break;
                case 'sales':
                    // Â£≤‰∏ä„Çø„Éñ„ÅÆÂàùÊúüÂåñ
                    break;
                case 'tools':
                    loadPrompts();
                    loadMemo();
                    updateMemoDateSelector();
                    break;
            }
        }

        // Â£≤‰∏äÂàÜÊûêÊ©üËÉΩ
        function showStoreDetails() {
            const selectedStore = document.getElementById('storeSelector').value;
            const allStoresView = document.getElementById('allStoresView');
            const individualStoreView = document.getElementById('individualStoreView');
            
            if (!selectedStore) {
                // ÂÖ®Â∫óËàóÊ¶ÇË¶ÅË°®Á§∫
                allStoresView.classList.remove('hidden');
                individualStoreView.classList.add('hidden');
                renderSalesChart(currentStoreStats);
            } else {
                // ÂÄãÂà•Â∫óËàóË©≥Á¥∞Ë°®Á§∫
                allStoresView.classList.add('hidden');
                individualStoreView.classList.remove('hidden');
                renderStoreDetails(selectedStore);
            }
        }

        function renderStoreDetails(storeName) {
            const storeData = getStoreData(storeName);
            const period = parseInt(document.getElementById('periodSelector').value);
            
            // Âü∫Êú¨ÊÉÖÂ†±„ÅÆË°®Á§∫
            document.getElementById('selectedStoreName').textContent = storeName;
            document.getElementById('storeDetailSales').textContent = `¬•${storeData.totalSales.toLocaleString()}`;
            document.getElementById('storeDetailAvgSales').textContent = `¬•${Math.round(storeData.avgSales).toLocaleString()}`;
            document.getElementById('storeDetailDiary').textContent = `${Math.round(storeData.totalDiary / storeData.days * 10) / 10}‰ª∂/Êó•`;
            document.getElementById('storeDetailAvgDiary').textContent = `${Math.round(storeData.avgDiary)}‰ª∂/Êó•`;
            document.getElementById('storeDetailReviews').textContent = `${Math.round(storeData.totalReviews / storeData.days * 10) / 10}‰ª∂/Êó•`;
            document.getElementById('storeDetailConversion').textContent = `${storeData.conversionRate.toFixed(1)}%`;
            document.getElementById('storeDetailRank').textContent = `#${storeData.rank}`;
            
            // „É©„É≥„Ç≠„É≥„Ç∞„Å´Âøú„Åò„ÅüË°®Á§∫Ëâ≤Â§âÊõ¥
            const rankElement = document.getElementById('storeDetailRank');
            if (storeData.rank <= 3) {
                rankElement.className = 'font-bold text-xl text-yellow-600';
                rankElement.innerHTML = `${storeData.rank === 1 ? 'ü•á' : storeData.rank === 2 ? 'ü•à' : 'ü•â'} #${storeData.rank}`;
            } else {
                rankElement.className = 'font-bold text-xl text-gray-600';
            }
            
            // Â£≤‰∏äÊé®Áßª„ÉÅ„É£„Éº„Éà
            renderStoreDetailChart(storeData.dailyData, storeName);
            
            // Ë©≥Á¥∞„ÉÜ„Éº„Éñ„É´
            renderStoreDetailTable(storeData.dailyData, storeName);
            
            // Â∫óËàóÂà•„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥
            generateStoreActionPlan(storeName, storeData);
        }

        function getStoreData(storeName) {
            const period = parseInt(document.getElementById('periodSelector').value);
            const storeData = currentSalesData.filter(row => 
                (row.Â∫óËàó || row.Â∫óËàóÂêç) === storeName
            );
            
            // ÊúüÈñì„Åß„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const today = new Date();
            const cutoffDate = new Date(today.getTime() - (period * 24 * 60 * 60 * 1000));
            
            const filteredData = storeData.filter(row => {
                const date = new Date(row.Êó•‰ªò);
                return date >= cutoffDate;
            }).sort((a, b) => new Date(a.Êó•‰ªò) - new Date(b.Êó•‰ªò));
            
            // Áµ±Ë®àË®àÁÆó
            const totalSales = filteredData.reduce((sum, row) => sum + (row.Â£≤‰∏ä || 0), 0);
            const totalDiary = filteredData.reduce((sum, row) => sum + (row.ÂÜô„É°Êó•Ë®ò || 0), 0);
            const totalReviews = filteredData.reduce((sum, row) => sum + (row.Âè£„Ç≥„Éü || 0), 0);
            const days = filteredData.length;
            
            const avgSales = days > 0 ? totalSales / days : 0;
            const avgDiary = days > 0 ? totalDiary / days : 0;
            const conversionRate = totalDiary > 0 ? (totalReviews / totalDiary) * 100 : 0;
            
            // „É©„É≥„Ç≠„É≥„Ç∞Ë®àÁÆó
            const allStoreRanking = Object.entries(currentStoreStats)
                .sort(([,a], [,b]) => b.Á∑èÂ£≤‰∏ä - a.Á∑èÂ£≤‰∏ä);
            const rank = allStoreRanking.findIndex(([store,]) => store === storeName) + 1;
            
            return {
                dailyData: filteredData,
                totalSales,
                totalDiary,
                totalReviews,
                avgSales,
                avgDiary,
                conversionRate,
                rank,
                days
            };
        }

        function renderStoreDetailChart(dailyData, storeName) {
            const canvas = document.getElementById('storeDetailChart');
            if (!canvas || dailyData.length === 0) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const maxSales = Math.max(...dailyData.map(d => d.Â£≤‰∏ä || 0));
            const chartWidth = canvas.width - 100;
            const chartHeight = canvas.height - 80;
            
            // Ëª∏„ÅÆÊèèÁîª
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            // YËª∏
            ctx.beginPath();
            ctx.moveTo(60, 20);
            ctx.lineTo(60, chartHeight + 20);
            ctx.stroke();
            
            // XËª∏
            ctx.beginPath();
            ctx.moveTo(60, chartHeight + 20);
            ctx.lineTo(chartWidth + 60, chartHeight + 20);
            ctx.stroke();
            
            // „Ç∞„É™„ÉÉ„ÉâÁ∑ö
            ctx.strokeStyle = '#f3f4f6';
            for (let i = 1; i <= 5; i++) {
                const y = 20 + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(60, y);
                ctx.lineTo(chartWidth + 60, y);
                ctx.stroke();
            }
            
            // „Éá„Éº„Çø„É©„Ç§„É≥
            ctx.strokeStyle = '#3b82f6';
            ctx.fillStyle = '#3b82f6';
            ctx.lineWidth = 3;
            
            ctx.beginPath();
            dailyData.forEach((item, index) => {
                const x = 60 + (index / Math.max(dailyData.length - 1, 1)) * chartWidth;
                const y = 20 + chartHeight - ((item.Â£≤‰∏ä || 0) / maxSales) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                
                // „Éá„Éº„Çø„Éù„Ç§„É≥„Éà
                ctx.fillRect(x - 3, y - 3, 6, 6);
            });
            ctx.stroke();
            
            // „É©„Éô„É´
            ctx.fillStyle = '#374151';
            ctx.font = '12px Arial';
            
            // YËª∏„É©„Éô„É´
            for (let i = 0; i <= 5; i++) {
                const value = (maxSales / 5) * (5 - i);
                const y = 20 + (chartHeight / 5) * i;
                ctx.textAlign = 'right';
                ctx.fillText(`¬•${Math.round(value / 1000)}K`, 55, y + 3);
            }
            
            // Êó•‰ªò„É©„Éô„É´ÔºàÊúÄÂàù„Å®ÊúÄÂæå„ÅÆ„ÅøÔºâ
            ctx.textAlign = 'center';
            if (dailyData.length > 0) {
                const firstDate = new Date(dailyData[0].Êó•‰ªò).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
                const lastDate = new Date(dailyData[dailyData.length - 1].Êó•‰ªò).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
                ctx.fillText(firstDate, 60, chartHeight + 40);
                ctx.fillText(lastDate, chartWidth + 60, chartHeight + 40);
            }
        }

        function renderStoreDetailTable(dailyData, storeName) {
            const tableBody = document.getElementById('storeDetailTableBody');
            if (!tableBody) return;
            
            // ÁõÆÊ®ô„Éá„Éº„Çø„ÅÆÂèñÂæó
            const currentMonth = new Date().toISOString().substr(0, 7);
            const goals = JSON.parse(localStorage.getItem(STORAGE_KEYS.goals) || '{}');
            const monthGoals = goals[currentMonth] || {};
            
            // Â∫óËàóID„ÅÆÈÄÜÂºï„Åç
            const storeMapping = {
                'CLASSYÊù±‰∫¨': 'classy_tokyo',
                'CLASSYÂêçÂè§Â±ã': 'classy_nagoya', 
                'CLASSYÂõõÊó•Â∏Ç': 'classy_yokkaichi',
                'GrandOperaÊù±‰∫¨': 'grandopera_tokyo',
                'GrandOperaÊ®™Êµú': 'grandopera_yokohama',
                'GrandOperaÂêçÂè§Â±ã': 'grandopera_nagoya',
                'GrandOperaÁ¶èÂ≤°': 'grandopera_fukuoka',
                '„ÉØ„É≥„Ç´„É©„ÉÉ„Éà': 'wancarat',
                '„Ç∑„É£„Éñ„Éº„É´': 'shabour',
                '„Ç™„Éö„É©Èå¶': 'opera_nishiki'
            };
            
            const storeId = storeMapping[storeName];
            const storeGoals = storeId ? monthGoals[storeId] : {};
            const dailySalesGoal = storeGoals.sales ? Math.round(storeGoals.sales / 30) : 0;
            const monthlyDiaryGoal = storeGoals.diary || 0; // ÊúàÂêàË®à
            const dailyDiaryGoal = monthlyDiaryGoal > 0 ? Math.round(monthlyDiaryGoal / 30) : 0; // Êó•Âπ≥ÂùáÁõÆÊ®ô
            const monthlyReviewGoal = storeGoals.review || 0; // ÊúàÂêàË®à
            const dailyReviewGoal = monthlyReviewGoal > 0 ? Math.round(monthlyReviewGoal / 30) : 0; // Êó•Âπ≥ÂùáÁõÆÊ®ô
            
            tableBody.innerHTML = dailyData.slice(-14).reverse().map(item => {
                const sales = item.Â£≤‰∏ä || 0;
                const diary = item.ÂÜô„É°Êó•Ë®ò || 0;
                const reviews = item.Âè£„Ç≥„Éü || 0;
                const conversionRate = diary > 0 ? (reviews / diary * 100).toFixed(1) : '0.0';
                
                // ÁõÆÊ®ôÈÅîÊàêÁä∂Ê≥Å
                const salesAchieved = dailySalesGoal > 0 ? sales >= dailySalesGoal : false;
                const diaryAchieved = dailyDiaryGoal > 0 ? diary >= dailyDiaryGoal : false;
                const reviewAchieved = dailyReviewGoal > 0 ? reviews >= dailyReviewGoal : false;
                
                const achievementScore = [salesAchieved, diaryAchieved, reviewAchieved].filter(Boolean).length;
                const achievementClass = achievementScore === 3 ? 'text-green-600' : achievementScore >= 2 ? 'text-yellow-600' : 'text-red-600';
                const achievementIcon = achievementScore === 3 ? 'üü¢' : achievementScore >= 2 ? 'üü°' : 'üî¥';
                
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-2">${new Date(item.Êó•‰ªò).toLocaleDateString('ja-JP')}</td>
                        <td class="px-4 py-2 text-right font-medium ${salesAchieved ? 'text-green-600' : ''}">${sales.toLocaleString()}</td>
                        <td class="px-4 py-2 text-right ${diaryAchieved ? 'text-green-600' : ''}">${diary}</td>
                        <td class="px-4 py-2 text-right ${reviewAchieved ? 'text-green-600' : ''}">${reviews}</td>
                        <td class="px-4 py-2 text-right">${conversionRate}%</td>
                        <td class="px-4 py-2 text-center">
                            <span class="${achievementClass}" title="${achievementScore}/3 ÁõÆÊ®ôÈÅîÊàê">
                                ${achievementIcon} ${achievementScore}/3
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function generateStoreActionPlan(storeName, storeData) {
            const container = document.getElementById('storeActionPlan');
            if (!container) return;
            
            const plans = [];
            
            // Â£≤‰∏äÂàÜÊûê
            if (storeData.rank > 5) {
                plans.push({
                    type: 'warning',
                    title: 'Â£≤‰∏äÊîπÂñÑ„ÅåÂøÖË¶Å',
                    description: `ÁèæÂú®${storeData.rank}‰Ωç„ÄÇ‰∏ä‰ΩçÂ∫óËàó„Å®„ÅÆÂ∑Æ„ÇíÁ∏Æ„ÇÅ„ÇãÊñΩÁ≠ñ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`,
                    actions: [
                        'ÈõÜÂÆ¢ÊñΩÁ≠ñ„ÅÆÂº∑Âåñ',
                        '„Çµ„Éº„Éì„ÇπÂìÅË≥™„ÅÆÂêë‰∏ä',
                        'ÊñôÈáë‰ΩìÁ≥ª„ÅÆË¶ãÁõ¥„Åó'
                    ]
                });
            }
            
            // Âè£„Ç≥„ÉüËª¢ÊèõÁéáÂàÜÊûê
            if (storeData.conversionRate < 5) {
                plans.push({
                    type: 'info',
                    title: 'Âè£„Ç≥„ÉüËª¢ÊèõÁéá„ÅÆÊîπÂñÑ',
                    description: `ÁèæÂú®„ÅÆËª¢ÊèõÁéá${storeData.conversionRate.toFixed(1)}%„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åó„Çá„ÅÜ„ÄÇ`,
                    actions: [
                        'È°ßÂÆ¢Ê∫ÄË∂≥Â∫¶Ë™øÊüª„ÅÆÂÆüÊñΩ',
                        'Âè£„Ç≥„ÉüÊäïÁ®ø‰øÉÈÄ≤„Ç≠„É£„É≥„Éö„Éº„É≥',
                        '„Ç¢„Éï„Çø„Éº„Éï„Ç©„É≠„Éº„ÅÆÂÖÖÂÆü'
                    ]
                });
            }
            
            // ÂÜô„É°Êó•Ë®òÂàÜÊûê
            if (storeData.avgDiary < 50) {
                plans.push({
                    type: 'info',
                    title: 'ÂÜô„É°Êó•Ë®òÊäïÁ®øÊï∞Â¢óÂä†',
                    description: `Êó•Âπ≥Âùá${Math.round(storeData.avgDiary)}‰ª∂„ÅÆÊäïÁ®øÊï∞„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,
                    actions: [
                        '„Ç≠„É£„Çπ„ÉàÊïôËÇ≤„ÅÆÂº∑Âåñ',
                        'ÊäïÁ®ø„Ç§„É≥„Çª„É≥„ÉÜ„Ç£„Éñ„ÅÆÂ∞éÂÖ•',
                        'ÊäïÁ®ø„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË≥™Âêë‰∏ä'
                    ]
                });
            }
            
            // Â•ΩË™øÂ∫óËàó„Å∏„ÅÆÊèêÊ°à
            if (storeData.rank <= 3) {
                plans.push({
                    type: 'success',
                    title: 'ÂÑ™ÁßÄÂ∫óËàó„Å®„Åó„Å¶‰ªñÂ∫ó„Å∏„ÅÆÂ±ïÈñã',
                    description: `${storeData.rank}‰Ωç„ÅÆÂ•ΩÊàêÁ∏æ„ÄÇÊàêÂäüË¶ÅÂõ†„Çí‰ªñÂ∫óËàó„Å´ÂÖ±Êúâ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,
                    actions: [
                        'ÊàêÂäü‰∫ã‰æã„ÅÆÊñáÊõ∏Âåñ',
                        '‰ªñÂ∫óËàó„Å∏„ÅÆÊåáÂ∞é„Éª„Çµ„Éù„Éº„Éà',
                        '„Éô„Çπ„Éà„Éó„É©„ÇØ„ÉÜ„Ç£„Çπ„ÅÆÊ®ôÊ∫ñÂåñ'
                    ]
                });
            }
            
            container.innerHTML = plans.map(plan => `
                <div class="border border-${getActionPlanColor(plan.type)}-200 bg-${getActionPlanColor(plan.type)}-50 rounded-lg p-4">
                    <div class="flex items-start">
                        <i class="fas fa-${getActionPlanIcon(plan.type)} text-${getActionPlanColor(plan.type)}-600 mr-3 mt-1"></i>
                        <div class="flex-1">
                            <h6 class="font-medium text-${getActionPlanColor(plan.type)}-800 mb-2">${plan.title}</h6>
                            <p class="text-
